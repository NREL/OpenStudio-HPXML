<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: measure
  
    &mdash; Documentation by YARD 0.9.16
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "measure";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: measure</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><pre class="code ruby"><span class='comment'># see the URL below for information on how to write OpenStudio measures
</span><span class='comment'># http://nrel.github.io/OpenStudio-user-documentation/reference/measure_writing_guide/
</span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>openstudio</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rexml/document</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rexml/xpath</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pathname</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>csv</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/EPvalidator</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/airflow</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/constants</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/constructions</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/geometry</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/hotwater_appliances</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/hvac</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/hvac_sizing</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/lighting</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/location</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/misc_loads</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/pv</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/unit_conversions</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/util</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/waterheater</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources/xmlhelper</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># start the measure
</span><span class='kw'>class</span> <span class='const'>HPXMLTranslator</span> <span class='op'>&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>ModelMeasure</span>
  <span class='comment'># human readable name
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HPXML Translator</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># human readable description
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_description'>description</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Translates HPXML file to OpenStudio Model</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># human readable description of modeling approach
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_modeler_description'>modeler_description</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># define the arguments that the user will input
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>OSArgumentVector</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

    <span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>OSArgument</span><span class='period'>.</span><span class='id identifier rubyid_makeStringArgument'>makeStringArgument</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hpxml_path</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDisplayName'>setDisplayName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HPXML File Path</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDescription'>setDescription</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Absolute (or relative) path of the HPXML file.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_arg'>arg</span>

    <span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>OSArgument</span><span class='period'>.</span><span class='id identifier rubyid_makeStringArgument'>makeStringArgument</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>weather_dir</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDisplayName'>setDisplayName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Weather Directory</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDescription'>setDescription</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Absolute path of the weather directory.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_arg'>arg</span>

    <span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>OSArgument</span><span class='period'>.</span><span class='id identifier rubyid_makeStringArgument'>makeStringArgument</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>schemas_dir</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDisplayName'>setDisplayName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HPXML Schemas Directory</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDescription'>setDescription</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Absolute path of the hpxml schemas directory.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_arg'>arg</span>

    <span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>OSArgument</span><span class='period'>.</span><span class='id identifier rubyid_makeStringArgument'>makeStringArgument</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>epw_output_path</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDisplayName'>setDisplayName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EPW Output File Path</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDescription'>setDescription</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Absolute (or relative) path of the output EPW file.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_arg'>arg</span>

    <span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>OSArgument</span><span class='period'>.</span><span class='id identifier rubyid_makeStringArgument'>makeStringArgument</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>osm_output_path</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDisplayName'>setDisplayName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OSM Output File Path</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDescription'>setDescription</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Absolute (or relative) path of the output OSM file.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_arg'>arg</span>

    <span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>OSArgument</span><span class='period'>.</span><span class='id identifier rubyid_makeBoolArgument'>makeBoolArgument</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>skip_validation</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDisplayName'>setDisplayName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skip HPXML validation</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDescription'>setDescription</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>If true, only checks for and reports HPXML validation issues if an error occurs during processing. Used for faster runtime.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDefaultValue'>setDefaultValue</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_arg'>arg</span>

    <span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Measure</span><span class='op'>::</span><span class='const'>OSArgument</span><span class='period'>.</span><span class='id identifier rubyid_makeStringArgument'>makeStringArgument</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map_tsv_dir</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDisplayName'>setDisplayName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Map TSV Directory</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_setDescription'>setDescription</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creates TSV files in the specified directory that map some HPXML object names to EnergyPlus object names. Required for ERI calculation.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_arg'>arg</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>end</span>

  <span class='comment'># define what happens when the measure is run
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>

    <span class='comment'># use the built-in error checking
</span>    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_validateUserArguments'>validateUserArguments</span><span class='lparen'>(</span><span class='id identifier rubyid_arguments'>arguments</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># assign the user inputs to variables
</span>    <span class='id identifier rubyid_hpxml_path'>hpxml_path</span> <span class='op'>=</span> <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_getStringArgumentValue'>getStringArgumentValue</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hpxml_path</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_weather_dir'>weather_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_getStringArgumentValue'>getStringArgumentValue</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>weather_dir</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_schemas_dir'>schemas_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_getOptionalStringArgumentValue'>getOptionalStringArgumentValue</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>schemas_dir</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_epw_output_path'>epw_output_path</span> <span class='op'>=</span> <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_getOptionalStringArgumentValue'>getOptionalStringArgumentValue</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>epw_output_path</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_osm_output_path'>osm_output_path</span> <span class='op'>=</span> <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_getOptionalStringArgumentValue'>getOptionalStringArgumentValue</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>osm_output_path</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_skip_validation'>skip_validation</span> <span class='op'>=</span> <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_getBoolArgumentValue'>getBoolArgumentValue</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>skip_validation</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_getOptionalStringArgumentValue'>getOptionalStringArgumentValue</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map_tsv_dir</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_arguments'>user_arguments</span><span class='rparen'>)</span>

    <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>Pathname</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span>
      <span class='id identifier rubyid_hpxml_path'>hpxml_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='period'>.</span><span class='id identifier rubyid_end_with?'>end_with?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.xml</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; does not exist or is not an .xml file.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span> <span class='op'>=</span> <span class='const'>REXML</span><span class='op'>::</span><span class='const'>Document</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='comment'># Check for invalid HPXML file up front?
</span>    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_skip_validation'>skip_validation</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_validate_hpxml'>validate_hpxml</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='comma'>,</span> <span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>begin</span>
      <span class='comment'># Weather file
</span>      <span class='id identifier rubyid_weather_wmo'>weather_wmo</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/HPXML/Building/BuildingDetails/ClimateandRiskZones/WeatherStation/WMO</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_epw_path'>epw_path</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_foreach'>foreach</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_weather_dir'>weather_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>headers:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wmo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_weather_wmo'>weather_wmo</span>

        <span class='id identifier rubyid_epw_path'>epw_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_weather_dir'>weather_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>filename</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_epw_path'>epw_path</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_epw_path'>epw_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; could not be found. Perhaps you need to run: openstudio energy_rating_index.rb --download-weather</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_cache_path'>cache_path</span> <span class='op'>=</span> <span class='id identifier rubyid_epw_path'>epw_path</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.epw</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.cache</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_cache_path'>cache_path</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cache_path'>cache_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; could not be found. Perhaps you need to run: openstudio energy_rating_index.rb --download-weather</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_epw_path'>epw_path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Weather station WMO &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_weather_wmo'>weather_wmo</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; could not be found in weather/data.csv.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_epw_output_path'>epw_output_path</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
        <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cp'>cp</span><span class='lparen'>(</span><span class='id identifier rubyid_epw_path'>epw_path</span><span class='comma'>,</span> <span class='id identifier rubyid_epw_output_path'>epw_output_path</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Apply Location to obtain weather data
</span>      <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Location.html" title="Location (class)">Location</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply'><span class='object_link'><a href="Location.html#apply-class_method" title="Location.apply (method)">apply</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_epw_path'>epw_path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NA</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NA</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='comment'># Create OpenStudio model
</span>      <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>OSModel</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsuccessful creation of OpenStudio model.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_skip_validation'>skip_validation</span>
        <span class='comment'># Something went wrong, check for invalid HPXML file now. This was previously
</span>        <span class='comment'># skipped to reduce runtime (see https://github.com/NREL/OpenStudio-ERI/issues/47).
</span>        <span class='id identifier rubyid_validate_hpxml'>validate_hpxml</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='comma'>,</span> <span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Report exception
</span>      <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_osm_output_path'>osm_output_path</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
      <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_osm_output_path'>osm_output_path</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerInfo'>registerInfo</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wrote file: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_osm_output_path'>osm_output_path</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_validate_hpxml'>validate_hpxml</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='comma'>,</span> <span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_is_valid'>is_valid</span> <span class='op'>=</span> <span class='kw'>true</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
      <span class='id identifier rubyid_schemas_dir'>schemas_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
      <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>Pathname</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span>
        <span class='id identifier rubyid_schemas_dir'>schemas_dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>unless</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; does not exist.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_schemas_dir'>schemas_dir</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='comment'># Validate input HPXML against schema
</span>    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_validate'><span class='object_link'><a href="XMLHelper.html#validate-class_method" title="XMLHelper.validate (method)">validate</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_schemas_dir'>schemas_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HPXML.xsd</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_error'>error</span><span class='op'>|</span>
        <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_is_valid'>is_valid</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerInfo'>registerInfo</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>: Validated against HPXML schema.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerWarning'>registerWarning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>: No schema dir provided, no HPXML validation performed.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Validate input HPXML against EnergyPlus Use Case
</span>    <span class='id identifier rubyid_errors'>errors</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="EnergyPlusValidator.html" title="EnergyPlusValidator (class)">EnergyPlusValidator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_run_validator'><span class='object_link'><a href="EnergyPlusValidator.html#run_validator-class_method" title="EnergyPlusValidator.run_validator (method)">run_validator</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_error'>error</span><span class='op'>|</span>
      <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_is_valid'>is_valid</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerInfo'>registerInfo</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hpxml_path'>hpxml_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>: Validated against HPXML EnergyPlus Use Case.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_is_valid'>is_valid</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>OSModel</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span><span class='rparen'>)</span>
    <span class='comment'># Simulation parameters
</span>    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_simulation_params'>add_simulation_params</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='ivar'>@eri_version</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/HPXML/SoftwareInfo/extension/ERICalculation/Version</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not find ERI Version</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@eri_version</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='id identifier rubyid_building'>building</span> <span class='op'>=</span> <span class='id identifier rubyid_hpxml_doc'>hpxml_doc</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/HPXML/Building</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='ivar'>@cfa</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/ConditionedFloorArea</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='ivar'>@ncfl</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/NumberofConditionedFloors</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='ivar'>@nbeds</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/NumberofBedrooms</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='ivar'>@garage_present</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#Boolean-instance_method" title="#Boolean (method)">Boolean</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/GaragePresent</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='ivar'>@has_uncond_bsmnt</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='kw'>not</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Foundations/FoundationType/Basement[Conditioned=&#39;false&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
    <span class='ivar'>@iecc_zone_2006</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/ClimateandRiskZones/ClimateZoneIECC[Year=&#39;2006&#39;]/ClimateZone</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='comment'># Geometry/Envelope
</span>
    <span class='id identifier rubyid_spaces'>spaces</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span> <span class='op'>=</span> <span class='id identifier rubyid_add_geometry_envelope'>add_geometry_envelope</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='comment'># Bedrooms, Occupants
</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_num_bedrooms_occupants'>add_num_bedrooms_occupants</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='comment'># Hot Water
</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_hot_water_and_appliances'>add_hot_water_and_appliances</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='comment'># HVAC
</span>
    <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='comment'># mapping between HPXML HVAC systems and model air/plant loops
</span>    <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='comment'># mapping between HPXML HVAC systems and model zonal HVACs
</span>    <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/HVAC/extension/UseOnlyIdealAirSystem</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#Boolean-instance_method" title="#Boolean (method)">Boolean</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_cooling_system'>add_cooling_system</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_heating_system'>add_heating_system</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_heat_pump'>add_heat_pump</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_residual_hvac'>add_residual_hvac</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_setpoints'>add_setpoints</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_dehumidifier'>add_dehumidifier</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_ceiling_fans'>add_ceiling_fans</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='comment'># FIXME: remove the following logic eventually
</span>    <span class='id identifier rubyid_load_distribution'>load_distribution</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/extension/LoadDistributionScheme</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_load_distribution'>load_distribution</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UniformLoad</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SequentialLoad</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_load_distribution'>load_distribution</span>
        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected load distribution scheme </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_load_distribution'>load_distribution</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_thermal_zones'>thermal_zones</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_thermal_zones_from_spaces'><span class='object_link'><a href="Geometry.html#get_thermal_zones_from_spaces-class_method" title="Geometry.get_thermal_zones_from_spaces (method)">get_thermal_zones_from_spaces</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_unit'>unit</span><span class='period'>.</span><span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_control_slave_zones_hash'>control_slave_zones_hash</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_control_and_slave_zones'>get_control_and_slave_zones</span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zones'>thermal_zones</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_control_slave_zones_hash'>control_slave_zones_hash</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_control_zone'>control_zone</span><span class='comma'>,</span> <span class='id identifier rubyid_slave_zones'>slave_zones</span><span class='op'>|</span>
        <span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_control_zone'>control_zone</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_slave_zones'>slave_zones</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_zone'>zone</span><span class='op'>|</span>
          <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_prioritize_zone_hvac'>prioritize_zone_hvac</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_zone'>zone</span><span class='comma'>,</span> <span class='id identifier rubyid_load_distribution'>load_distribution</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Plug Loads &amp; Lighting
</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_mels'>add_mels</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_lighting'>add_lighting</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='comment'># Other
</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_airflow'>add_airflow</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_hvac_sizing'>add_hvac_sizing</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_fuel_heating_eae'>add_fuel_heating_eae</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_photovoltaics'>add_photovoltaics</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_building_output_variables'>add_building_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_simulation_params'>add_simulation_params</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sim'>sim</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getSimulationControl'>getSimulationControl</span>
    <span class='id identifier rubyid_sim'>sim</span><span class='period'>.</span><span class='id identifier rubyid_setRunSimulationforSizingPeriods'>setRunSimulationforSizingPeriods</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_tstep'>tstep</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getTimestep'>getTimestep</span>
    <span class='id identifier rubyid_tstep'>tstep</span><span class='period'>.</span><span class='id identifier rubyid_setNumberOfTimestepsPerHour'>setNumberOfTimestepsPerHour</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_shad'>shad</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getShadowCalculation'>getShadowCalculation</span>
    <span class='id identifier rubyid_shad'>shad</span><span class='period'>.</span><span class='id identifier rubyid_setCalculationFrequency'>setCalculationFrequency</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_shad'>shad</span><span class='period'>.</span><span class='id identifier rubyid_setMaximumFiguresInShadowOverlapCalculations'>setMaximumFiguresInShadowOverlapCalculations</span><span class='lparen'>(</span><span class='int'>200</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_outsurf'>outsurf</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getOutsideSurfaceConvectionAlgorithm'>getOutsideSurfaceConvectionAlgorithm</span>
    <span class='id identifier rubyid_outsurf'>outsurf</span><span class='period'>.</span><span class='id identifier rubyid_setAlgorithm'>setAlgorithm</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DOE-2</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_insurf'>insurf</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getInsideSurfaceConvectionAlgorithm'>getInsideSurfaceConvectionAlgorithm</span>
    <span class='id identifier rubyid_insurf'>insurf</span><span class='period'>.</span><span class='id identifier rubyid_setAlgorithm'>setAlgorithm</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TARP</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_zonecap'>zonecap</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getZoneCapacitanceMultiplierResearchSpecial'>getZoneCapacitanceMultiplierResearchSpecial</span>
    <span class='id identifier rubyid_zonecap'>zonecap</span><span class='period'>.</span><span class='id identifier rubyid_setHumidityCapacityMultiplier'>setHumidityCapacityMultiplier</span><span class='lparen'>(</span><span class='int'>15</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_convlim'>convlim</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getConvergenceLimits'>getConvergenceLimits</span>
    <span class='id identifier rubyid_convlim'>convlim</span><span class='period'>.</span><span class='id identifier rubyid_setMinimumSystemTimestep'>setMinimumSystemTimestep</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_geometry_envelope'>add_geometry_envelope</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span> <span class='op'>=</span> <span class='id identifier rubyid_get_subsurface_areas'>get_subsurface_areas</span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_heating_season'>heating_season</span><span class='comma'>,</span> <span class='id identifier rubyid_cooling_season'>cooling_season</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_calc_heating_and_cooling_seasons'>calc_heating_and_cooling_seasons</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_heating_season'>heating_season</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_cooling_season'>cooling_season</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span> <span class='op'>=</span> <span class='id identifier rubyid_add_building_info'>add_building_info</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_foundations'>add_foundations</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_walls'>add_walls</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_rim_joists'>add_rim_joists</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_windows'>add_windows</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_cooling_season'>cooling_season</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_doors'>add_doors</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_skylights'>add_skylights</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_cooling_season'>cooling_season</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_attics'>add_attics</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_finished_floor_area'>add_finished_floor_area</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_add_thermal_mass'>add_thermal_mass</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_set_zone_volumes'>set_zone_volumes</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_explode_surfaces'>explode_surfaces</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_zone_volumes'>set_zone_volumes</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_total_conditioned_volume'>total_conditioned_volume</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/ConditionedBuildingVolume</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_thermal_zones'>thermal_zones</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getThermalZones'>getThermalZones</span>

    <span class='comment'># Init
</span>    <span class='id identifier rubyid_living_volume'>living_volume</span> <span class='op'>=</span> <span class='id identifier rubyid_total_conditioned_volume'>total_conditioned_volume</span>
    <span class='id identifier rubyid_zones_updated'>zones_updated</span> <span class='op'>=</span> <span class='int'>0</span>

    <span class='comment'># Basements, crawl, garage
</span>    <span class='id identifier rubyid_thermal_zones'>thermal_zones</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_is_finished_basement'><span class='object_link'><a href="Geometry.html#is_finished_basement-class_method" title="Geometry.is_finished_basement (method)">is_finished_basement</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_is_unfinished_basement'><span class='object_link'><a href="Geometry.html#is_unfinished_basement-class_method" title="Geometry.is_unfinished_basement (method)">is_unfinished_basement</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_is_crawl'><span class='object_link'><a href="Geometry.html#is_crawl-class_method" title="Geometry.is_crawl (method)">is_crawl</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_is_garage'><span class='object_link'><a href="Geometry.html#is_garage-class_method" title="Geometry.is_garage (method)">is_garage</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_zones_updated'>zones_updated</span> <span class='op'>+=</span> <span class='int'>1</span>

        <span class='id identifier rubyid_zone_volume'>zone_volume</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_height_of_spaces'><span class='object_link'><a href="Geometry.html#get_height_of_spaces-class_method" title="Geometry.get_height_of_spaces (method)">get_height_of_spaces</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_floor_area_from_spaces'><span class='object_link'><a href="Geometry.html#get_floor_area_from_spaces-class_method" title="Geometry.get_floor_area_from_spaces (method)">get_floor_area_from_spaces</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_zone_volume'>zone_volume</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Calculated volume for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> zone (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_zone_volume'>zone_volume</span><span class='embexpr_end'>}</span><span class='tstring_content'>) is not greater than zero.</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_setVolume'>setVolume</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_zone_volume'>zone_volume</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft^3</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m^3</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

        <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_is_finished_basement'><span class='object_link'><a href="Geometry.html#is_finished_basement-class_method" title="Geometry.is_finished_basement (method)">is_finished_basement</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_living_volume'>living_volume</span> <span class='op'>=</span> <span class='id identifier rubyid_total_conditioned_volume'>total_conditioned_volume</span> <span class='op'>-</span> <span class='id identifier rubyid_zone_volume'>zone_volume</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Conditioned living
</span>    <span class='id identifier rubyid_thermal_zones'>thermal_zones</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_is_living'><span class='object_link'><a href="Geometry.html#is_living-class_method" title="Geometry.is_living (method)">is_living</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_zones_updated'>zones_updated</span> <span class='op'>+=</span> <span class='int'>1</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_living_volume'>living_volume</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Calculated volume for living zone (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_living_volume'>living_volume</span><span class='embexpr_end'>}</span><span class='tstring_content'>) is not greater than zero.</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_setVolume'>setVolume</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_living_volume'>living_volume</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft^3</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m^3</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Attic
</span>    <span class='id identifier rubyid_thermal_zones'>thermal_zones</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_is_unfinished_attic'><span class='object_link'><a href="Geometry.html#is_unfinished_attic-class_method" title="Geometry.is_unfinished_attic (method)">is_unfinished_attic</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_zones_updated'>zones_updated</span> <span class='op'>+=</span> <span class='int'>1</span>

        <span class='id identifier rubyid_zone_surfaces'>zone_surfaces</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_spaces'>spaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_space'>space</span><span class='op'>|</span>
          <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_surfaces'>surfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_surface'>surface</span><span class='op'>|</span>
            <span class='id identifier rubyid_zone_surfaces'>zone_surfaces</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_surface'>surface</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='comment'># Assume square hip roof for volume calculations; energy results are very insensitive to actual volume
</span>        <span class='id identifier rubyid_zone_area'>zone_area</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_floor_area_from_spaces'><span class='object_link'><a href="Geometry.html#get_floor_area_from_spaces-class_method" title="Geometry.get_floor_area_from_spaces (method)">get_floor_area_from_spaces</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_zone_length'>zone_length</span> <span class='op'>=</span> <span class='id identifier rubyid_zone_area'>zone_area</span><span class='op'>**</span><span class='float'>0.5</span>
        <span class='id identifier rubyid_zone_height'>zone_height</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_tan'>tan</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_roof_pitch'><span class='object_link'><a href="Geometry.html#get_roof_pitch-class_method" title="Geometry.get_roof_pitch (method)">get_roof_pitch</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_zone_surfaces'>zone_surfaces</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>deg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rad</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_zone_length'>zone_length</span> <span class='op'>/</span> <span class='float'>2.0</span>
        <span class='id identifier rubyid_zone_volume'>zone_volume</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_zone_area'>zone_area</span> <span class='op'>*</span> <span class='id identifier rubyid_zone_height'>zone_height</span> <span class='op'>/</span> <span class='float'>3.0</span><span class='comma'>,</span> <span class='float'>0.01</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
        <span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_setVolume'>setVolume</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_zone_volume'>zone_volume</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft^3</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m^3</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_zones_updated'>zones_updated</span> <span class='op'>!=</span> <span class='id identifier rubyid_thermal_zones'>thermal_zones</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unhandled volume calculations for thermal zones.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_explode_surfaces'>explode_surfaces</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='comment'># Re-position surfaces so as to not shade each other and to make it easier to visualize the building.
</span>    <span class='comment'># FUTURE: Might be able to use the new self-shading options in E+ 8.9 ShadowCalculation object?
</span>
    <span class='id identifier rubyid_gap_distance'>gap_distance</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='float'>10.0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># distance between surfaces of the same azimuth
</span>    <span class='id identifier rubyid_rad90'>rad90</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='int'>90</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>deg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rad</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='comment'># Determine surfaces to shift and distance with which to explode surfaces horizontally outward
</span>    <span class='id identifier rubyid_surfaces'>surfaces</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_azimuth_lengths'>azimuth_lengths</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getSurfaces'>getSurfaces</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_surface'>surface</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>roofceiling</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_surfaceType'>surfaceType</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outdoors</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foundation</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_outsideBoundaryCondition'>outsideBoundaryCondition</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>

      <span class='id identifier rubyid_surfaces'>surfaces</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_surface'>surface</span>
      <span class='id identifier rubyid_azimuth'>azimuth</span> <span class='op'>=</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_getFeatureAsDouble'>getFeatureAsDouble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_azimuth_lengths'>azimuth_lengths</span><span class='lbracket'>[</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_azimuth_lengths'>azimuth_lengths</span><span class='lbracket'>[</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_azimuth_lengths'>azimuth_lengths</span><span class='lbracket'>[</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_getFeatureAsDouble'>getFeatureAsDouble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span> <span class='op'>+</span> <span class='id identifier rubyid_gap_distance'>gap_distance</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_max_azimuth_length'>max_azimuth_length</span> <span class='op'>=</span> <span class='id identifier rubyid_azimuth_lengths'>azimuth_lengths</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>

    <span class='comment'># Initial distance of shifts at 90-degrees to horizontal outward
</span>    <span class='id identifier rubyid_azimuth_side_shifts'>azimuth_side_shifts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_azimuth_lengths'>azimuth_lengths</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
      <span class='id identifier rubyid_azimuth_side_shifts'>azimuth_side_shifts</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_max_azimuth_length'>max_azimuth_length</span> <span class='op'>/</span> <span class='float'>2.0</span>
    <span class='kw'>end</span>

    <span class='comment'># Explode walls, windows, doors, roofs, and skylights
</span>    <span class='id identifier rubyid_surfaces_moved'>surfaces_moved</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_surfaces'>surfaces</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_surface'>surface</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentSurface'>adjacentSurface</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_surfaces_moved'>surfaces_moved</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentSurface'>adjacentSurface</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_azimuth'>azimuth</span> <span class='op'>=</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_getFeatureAsDouble'>getFeatureAsDouble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
      <span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>deg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rad</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='comment'># Push out horizontally
</span>      <span class='id identifier rubyid_distance'>distance</span> <span class='op'>=</span> <span class='id identifier rubyid_max_azimuth_length'>max_azimuth_length</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_surfaceType'>surfaceType</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>roofceiling</span><span class='tstring_end'>&quot;</span></span>
        <span class='comment'># Ensure pitched surfaces are positioned outward justified with walls, etc.
</span>        <span class='id identifier rubyid_roof_tilt'>roof_tilt</span> <span class='op'>=</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_getFeatureAsDouble'>getFeatureAsDouble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tilt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
        <span class='id identifier rubyid_roof_width'>roof_width</span> <span class='op'>=</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_getFeatureAsDouble'>getFeatureAsDouble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Width</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
        <span class='id identifier rubyid_distance'>distance</span> <span class='op'>-=</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='id identifier rubyid_roof_tilt'>roof_tilt</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_roof_width'>roof_width</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>=</span> <span class='id identifier rubyid_get_surface_transformation'>get_surface_transformation</span><span class='lparen'>(</span><span class='id identifier rubyid_distance'>distance</span><span class='comma'>,</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setVertices'>setVertices</span><span class='lparen'>(</span><span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>*</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentSurface'>adjacentSurface</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentSurface'>adjacentSurface</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_setVertices'>setVertices</span><span class='lparen'>(</span><span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>*</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentSurface'>adjacentSurface</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_subSurfaces'>subSurfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_subsurface'>subsurface</span><span class='op'>|</span>
        <span class='id identifier rubyid_subsurface'>subsurface</span><span class='period'>.</span><span class='id identifier rubyid_setVertices'>setVertices</span><span class='lparen'>(</span><span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>*</span> <span class='id identifier rubyid_subsurface'>subsurface</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='rparen'>)</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_subsurface'>subsurface</span><span class='period'>.</span><span class='id identifier rubyid_subSurfaceType'>subSurfaceType</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fixedwindow</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_subsurface'>subsurface</span><span class='period'>.</span><span class='id identifier rubyid_shadingSurfaceGroups'>shadingSurfaceGroups</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_overhang_group'>overhang_group</span><span class='op'>|</span>
          <span class='id identifier rubyid_overhang_group'>overhang_group</span><span class='period'>.</span><span class='id identifier rubyid_shadingSurfaces'>shadingSurfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_overhang'>overhang</span><span class='op'>|</span>
            <span class='id identifier rubyid_overhang'>overhang</span><span class='period'>.</span><span class='id identifier rubyid_setVertices'>setVertices</span><span class='lparen'>(</span><span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>*</span> <span class='id identifier rubyid_overhang'>overhang</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='comment'># Shift at 90-degrees to previous transformation
</span>      <span class='id identifier rubyid_azimuth_side_shifts'>azimuth_side_shifts</span><span class='lbracket'>[</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='rbracket'>]</span> <span class='op'>-=</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_getFeatureAsDouble'>getFeatureAsDouble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span> <span class='op'>/</span> <span class='float'>2.0</span>
      <span class='id identifier rubyid_transformation_shift'>transformation_shift</span> <span class='op'>=</span> <span class='id identifier rubyid_get_surface_transformation'>get_surface_transformation</span><span class='lparen'>(</span><span class='id identifier rubyid_azimuth_side_shifts'>azimuth_side_shifts</span><span class='lbracket'>[</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span> <span class='op'>+</span> <span class='id identifier rubyid_rad90'>rad90</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span> <span class='op'>+</span> <span class='id identifier rubyid_rad90'>rad90</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setVertices'>setVertices</span><span class='lparen'>(</span><span class='id identifier rubyid_transformation_shift'>transformation_shift</span> <span class='op'>*</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentSurface'>adjacentSurface</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentSurface'>adjacentSurface</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_setVertices'>setVertices</span><span class='lparen'>(</span><span class='id identifier rubyid_transformation_shift'>transformation_shift</span> <span class='op'>*</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentSurface'>adjacentSurface</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_subSurfaces'>subSurfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_subsurface'>subsurface</span><span class='op'>|</span>
        <span class='id identifier rubyid_subsurface'>subsurface</span><span class='period'>.</span><span class='id identifier rubyid_setVertices'>setVertices</span><span class='lparen'>(</span><span class='id identifier rubyid_transformation_shift'>transformation_shift</span> <span class='op'>*</span> <span class='id identifier rubyid_subsurface'>subsurface</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='rparen'>)</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_subsurface'>subsurface</span><span class='period'>.</span><span class='id identifier rubyid_subSurfaceType'>subSurfaceType</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fixedwindow</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_subsurface'>subsurface</span><span class='period'>.</span><span class='id identifier rubyid_shadingSurfaceGroups'>shadingSurfaceGroups</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_overhang_group'>overhang_group</span><span class='op'>|</span>
          <span class='id identifier rubyid_overhang_group'>overhang_group</span><span class='period'>.</span><span class='id identifier rubyid_shadingSurfaces'>shadingSurfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_overhang'>overhang</span><span class='op'>|</span>
            <span class='id identifier rubyid_overhang'>overhang</span><span class='period'>.</span><span class='id identifier rubyid_setVertices'>setVertices</span><span class='lparen'>(</span><span class='id identifier rubyid_transformation_shift'>transformation_shift</span> <span class='op'>*</span> <span class='id identifier rubyid_overhang'>overhang</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_azimuth_side_shifts'>azimuth_side_shifts</span><span class='lbracket'>[</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='rbracket'>]</span> <span class='op'>-=</span> <span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_getFeatureAsDouble'>getFeatureAsDouble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span> <span class='op'>/</span> <span class='float'>2.0</span> <span class='op'>+</span> <span class='id identifier rubyid_gap_distance'>gap_distance</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_surfaces_moved'>surfaces_moved</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_surface'>surface</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_space_and_zone'>create_space_and_zone</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_space_type'>space_type</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_space_type'>space_type</span>
      <span class='id identifier rubyid_thermal_zone'>thermal_zone</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>ThermalZone</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_space_type'>space_type</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_space'>space</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Space</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_space_type'>space_type</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getBuildingUnits'>getBuildingUnits</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_unit'>unit</span><span class='op'>|</span>
        <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_setBuildingUnit'>setBuildingUnit</span><span class='lparen'>(</span><span class='id identifier rubyid_unit'>unit</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_st'>st</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>SpaceType</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_st'>st</span><span class='period'>.</span><span class='id identifier rubyid_setStandardsSpaceType'>setStandardsSpaceType</span><span class='lparen'>(</span><span class='id identifier rubyid_space_type'>space_type</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_setSpaceType'>setSpaceType</span><span class='lparen'>(</span><span class='id identifier rubyid_st'>st</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_setThermalZone'>setThermalZone</span><span class='lparen'>(</span><span class='id identifier rubyid_thermal_zone'>thermal_zone</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_spaces'>spaces</span><span class='lbracket'>[</span><span class='id identifier rubyid_space_type'>space_type</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_space'>space</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_building_info'>add_building_info</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='comment'># Store building unit information
</span>    <span class='id identifier rubyid_unit'>unit</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>BuildingUnit</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_unit'>unit</span><span class='period'>.</span><span class='id identifier rubyid_setBuildingUnitType'>setBuildingUnitType</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#BuildingUnitTypeResidential-class_method" title="Constants.BuildingUnitTypeResidential (method)">BuildingUnitTypeResidential</a></span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_unit'>unit</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#ObjectNameBuildingUnit-class_method" title="Constants.ObjectNameBuildingUnit (method)">ObjectNameBuildingUnit</a></span></span><span class='rparen'>)</span>

    <span class='comment'># Store number of units
</span>    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getBuilding'>getBuilding</span><span class='period'>.</span><span class='id identifier rubyid_setStandardsNumberOfLivingUnits'>setStandardsNumberOfLivingUnits</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>

    <span class='comment'># Store number of stories
</span>    <span class='id identifier rubyid_num_stories'>num_stories</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/NumberofConditionedFloors</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getBuilding'>getBuilding</span><span class='period'>.</span><span class='id identifier rubyid_setStandardsNumberOfStories'>setStandardsNumberOfStories</span><span class='lparen'>(</span><span class='id identifier rubyid_num_stories'>num_stories</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_num_stories_above_grade'>num_stories_above_grade</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/NumberofConditionedFloorsAboveGrade</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getBuilding'>getBuilding</span><span class='period'>.</span><span class='id identifier rubyid_setStandardsNumberOfAboveGroundStories'>setStandardsNumberOfAboveGroundStories</span><span class='lparen'>(</span><span class='id identifier rubyid_num_stories_above_grade'>num_stories_above_grade</span><span class='rparen'>)</span>

    <span class='comment'># Store info for HVAC Sizing measure
</span>    <span class='kw'>if</span> <span class='ivar'>@garage_present</span>
      <span class='id identifier rubyid_unit'>unit</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'>SizingInfoGarageFracUnderFinishedSpace</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='rparen'>)</span> <span class='comment'># FIXME: assumption
</span>    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_surface_transformation'>get_surface_transformation</span><span class='lparen'>(</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_z'>z</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_z'>z</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Matrix</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>4</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_offset'>offset</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_offset'>offset</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_z'>z</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>*</span> <span class='id identifier rubyid_offset'>offset</span>

    <span class='kw'>return</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Transformation</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_floor_polygon'>add_floor_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_z'>z</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_z'>z</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3dVector</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span> <span class='op'>-</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>-</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span> <span class='op'>-</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>-</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_vertices'>vertices</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='comma'>,</span> <span class='id identifier rubyid_azimuth'>azimuth</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_offsets'>offsets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>4</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_z'>z</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_z'>z</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3dVector</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span> <span class='op'>-</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>+</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>+</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span> <span class='op'>-</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># Rotate about the z axis
</span>    <span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>deg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rad</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Matrix</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>4</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>-</span><span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Transformation</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>*</span> <span class='id identifier rubyid_vertices'>vertices</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_roof_polygon'>add_roof_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='comma'>,</span> <span class='id identifier rubyid_azimuth'>azimuth</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_tilt'>tilt</span> <span class='op'>=</span> <span class='float'>0.5</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_z'>z</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_z'>z</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3dVector</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_y'>y</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_x'>x</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_y'>y</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>

    <span class='comment'># Rotate about the x axis
</span>    <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Matrix</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>4</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='id identifier rubyid_tilt'>tilt</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>-</span><span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='id identifier rubyid_tilt'>tilt</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='id identifier rubyid_tilt'>tilt</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='id identifier rubyid_tilt'>tilt</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Transformation</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>=</span> <span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>*</span> <span class='id identifier rubyid_vertices'>vertices</span>

    <span class='comment'># Rotate about the z axis
</span>    <span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_azimuth'>azimuth</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>deg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rad</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rad180'>rad180</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='int'>180</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>deg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rad</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Matrix</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>4</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_rad180'>rad180</span> <span class='op'>-</span> <span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_rad180'>rad180</span> <span class='op'>-</span> <span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>-</span><span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_rad180'>rad180</span> <span class='op'>-</span> <span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_rad180'>rad180</span> <span class='op'>-</span> <span class='id identifier rubyid_azimuth_rad'>azimuth_rad</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Transformation</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_vertices'>vertices</span> <span class='op'>=</span> <span class='id identifier rubyid_transformation'>transformation</span> <span class='op'>*</span> <span class='id identifier rubyid_vertices'>vertices</span>

    <span class='comment'># Shift up by z
</span>    <span class='id identifier rubyid_new_vertices'>new_vertices</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3dVector</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_vertices'>vertices</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_vertex'>vertex</span><span class='op'>|</span>
      <span class='id identifier rubyid_new_vertices'>new_vertices</span> <span class='op'>&lt;&lt;</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Point3d</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_vertex'>vertex</span><span class='period'>.</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_vertex'>vertex</span><span class='period'>.</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_vertex'>vertex</span><span class='period'>.</span><span class='id identifier rubyid_z'>z</span> <span class='op'>+</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_new_vertices'>new_vertices</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_ceiling_polygon'>add_ceiling_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='id identifier rubyid_reverse'>reverse</span><span class='lparen'>(</span><span class='id identifier rubyid_add_floor_polygon'>add_floor_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_net_wall_area'>net_wall_area</span><span class='lparen'>(</span><span class='id identifier rubyid_gross_wall_area'>gross_wall_area</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_subsurface_areas'>wall_subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_wall_subsurface_areas'>wall_subsurface_areas</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_wall_id'>wall_id</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_gross_wall_area'>gross_wall_area</span> <span class='op'>-</span> <span class='id identifier rubyid_wall_subsurface_areas'>wall_subsurface_areas</span><span class='lbracket'>[</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_gross_wall_area'>gross_wall_area</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_num_bedrooms_occupants'>add_num_bedrooms_occupants</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='rparen'>)</span>
    <span class='comment'># Bedrooms
</span>    <span class='id identifier rubyid_num_bedrooms'>num_bedrooms</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/NumberofBedrooms</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_num_bathrooms'>num_bathrooms</span> <span class='op'>=</span> <span class='float'>3.0</span> <span class='comment'># Arbitrary, no impact on results since water heater capacity is required
</span>    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_process_beds_and_baths'><span class='object_link'><a href="Geometry.html#process_beds_and_baths-class_method" title="Geometry.process_beds_and_baths (method)">process_beds_and_baths</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_num_bedrooms'>num_bedrooms</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_num_bathrooms'>num_bathrooms</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='comment'># Occupants
</span>    <span class='id identifier rubyid_num_occ'>num_occ</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingOccupancy/NumberofResidents</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_num_occ'>num_occ</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_num_occ'>num_occ</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_occupancy_default_num'><span class='object_link'><a href="Geometry.html#get_occupancy_default_num-class_method" title="Geometry.get_occupancy_default_num (method)">get_occupancy_default_num</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_num_bedrooms'>num_bedrooms</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_num_occ'>num_occ</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_num_occ'>num_occ</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_num_occ'>num_occ</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_occ_gain'>occ_gain</span><span class='comma'>,</span> <span class='id identifier rubyid_hrs_per_day'>hrs_per_day</span><span class='comma'>,</span> <span class='id identifier rubyid_sens_frac'>sens_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_lat_frac'>lat_frac</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_occupancy_default_values'><span class='object_link'><a href="Geometry.html#get_occupancy_default_values-class_method" title="Geometry.get_occupancy_default_values (method)">get_occupancy_default_values</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_weekday_sch'>weekday_sch</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1.00000, 1.00000, 1.00000, 1.00000, 1.00000, 1.00000, 1.00000, 0.88310, 0.40861, 0.24189, 0.24189, 0.24189, 0.24189, 0.24189, 0.24189, 0.24189, 0.29498, 0.55310, 0.89693, 0.89693, 0.89693, 1.00000, 1.00000, 1.00000</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># TODO: Normalize schedule based on hrs_per_day
</span>      <span class='id identifier rubyid_weekend_sch'>weekend_sch</span> <span class='op'>=</span> <span class='id identifier rubyid_weekday_sch'>weekday_sch</span>
      <span class='id identifier rubyid_monthly_sch'>monthly_sch</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_process_occupants'><span class='object_link'><a href="Geometry.html#process_occupants-class_method" title="Geometry.process_occupants (method)">process_occupants</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_num_occ'>num_occ</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='id identifier rubyid_occ_gain'>occ_gain</span><span class='comma'>,</span> <span class='id identifier rubyid_sens_frac'>sens_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_lat_frac'>lat_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_weekday_sch'>weekday_sch</span><span class='comma'>,</span> <span class='id identifier rubyid_weekend_sch'>weekend_sch</span><span class='comma'>,</span> <span class='id identifier rubyid_monthly_sch'>monthly_sch</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_subsurface_areas'>get_subsurface_areas</span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

    <span class='comment'># Windows
</span>    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Windows/Window</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_window'>window</span><span class='op'>|</span>
      <span class='id identifier rubyid_wall_id'>wall_id</span> <span class='op'>=</span> <span class='id identifier rubyid_window'>window</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AttachedToWall</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_wall_id'>wall_id</span>
        <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='lbracket'>[</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_window_area'>window_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='lbracket'>[</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='id identifier rubyid_window_area'>window_area</span>
    <span class='kw'>end</span>

    <span class='comment'># Skylights
</span>    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Skylights/Skylight</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_skylight'>skylight</span><span class='op'>|</span>
      <span class='id identifier rubyid_roof_id'>roof_id</span> <span class='op'>=</span> <span class='id identifier rubyid_skylight'>skylight</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AttachedToRoof</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_roof_id'>roof_id</span>
        <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='lbracket'>[</span><span class='id identifier rubyid_roof_id'>roof_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_skylight_area'>skylight_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_skylight'>skylight</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='lbracket'>[</span><span class='id identifier rubyid_roof_id'>roof_id</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='id identifier rubyid_skylight_area'>skylight_area</span>
    <span class='kw'>end</span>

    <span class='comment'># Doors
</span>    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Doors/Door</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_door'>door</span><span class='op'>|</span>
      <span class='id identifier rubyid_wall_id'>wall_id</span> <span class='op'>=</span> <span class='id identifier rubyid_door'>door</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AttachedToWall</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_wall_id'>wall_id</span>
        <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='lbracket'>[</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_door_area'>door_area</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_door'>door</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_door_area'>door_area</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_door_area'>door_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_door_area'>door_area</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_door_area'>door_area</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="SubsurfaceConstructions.html" title="SubsurfaceConstructions (class)">SubsurfaceConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_door_area'><span class='object_link'><a href="SubsurfaceConstructions.html#get_default_door_area-class_method" title="SubsurfaceConstructions.get_default_door_area (method)">get_default_door_area</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='lbracket'>[</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='id identifier rubyid_door_area'>door_area</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_spacetype'>spacetype</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='lbracket'>[</span><span class='id identifier rubyid_spacetype'>spacetype</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_create_space_and_zone'>create_space_and_zone</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_spacetype'>spacetype</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='lbracket'>[</span><span class='id identifier rubyid_spacetype'>spacetype</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_foundations'>add_foundations</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Foundations/Foundation</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_foundation'>foundation</span><span class='op'>|</span>
      <span class='id identifier rubyid_foundation_id'>foundation_id</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_foundation_type'>foundation_type</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FoundationType</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span> <span class='op'>=</span> <span class='id identifier rubyid_get_foundation_adjacent_to'>get_foundation_adjacent_to</span><span class='lparen'>(</span><span class='id identifier rubyid_foundation_type'>foundation_type</span><span class='rparen'>)</span>

      <span class='comment'># Foundation slab surfaces
</span>      <span class='id identifier rubyid_slab_surface'>slab_surface</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_perim_exp'>perim_exp</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_gap_r'>slab_gap_r</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_slab_whole_r'>slab_whole_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_concrete_thick_in'>slab_concrete_thick_in</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_num_slabs'>num_slabs</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Slab</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='op'>|</span>
        <span class='id identifier rubyid_num_slabs'>num_slabs</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_slab_id'>slab_id</span> <span class='op'>=</span> <span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_slab_perim'>slab_perim</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ExposedPerimeter</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_perim_exp'>perim_exp</span> <span class='op'>+=</span> <span class='id identifier rubyid_slab_perim'>slab_perim</span>
        <span class='id identifier rubyid_slab_area'>slab_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='comment'># Calculate length/width given perimeter/area
</span>        <span class='id identifier rubyid_sqrt_term'>sqrt_term</span> <span class='op'>=</span> <span class='id identifier rubyid_slab_perim'>slab_perim</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>-</span> <span class='float'>16.0</span> <span class='op'>*</span> <span class='id identifier rubyid_slab_area'>slab_area</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_sqrt_term'>sqrt_term</span> <span class='op'>&lt;</span> <span class='int'>0</span>
          <span class='id identifier rubyid_slab_length'>slab_length</span> <span class='op'>=</span> <span class='id identifier rubyid_slab_perim'>slab_perim</span> <span class='op'>/</span> <span class='float'>4.0</span>
          <span class='id identifier rubyid_slab_width'>slab_width</span> <span class='op'>=</span> <span class='id identifier rubyid_slab_perim'>slab_perim</span> <span class='op'>/</span> <span class='float'>4.0</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_slab_length'>slab_length</span> <span class='op'>=</span> <span class='id identifier rubyid_slab_perim'>slab_perim</span> <span class='op'>/</span> <span class='float'>4.0</span> <span class='op'>+</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_sqrt_term'>sqrt_term</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>4.0</span>
          <span class='id identifier rubyid_slab_width'>slab_width</span> <span class='op'>=</span> <span class='id identifier rubyid_slab_perim'>slab_perim</span> <span class='op'>/</span> <span class='float'>4.0</span> <span class='op'>-</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_sqrt_term'>sqrt_term</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>4.0</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span> <span class='op'>*</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DepthBelowGrade</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_floor_polygon'>add_floor_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_slab_length'>slab_length</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_width'>slab_width</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_slab_id'>slab_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Floor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setOutsideBoundaryCondition'>setOutsideBoundaryCondition</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Foundation</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_id'>slab_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSunExposure'>setSunExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setWindExposure'>setWindExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoWind</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_slab_surface'>slab_surface</span> <span class='op'>=</span> <span class='id identifier rubyid_surface'>surface</span>

        <span class='id identifier rubyid_slab_gap_r'>slab_gap_r</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_slab_whole_r'>slab_whole_r</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_slab_concrete_thick_in'>slab_concrete_thick_in</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Thickness</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_fnd_slab_perim'>fnd_slab_perim</span> <span class='op'>=</span> <span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PerimeterInsulation/Layer[InstallationType=&#39;continuous&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_slab_perim'>fnd_slab_perim</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NominalRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PerimeterInsulationDepth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FloorConstructions.html" title="FloorConstructions (class)">FloorConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_slab_perimeter_rvalue_depth'>get_default_slab_perimeter_rvalue_depth</span><span class='lparen'>(</span><span class='ivar'>@iecc_zone_2006</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>or</span> <span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span> <span class='op'>==</span> <span class='int'>0</span>
          <span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span> <span class='op'>=</span> <span class='int'>0</span>
          <span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span> <span class='op'>=</span> <span class='int'>0</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_fnd_slab_under'>fnd_slab_under</span> <span class='op'>=</span> <span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UnderSlabInsulation/Layer[InstallationType=&#39;continuous&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_slab_under'>fnd_slab_under</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NominalRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_slab'>fnd_slab</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UnderSlabInsulationWidth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FloorConstructions.html" title="FloorConstructions (class)">FloorConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_slab_under_rvalue_width'>get_default_slab_under_rvalue_width</span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>or</span> <span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span> <span class='op'>==</span> <span class='int'>0</span>
          <span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span> <span class='op'>=</span> <span class='int'>0</span>
          <span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span> <span class='op'>=</span> <span class='int'>0</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_num_slabs'>num_slabs</span> <span class='op'>&gt;</span> <span class='int'>1</span>
        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot currently handle multiple Foundation/Slab elements.</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># FIXME
</span>      <span class='kw'>end</span>

      <span class='comment'># Foundation wall surfaces
</span>
      <span class='id identifier rubyid_fnd_id'>fnd_id</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_wall_surface'>wall_surface</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_wall_height'>wall_height</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_cav_r'>wall_cav_r</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_cav_depth'>wall_cav_depth</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_grade'>wall_grade</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_ff'>wall_ff</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_cont_height'>wall_cont_height</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_cont_r'>wall_cont_r</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_wall_cont_depth'>wall_cont_depth</span><span class='comma'>,</span> <span class='id identifier rubyid_walls_filled_cavity'>walls_filled_cavity</span><span class='comma'>,</span> <span class='id identifier rubyid_walls_drywall_thick_in'>walls_drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_walls_concrete_thick_in'>walls_concrete_thick_in</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_film_r'>wall_film_r</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_num_walls'>num_walls</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FoundationWall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='op'>|</span>
        <span class='id identifier rubyid_num_walls'>num_walls</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_wall_id'>wall_id</span> <span class='op'>=</span> <span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_wall_height'>wall_height</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Height</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_wall_gross_area'>wall_gross_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>=</span> <span class='id identifier rubyid_net_wall_area'>net_wall_area</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_gross_area'>wall_gross_area</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_fnd_id'>fnd_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Calculated a negative net surface area for Wall &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_wall_length'>wall_length</span> <span class='op'>=</span> <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>/</span> <span class='id identifier rubyid_wall_height'>wall_height</span>

        <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span> <span class='op'>*</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DepthBelowGrade</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='comment'># TODO
</span>        <span class='kw'>end</span>

        <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_length'>wall_length</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_height'>wall_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                  <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_wall_length'>wall_length</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_exterior'>set_surface_exterior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_wall_surface'>wall_surface</span> <span class='op'>=</span> <span class='id identifier rubyid_surface'>surface</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_is_external_thermal_boundary'>is_external_thermal_boundary</span><span class='lparen'>(</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_walls_drywall_thick_in'>walls_drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_walls_drywall_thick_in'>walls_drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_walls_filled_cavity'>walls_filled_cavity</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_walls_concrete_thick_in'>walls_concrete_thick_in</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Thickness</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Insulation/AssemblyEffectiveRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='const'><span class='object_link'><a href="FoundationConstructions.html" title="FoundationConstructions (class)">FoundationConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_basement_wall_ufactor'><span class='object_link'><a href="FoundationConstructions.html#get_default_basement_wall_ufactor-class_method" title="FoundationConstructions.get_default_basement_wall_ufactor (method)">get_default_basement_wall_ufactor</a></span></span><span class='lparen'>(</span><span class='ivar'>@iecc_zone_2006</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_wall_film_r'>wall_film_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmVertical-class_method" title="Material.AirFilmVertical (method)">AirFilmVertical</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
        <span class='id identifier rubyid_wall_cav_r'>wall_cav_r</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_wall_cav_depth'>wall_cav_depth</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_wall_grade'>wall_grade</span> <span class='op'>=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_wall_ff'>wall_ff</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_wall_cont_height'>wall_cont_height</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_wall'>fnd_wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Height</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_wall_cont_r'>wall_cont_r</span> <span class='op'>=</span> <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Concrete-class_method" title="Material.Concrete (method)">Concrete</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_walls_concrete_thick_in'>walls_concrete_thick_in</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#GypsumWall-class_method" title="Material.GypsumWall (method)">GypsumWall</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_walls_drywall_thick_in'>walls_drywall_thick_in</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>-</span> <span class='id identifier rubyid_wall_film_r'>wall_film_r</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_wall_cont_r'>wall_cont_r</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='comment'># Try without drywall
</span>          <span class='id identifier rubyid_walls_drywall_thick_in'>walls_drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.0</span>
          <span class='id identifier rubyid_wall_cont_r'>wall_cont_r</span> <span class='op'>=</span> <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Concrete-class_method" title="Material.Concrete (method)">Concrete</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_walls_concrete_thick_in'>walls_concrete_thick_in</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#GypsumWall-class_method" title="Material.GypsumWall (method)">GypsumWall</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_walls_drywall_thick_in'>walls_drywall_thick_in</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>-</span> <span class='id identifier rubyid_wall_film_r'>wall_film_r</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_wall_cont_depth'>wall_cont_depth</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_num_walls'>num_walls</span> <span class='op'>&gt;</span> <span class='int'>1</span>
        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot currently handle multiple Foundation/FoundationWall elements.</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># FIXME
</span>      <span class='kw'>end</span>

      <span class='comment'># Foundation ceiling surfaces
</span>
      <span class='id identifier rubyid_ceiling_surfaces'>ceiling_surfaces</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_floor_cav_r'>floor_cav_r</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_cav_depth'>floor_cav_depth</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_grade'>floor_grade</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_ff'>floor_ff</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_cont_r'>floor_cont_r</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_plywood_thick_in'>plywood_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_floor_covering'>mat_floor_covering</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_carpet'>mat_carpet</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_film_r'>floor_film_r</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FrameFloor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fnd_floor'>fnd_floor</span><span class='op'>|</span>
        <span class='id identifier rubyid_floor_id'>floor_id</span> <span class='op'>=</span> <span class='id identifier rubyid_fnd_floor'>fnd_floor</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_floor'>fnd_floor</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_framefloor_area'>framefloor_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_floor'>fnd_floor</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_framefloor_width'>framefloor_width</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_framefloor_area'>framefloor_area</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_framefloor_length'>framefloor_length</span> <span class='op'>=</span> <span class='id identifier rubyid_framefloor_area'>framefloor_area</span> <span class='op'>/</span> <span class='id identifier rubyid_framefloor_width'>framefloor_width</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_foundation_type'>foundation_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ambient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='float'>2.0</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_foundation_type'>foundation_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SlabOnGrade</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_foundation_type'>foundation_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Basement</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>or</span> <span class='id identifier rubyid_foundation_type'>foundation_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Crawlspace</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span> <span class='op'>*</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_foundation'>foundation</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FoundationWall/DepthBelowGrade</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>+</span>
                     <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_foundation'>foundation</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FoundationWall/Height</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_floor_polygon'>add_floor_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_framefloor_length'>framefloor_length</span><span class='comma'>,</span> <span class='id identifier rubyid_framefloor_width'>framefloor_width</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_floor_id'>floor_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># pier &amp; beam foundation
</span>          <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Floor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_id'>floor_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_set_surface_exterior'>set_surface_exterior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_id'>floor_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RoofCeiling</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_id'>floor_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_set_surface_exterior'>set_surface_exterior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_id'>floor_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSunExposure'>setSunExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setWindExposure'>setWindExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoWind</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_ceiling_surfaces'>ceiling_surfaces</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_surface'>surface</span>

        <span class='id identifier rubyid_floor_film_r'>floor_film_r</span> <span class='op'>=</span> <span class='float'>2.0</span> <span class='op'>*</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmFloorReduced-class_method" title="Material.AirFilmFloorReduced (method)">AirFilmFloorReduced</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>

        <span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_floor'>fnd_floor</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Insulation/AssemblyEffectiveRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='const'><span class='object_link'><a href="FloorConstructions.html" title="FloorConstructions (class)">FloorConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_floor_ufactor'><span class='object_link'><a href="FloorConstructions.html#get_default_floor_ufactor-class_method" title="FloorConstructions.get_default_floor_ufactor (method)">get_default_floor_ufactor</a></span></span><span class='lparen'>(</span><span class='ivar'>@iecc_zone_2006</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x6-class_method" title="Material.Stud2x6 (method)">Stud2x6</a></span></span><span class='comma'>,</span> <span class='float'>0.10</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.75</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#CoveringBare-class_method" title="Material.CoveringBare (method)">CoveringBare</a></span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 2x6, 24&quot; o.c.
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.13</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#CoveringBare-class_method" title="Material.CoveringBare (method)">CoveringBare</a></span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 2x4, 16&quot; o.c.
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># Fallback
</span>        <span class='rbracket'>]</span>
        <span class='id identifier rubyid_floor_constr_set'>floor_constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_cav_r'>floor_cav_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_wood_stud_construction_set'>pick_wood_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_film_r'>floor_film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foundation framefloor </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_floor_id'>floor_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_mat_floor_covering'>mat_floor_covering</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_mat_carpet'>mat_carpet</span> <span class='op'>=</span> <span class='id identifier rubyid_floor_constr_set'>floor_constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span>
        <span class='id identifier rubyid_plywood_thick_in'>plywood_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_floor_constr_set'>floor_constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span>
        <span class='id identifier rubyid_floor_cav_depth'>floor_cav_depth</span> <span class='op'>=</span> <span class='id identifier rubyid_floor_constr_set'>floor_constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span>
        <span class='id identifier rubyid_floor_ff'>floor_ff</span> <span class='op'>=</span> <span class='id identifier rubyid_floor_constr_set'>floor_constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span>
        <span class='id identifier rubyid_floor_cont_r'>floor_cont_r</span> <span class='op'>=</span> <span class='id identifier rubyid_floor_constr_set'>floor_constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span>
        <span class='id identifier rubyid_floor_grade'>floor_grade</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='kw'>end</span>

      <span class='comment'># Apply constructions
</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_wall_surface'>wall_surface</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='id identifier rubyid_slab_surface'>slab_surface</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

        <span class='comment'># nop
</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_surface'>wall_surface</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

        <span class='comment'># Foundation slab only
</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FoundationConstructions.html" title="FoundationConstructions (class)">FoundationConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_slab'><span class='object_link'><a href="FoundationConstructions.html#apply_slab-class_method" title="FoundationConstructions.apply_slab (method)">apply_slab</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_surface'>slab_surface</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SlabConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                     <span class='id identifier rubyid_slab_perim_r'>slab_perim_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_perim_width'>slab_perim_width</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_gap_r'>slab_gap_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_ext_r'>slab_ext_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_ext_depth'>slab_ext_depth</span><span class='comma'>,</span>
                                                     <span class='id identifier rubyid_slab_whole_r'>slab_whole_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_concrete_thick_in'>slab_concrete_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_carpet'>mat_carpet</span><span class='comma'>,</span>
                                                     <span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_perim_exp'>perim_exp</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='comment'># FIXME: Temporary code for sizing
</span>        <span class='id identifier rubyid_slab_surface'>slab_surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SizingInfoSlabRvalue-class_method" title="Constants.SizingInfoSlabRvalue (method)">SizingInfoSlabRvalue</a></span></span><span class='comma'>,</span> <span class='float'>5.0</span><span class='rparen'>)</span>

      <span class='kw'>else</span>

        <span class='comment'># Foundation slab, walls, and ceilings
</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_slab_surface'>slab_surface</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='comment'># Handle crawlspace without a slab (i.e., dirt floor)
</span>        <span class='kw'>end</span>

        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FoundationConstructions.html" title="FoundationConstructions (class)">FoundationConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_walls_and_slab'><span class='object_link'><a href="FoundationConstructions.html#apply_walls_and_slab-class_method" title="FoundationConstructions.apply_walls_and_slab (method)">apply_walls_and_slab</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_wall_surface'>wall_surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FndWallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                               <span class='id identifier rubyid_wall_cont_height'>wall_cont_height</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_cav_r'>wall_cav_r</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_grade'>wall_grade</span><span class='comma'>,</span>
                                                               <span class='id identifier rubyid_wall_cav_depth'>wall_cav_depth</span><span class='comma'>,</span> <span class='id identifier rubyid_walls_filled_cavity'>walls_filled_cavity</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_ff'>wall_ff</span><span class='comma'>,</span>
                                                               <span class='id identifier rubyid_wall_cont_r'>wall_cont_r</span><span class='comma'>,</span> <span class='id identifier rubyid_walls_drywall_thick_in'>walls_drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_walls_concrete_thick_in'>walls_concrete_thick_in</span><span class='comma'>,</span>
                                                               <span class='id identifier rubyid_wall_height'>wall_height</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_surface'>slab_surface</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SlabConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                               <span class='id identifier rubyid_slab_whole_r'>slab_whole_r</span><span class='comma'>,</span> <span class='id identifier rubyid_slab_concrete_thick_in'>slab_concrete_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_perim_exp'>perim_exp</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_check_surface_assembly_rvalue'>check_surface_assembly_rvalue</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_surface'>wall_surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_film_r'>wall_film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_assembly_r'>wall_assembly_r</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>

      <span class='comment'># Foundation ceiling
</span>      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FloorConstructions.html" title="FloorConstructions (class)">FloorConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_foundation_ceiling'><span class='object_link'><a href="FloorConstructions.html#apply_foundation_ceiling-class_method" title="FloorConstructions.apply_foundation_ceiling (method)">apply_foundation_ceiling</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_ceiling_surfaces'>ceiling_surfaces</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FndCeilingConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_floor_cav_r'>floor_cav_r</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_grade'>floor_grade</span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_floor_ff'>floor_ff</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_cav_depth'>floor_cav_depth</span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_plywood_thick_in'>plywood_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_floor_covering'>mat_floor_covering</span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_mat_carpet'>mat_carpet</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_check_surface_assembly_rvalue'>check_surface_assembly_rvalue</span><span class='lparen'>(</span><span class='id identifier rubyid_ceiling_surfaces'>ceiling_surfaces</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_film_r'>floor_film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_assembly_r'>floor_assembly_r</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_finished_floor_area'>add_finished_floor_area</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ffa'>ffa</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/ConditionedFloorArea</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>

    <span class='comment'># First check if we need to add a finished basement ceiling
</span>    <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='id identifier rubyid_get_foundation_top'>get_foundation_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getThermalZones'>getThermalZones</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_zone'>zone</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_is_finished_basement'><span class='object_link'><a href="Geometry.html#is_finished_basement-class_method" title="Geometry.is_finished_basement (method)">is_finished_basement</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_zone'>zone</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_floor_area'>floor_area</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_finished_floor_area_from_spaces'><span class='object_link'><a href="Geometry.html#get_finished_floor_area_from_spaces-class_method" title="Geometry.get_finished_floor_area_from_spaces (method)">get_finished_floor_area_from_spaces</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_ceiling_area'>ceiling_area</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_spaces'>spaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_space'>space</span><span class='op'>|</span>
        <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_surfaces'>surfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_surface'>surface</span><span class='op'>|</span>
          <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_surfaceType'>surfaceType</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>roofceiling</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_ceiling_area'>ceiling_area</span> <span class='op'>+=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_grossArea'>grossArea</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m^2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft^2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span> <span class='op'>=</span> <span class='id identifier rubyid_floor_area'>floor_area</span> <span class='op'>-</span> <span class='id identifier rubyid_ceiling_area'>ceiling_area</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerWarning'>registerWarning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Adding finished basement adiabatic ceiling with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> ft^2.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_finishedfloor_width'>finishedfloor_width</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_finishedfloor_length'>finishedfloor_length</span> <span class='op'>=</span> <span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span> <span class='op'>/</span> <span class='id identifier rubyid_finishedfloor_width'>finishedfloor_width</span>
        <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span>

        <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_ceiling_polygon'>add_ceiling_polygon</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_finishedfloor_width'>finishedfloor_width</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_finishedfloor_length'>finishedfloor_length</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSunExposure'>setSunExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setWindExposure'>setWindExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoWind</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>inferred finished basement ceiling</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RoofCeiling</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_spaces'>spaces</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_createAdjacentSurface'>createAdjacentSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeLiving-class_method" title="Constants.SpaceTypeLiving (method)">SpaceTypeLiving</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>

        <span class='comment'># Apply Construction
</span>        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_adiabatic_construction'>apply_adiabatic_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>floor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Next check if we need to add floors between finished spaces (e.g., 2-story buildings).
</span>
    <span class='comment'># Calculate ffa already added to model
</span>    <span class='id identifier rubyid_model_ffa'>model_ffa</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_finished_floor_area_from_spaces'><span class='object_link'><a href="Geometry.html#get_finished_floor_area_from_spaces-class_method" title="Geometry.get_finished_floor_area_from_spaces (method)">get_finished_floor_area_from_spaces</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getSpaces'>getSpaces</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_nstories_ag'>nstories_ag</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/NumberofConditionedFloorsAboveGrade</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_model_ffa'>model_ffa</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_ffa'>ffa</span>
      <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerError'>registerError</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sum of conditioned floor surface areas </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_model_ffa'>model_ffa</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> is greater than ConditionedFloorArea specified </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ffa'>ffa</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span> <span class='op'>=</span> <span class='id identifier rubyid_ffa'>ffa</span> <span class='op'>-</span> <span class='id identifier rubyid_model_ffa'>model_ffa</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span> <span class='op'>&gt;</span> <span class='int'>0</span>

    <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_registerWarning'>registerWarning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Adding adiabatic conditioned floor with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> ft^2 to preserve building total conditioned floor area.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_finishedfloor_width'>finishedfloor_width</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_finishedfloor_length'>finishedfloor_length</span> <span class='op'>=</span> <span class='id identifier rubyid_addtl_ffa'>addtl_ffa</span> <span class='op'>/</span> <span class='id identifier rubyid_finishedfloor_width'>finishedfloor_width</span>
    <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>+</span> <span class='float'>8.0</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_nstories_ag'>nstories_ag</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_floor_polygon'>add_floor_polygon</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_finishedfloor_width'>finishedfloor_width</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_finishedfloor_length'>finishedfloor_length</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSunExposure'>setSunExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setWindExposure'>setWindExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoWind</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>inferred finished floor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Floor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeLiving-class_method" title="Constants.SpaceTypeLiving (method)">SpaceTypeLiving</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setOutsideBoundaryCondition'>setOutsideBoundaryCondition</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Adiabatic</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='comment'># Apply Construction
</span>    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_adiabatic_construction'>apply_adiabatic_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>floor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_thermal_mass'>add_thermal_mass</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span>
    <span class='id identifier rubyid_partition_frac_of_ffa'>partition_frac_of_ffa</span> <span class='op'>=</span> <span class='float'>1.0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="ThermalMassConstructions.html" title="ThermalMassConstructions (class)">ThermalMassConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_partition_walls'>apply_partition_walls</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                             <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PartitionWallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                             <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_partition_frac_of_ffa'>partition_frac_of_ffa</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='comment'># FIXME ?
</span>    <span class='id identifier rubyid_furniture_frac_of_ffa'>furniture_frac_of_ffa</span> <span class='op'>=</span> <span class='float'>1.0</span>
    <span class='id identifier rubyid_mass_lb_per_sqft'>mass_lb_per_sqft</span> <span class='op'>=</span> <span class='float'>8.0</span>
    <span class='id identifier rubyid_density_lb_per_cuft'>density_lb_per_cuft</span> <span class='op'>=</span> <span class='float'>40.0</span>
    <span class='id identifier rubyid_mat'>mat</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Wood-class_method" title="BaseMaterial.Wood (method)">Wood</a></span></span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="ThermalMassConstructions.html" title="ThermalMassConstructions (class)">ThermalMassConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_furniture'>apply_furniture</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_furniture_frac_of_ffa'>furniture_frac_of_ffa</span><span class='comma'>,</span>
                                                       <span class='id identifier rubyid_mass_lb_per_sqft'>mass_lb_per_sqft</span><span class='comma'>,</span> <span class='id identifier rubyid_density_lb_per_cuft'>density_lb_per_cuft</span><span class='comma'>,</span> <span class='id identifier rubyid_mat'>mat</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_walls'>add_walls</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='id identifier rubyid_get_foundation_top'>get_foundation_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_nstories_ag'>nstories_ag</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/BuildingConstruction/NumberofConditionedFloorsAboveGrade</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Walls/Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wall'>wall</span><span class='op'>|</span>
      <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>InteriorAdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ExteriorAdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_wall_id'>wall_id</span> <span class='op'>=</span> <span class='id identifier rubyid_wall'>wall</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_wall_gross_area'>wall_gross_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>=</span> <span class='id identifier rubyid_net_wall_area'>net_wall_area</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_gross_area'>wall_gross_area</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Calculated a negative net surface area for Wall &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_wall_height'>wall_height</span> <span class='op'>=</span> <span class='float'>8.0</span> <span class='op'>*</span> <span class='id identifier rubyid_nstories_ag'>nstories_ag</span>
      <span class='id identifier rubyid_wall_length'>wall_length</span> <span class='op'>=</span> <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>/</span> <span class='id identifier rubyid_wall_height'>wall_height</span>
      <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span>
      <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='comment'># TODO
</span>      <span class='kw'>end</span>

      <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_length'>wall_length</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_height'>wall_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_wall_length'>wall_length</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_set_surface_exterior'>set_surface_exterior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSunExposure'>setSunExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setWindExposure'>setWindExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoWind</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Apply construction
</span>      <span class='comment'># The code below constructs a reasonable wall construction based on the
</span>      <span class='comment'># wall type while ensuring the correct assembly R-value.
</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_is_external_thermal_boundary'>is_external_thermal_boundary</span><span class='lparen'>(</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_film_r'>film_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmVertical-class_method" title="Material.AirFilmVertical (method)">AirFilmVertical</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmOutside-class_method" title="Material.AirFilmOutside (method)">AirFilmOutside</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
        <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#ExtFinishWoodLight-class_method" title="Material.ExtFinishWoodLight (method)">ExtFinishWoodLight</a></span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_film_r'>film_r</span> <span class='op'>=</span> <span class='float'>2.0</span> <span class='op'>*</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmVertical-class_method" title="Material.AirFilmVertical (method)">AirFilmVertical</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
        <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_solar_abs'>solar_abs</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SolarAbsorptance</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_emitt'>emitt</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Emittance</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Insulation/AssemblyEffectiveRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_child_name'><span class='object_link'><a href="XMLHelper.html#get_child_name-class_method" title="XMLHelper.get_child_name (method)">get_child_name</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_apply_wall_construction'>apply_wall_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_type'>wall_type</span><span class='comma'>,</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span>
                              <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='comma'>,</span> <span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='comma'>,</span> <span class='id identifier rubyid_emitt'>emitt</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_rim_joists'>add_rim_joists</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='id identifier rubyid_get_foundation_top'>get_foundation_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/RimJoists/RimJoist</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rim_joist'>rim_joist</span><span class='op'>|</span>
      <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rim_joist'>rim_joist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>InteriorAdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rim_joist'>rim_joist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ExteriorAdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_rim_joist_id'>rim_joist_id</span> <span class='op'>=</span> <span class='id identifier rubyid_rim_joist'>rim_joist</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_rim_joist_area'>rim_joist_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rim_joist'>rim_joist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_rim_joist_height'>rim_joist_height</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='id identifier rubyid_rim_joist_length'>rim_joist_length</span> <span class='op'>=</span> <span class='id identifier rubyid_rim_joist_area'>rim_joist_area</span> <span class='op'>/</span> <span class='id identifier rubyid_rim_joist_height'>rim_joist_height</span>
      <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span>
      <span class='id identifier rubyid_rim_joist_azimuth'>rim_joist_azimuth</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rim_joist'>rim_joist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_rim_joist_azimuth'>rim_joist_azimuth</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_rim_joist_azimuth'>rim_joist_azimuth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_rim_joist_azimuth'>rim_joist_azimuth</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_rim_joist_azimuth'>rim_joist_azimuth</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='comment'># TODO
</span>      <span class='kw'>end</span>

      <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_rim_joist_length'>rim_joist_length</span><span class='comma'>,</span> <span class='id identifier rubyid_rim_joist_height'>rim_joist_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                <span class='id identifier rubyid_rim_joist_azimuth'>rim_joist_azimuth</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_rim_joist_length'>rim_joist_length</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_rim_joist_azimuth'>rim_joist_azimuth</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_rim_joist_id'>rim_joist_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_rim_joist_id'>rim_joist_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_set_surface_exterior'>set_surface_exterior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_rim_joist_id'>rim_joist_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSunExposure'>setSunExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setWindExposure'>setWindExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoWind</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Apply construction
</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_is_external_thermal_boundary'>is_external_thermal_boundary</span><span class='lparen'>(</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_film_r'>film_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmVertical-class_method" title="Material.AirFilmVertical (method)">AirFilmVertical</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmOutside-class_method" title="Material.AirFilmOutside (method)">AirFilmOutside</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
        <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#ExtFinishWoodLight-class_method" title="Material.ExtFinishWoodLight (method)">ExtFinishWoodLight</a></span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_film_r'>film_r</span> <span class='op'>=</span> <span class='float'>2.0</span> <span class='op'>*</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmVertical-class_method" title="Material.AirFilmVertical (method)">AirFilmVertical</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
        <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_solar_abs'>solar_abs</span> <span class='op'>=</span> <span class='float'>0.75</span>
      <span class='id identifier rubyid_emitt'>emitt</span> <span class='op'>=</span> <span class='float'>0.9</span>

      <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rim_joist'>rim_joist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Insulation/AssemblyEffectiveRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x-class_method" title="Material.Stud2x (method)">Stud2x</a></span></span><span class='lparen'>(</span><span class='float'>2.0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='float'>0.17</span><span class='comma'>,</span> <span class='float'>10.0</span><span class='comma'>,</span> <span class='float'>2.0</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 2x4 + R10
</span>        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x-class_method" title="Material.Stud2x (method)">Stud2x</a></span></span><span class='lparen'>(</span><span class='float'>2.0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='float'>0.17</span><span class='comma'>,</span> <span class='float'>5.0</span><span class='comma'>,</span> <span class='float'>2.0</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>   <span class='comment'># 2x4 + R5
</span>        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x-class_method" title="Material.Stud2x (method)">Stud2x</a></span></span><span class='lparen'>(</span><span class='float'>2.0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='float'>0.17</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>2.0</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>   <span class='comment'># 2x4
</span>        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x-class_method" title="Material.Stud2x (method)">Stud2x</a></span></span><span class='lparen'>(</span><span class='float'>2.0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                           <span class='comment'># Fallback
</span>      <span class='rbracket'>]</span>
      <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_wood_stud_construction_set'>pick_wood_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rim joist </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rim_joist_id'>rim_joist_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_install_grade'>install_grade</span> <span class='op'>=</span> <span class='int'>1</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_rim_joist'><span class='object_link'><a href="WallConstructions.html#apply_rim_joist-class_method" title="WallConstructions.apply_rim_joist (method)">apply_rim_joist</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RimJoistConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_cavity_r'>cavity_r</span><span class='comma'>,</span> <span class='id identifier rubyid_install_grade'>install_grade</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='id identifier rubyid_check_surface_assembly_rvalue'>check_surface_assembly_rvalue</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_apply_solar_abs_emittance_to_construction'>apply_solar_abs_emittance_to_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='comma'>,</span> <span class='id identifier rubyid_emitt'>emitt</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_attics'>add_attics</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_walls_top'>walls_top</span> <span class='op'>=</span> <span class='id identifier rubyid_get_walls_top'>get_walls_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Attics/Attic</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attic'>attic</span><span class='op'>|</span>
      <span class='id identifier rubyid_attic_type'>attic_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_attic'>attic</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AtticType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span> <span class='op'>=</span> <span class='id identifier rubyid_get_attic_adjacent_to'>get_attic_adjacent_to</span><span class='lparen'>(</span><span class='id identifier rubyid_attic_type'>attic_type</span><span class='rparen'>)</span>

      <span class='comment'># Attic floors
</span>      <span class='id identifier rubyid_attic'>attic</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Floors/Floor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_floor'>floor</span><span class='op'>|</span>
        <span class='id identifier rubyid_floor_id'>floor_id</span> <span class='op'>=</span> <span class='id identifier rubyid_floor'>floor</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_floor'>floor</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_floor_area'>floor_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_floor'>floor</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_floor_width'>floor_width</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_floor_area'>floor_area</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_floor_length'>floor_length</span> <span class='op'>=</span> <span class='id identifier rubyid_floor_area'>floor_area</span> <span class='op'>/</span> <span class='id identifier rubyid_floor_width'>floor_width</span>
        <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_walls_top'>walls_top</span>

        <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_floor_polygon'>add_floor_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_floor_length'>floor_length</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_width'>floor_width</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSunExposure'>setSunExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setWindExposure'>setWindExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoWind</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_floor_id'>floor_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Floor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_id'>floor_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_exterior'>set_surface_exterior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_floor_id'>floor_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>

        <span class='comment'># Apply construction
</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_is_external_thermal_boundary'>is_external_thermal_boundary</span><span class='lparen'>(</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_film_r'>film_r</span> <span class='op'>=</span> <span class='int'>2</span> <span class='op'>*</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmFloorAverage-class_method" title="Material.AirFilmFloorAverage (method)">AirFilmFloorAverage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>

        <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_floor'>floor</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Insulation/AssemblyEffectiveRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FloorConstructions.html" title="FloorConstructions (class)">FloorConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_ceiling_ufactor'><span class='object_link'><a href="FloorConstructions.html#get_default_ceiling_ufactor-class_method" title="FloorConstructions.get_default_ceiling_ufactor (method)">get_default_ceiling_ufactor</a></span></span><span class='lparen'>(</span><span class='ivar'>@iecc_zone_2006</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x6-class_method" title="Material.Stud2x6 (method)">Stud2x6</a></span></span><span class='comma'>,</span> <span class='float'>0.11</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 2x6, 24&quot; o.c.
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.24</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 2x4, 16&quot; o.c.
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># Fallback
</span>        <span class='rbracket'>]</span>

        <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_ceiling_r'>ceiling_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_wood_stud_construction_set'>pick_wood_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic floor </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_floor_id'>floor_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_ceiling_joist_height_in'>ceiling_joist_height_in</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span>
        <span class='id identifier rubyid_ceiling_ins_thick_in'>ceiling_ins_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_ceiling_joist_height_in'>ceiling_joist_height_in</span>
        <span class='id identifier rubyid_ceiling_framing_factor'>ceiling_framing_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span>
        <span class='id identifier rubyid_ceiling_drywall_thick_in'>ceiling_drywall_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span>
        <span class='id identifier rubyid_ceiling_install_grade'>ceiling_install_grade</span> <span class='op'>=</span> <span class='int'>1</span>

        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FloorConstructions.html" title="FloorConstructions (class)">FloorConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_unfinished_attic'><span class='object_link'><a href="FloorConstructions.html#apply_unfinished_attic-class_method" title="FloorConstructions.apply_unfinished_attic (method)">apply_unfinished_attic</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FloorConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_ceiling_r'>ceiling_r</span><span class='comma'>,</span> <span class='id identifier rubyid_ceiling_install_grade'>ceiling_install_grade</span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_ceiling_ins_thick_in'>ceiling_ins_thick_in</span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_ceiling_framing_factor'>ceiling_framing_factor</span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_ceiling_joist_height_in'>ceiling_joist_height_in</span><span class='comma'>,</span>
                                                            <span class='id identifier rubyid_ceiling_drywall_thick_in'>ceiling_drywall_thick_in</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='id identifier rubyid_check_surface_assembly_rvalue'>check_surface_assembly_rvalue</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Attic roofs
</span>      <span class='id identifier rubyid_attic'>attic</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Roofs/Roof</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_roof'>roof</span><span class='op'>|</span>
        <span class='id identifier rubyid_roof_id'>roof_id</span> <span class='op'>=</span> <span class='id identifier rubyid_roof'>roof</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_roof_gross_area'>roof_gross_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_roof'>roof</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_roof_net_area'>roof_net_area</span> <span class='op'>=</span> <span class='id identifier rubyid_net_wall_area'>net_wall_area</span><span class='lparen'>(</span><span class='id identifier rubyid_roof_gross_area'>roof_gross_area</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_roof_id'>roof_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_roof_width'>roof_width</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_roof_net_area'>roof_net_area</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_roof_length'>roof_length</span> <span class='op'>=</span> <span class='id identifier rubyid_roof_net_area'>roof_net_area</span> <span class='op'>/</span> <span class='id identifier rubyid_roof_width'>roof_width</span>
        <span class='id identifier rubyid_roof_tilt'>roof_tilt</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_roof'>roof</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pitch</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>12.0</span>
        <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_walls_top'>walls_top</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='id identifier rubyid_roof_tilt'>roof_tilt</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_roof_width'>roof_width</span>
        <span class='id identifier rubyid_roof_azimuth'>roof_azimuth</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_roof'>roof</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_roof_azimuth'>roof_azimuth</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_roof_azimuth'>roof_azimuth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_roof_azimuth'>roof_azimuth</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_roof_azimuth'>roof_azimuth</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='comment'># TODO
</span>        <span class='kw'>end</span>

        <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_roof_polygon'>add_roof_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_roof_length'>roof_length</span><span class='comma'>,</span> <span class='id identifier rubyid_roof_width'>roof_width</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                  <span class='id identifier rubyid_roof_azimuth'>roof_azimuth</span><span class='comma'>,</span> <span class='id identifier rubyid_roof_tilt'>roof_tilt</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_roof_length'>roof_length</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Width</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_roof_width'>roof_width</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tilt</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_roof_tilt'>roof_tilt</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_roof_azimuth'>roof_azimuth</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_roof_id'>roof_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RoofCeiling</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setOutsideBoundaryCondition'>setOutsideBoundaryCondition</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outdoors</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_roof_id'>roof_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>

        <span class='comment'># Apply construction
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_is_external_thermal_boundary'>is_external_thermal_boundary</span><span class='lparen'>(</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_film_r'>film_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmOutside-class_method" title="Material.AirFilmOutside (method)">AirFilmOutside</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmRoof-class_method" title="Material.AirFilmRoof (method)">AirFilmRoof</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_roof_pitch'><span class='object_link'><a href="Geometry.html#get_roof_pitch-class_method" title="Geometry.get_roof_pitch (method)">get_roof_pitch</a></span></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
        <span class='id identifier rubyid_mat_roofing'>mat_roofing</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#RoofingAsphaltShinglesDark-class_method" title="Material.RoofingAsphaltShinglesDark (method)">RoofingAsphaltShinglesDark</a></span></span>
        <span class='id identifier rubyid_solar_abs'>solar_abs</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_roof'>roof</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SolarAbsorptance</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_emitt'>emitt</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_roof'>roof</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Emittance</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_roof'>roof</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Insulation/AssemblyEffectiveRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x-class_method" title="Material.Stud2x (method)">Stud2x</a></span></span><span class='lparen'>(</span><span class='float'>8.0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='float'>0.07</span><span class='comma'>,</span> <span class='float'>10.0</span><span class='comma'>,</span> <span class='float'>0.75</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_roofing'>mat_roofing</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 2x8, 24&quot; o.c. + R10
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x-class_method" title="Material.Stud2x (method)">Stud2x</a></span></span><span class='lparen'>(</span><span class='float'>8.0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='float'>0.07</span><span class='comma'>,</span> <span class='float'>5.0</span><span class='comma'>,</span> <span class='float'>0.75</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_roofing'>mat_roofing</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x8, 24&quot; o.c. + R5
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x-class_method" title="Material.Stud2x (method)">Stud2x</a></span></span><span class='lparen'>(</span><span class='float'>8.0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='float'>0.07</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.75</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_roofing'>mat_roofing</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x8, 24&quot; o.c.
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x6-class_method" title="Material.Stud2x6 (method)">Stud2x6</a></span></span><span class='comma'>,</span> <span class='float'>0.07</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.75</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_roofing'>mat_roofing</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x6, 24&quot; o.c.
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.07</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_roofing'>mat_roofing</span><span class='rparen'>)</span><span class='comma'>,</span>   <span class='comment'># 2x4, 16&quot; o.c.
</span>          <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                        <span class='comment'># Fallback
</span>        <span class='rbracket'>]</span>
        <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_roof_cavity_r'>roof_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_wood_stud_construction_set'>pick_wood_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic roof </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_roof_id'>roof_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_roof_install_grade'>roof_install_grade</span> <span class='op'>=</span> <span class='int'>1</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>&gt;</span> <span class='int'>0</span>
          <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="RoofConstructions.html" title="RoofConstructions (class)">RoofConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_finished_roof'><span class='object_link'><a href="RoofConstructions.html#apply_finished_roof-class_method" title="RoofConstructions.apply_finished_roof (method)">apply_finished_roof</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RoofConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                          <span class='id identifier rubyid_roof_cavity_r'>roof_cavity_r</span><span class='comma'>,</span> <span class='id identifier rubyid_roof_install_grade'>roof_install_grade</span><span class='comma'>,</span>
                                                          <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span>
                                                          <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                                          <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span>
                                                          <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span>
                                                          <span class='id identifier rubyid_mat_roofing'>mat_roofing</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_has_radiant_barrier'>has_radiant_barrier</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='comment'># TODO
</span>          <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="RoofConstructions.html" title="RoofConstructions (class)">RoofConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_unfinished_attic'><span class='object_link'><a href="RoofConstructions.html#apply_unfinished_attic-class_method" title="RoofConstructions.apply_unfinished_attic (method)">apply_unfinished_attic</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                             <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RoofConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                             <span class='id identifier rubyid_roof_cavity_r'>roof_cavity_r</span><span class='comma'>,</span> <span class='id identifier rubyid_roof_install_grade'>roof_install_grade</span><span class='comma'>,</span>
                                                             <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span>
                                                             <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                                             <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span>
                                                             <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span>
                                                             <span class='id identifier rubyid_mat_roofing'>mat_roofing</span><span class='comma'>,</span> <span class='id identifier rubyid_has_radiant_barrier'>has_radiant_barrier</span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_check_surface_assembly_rvalue'>check_surface_assembly_rvalue</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_apply_solar_abs_emittance_to_construction'>apply_solar_abs_emittance_to_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='comma'>,</span> <span class='id identifier rubyid_emitt'>emitt</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Attic walls
</span>      <span class='id identifier rubyid_attic'>attic</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Walls/Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wall'>wall</span><span class='op'>|</span>
        <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_wall_id'>wall_id</span> <span class='op'>=</span> <span class='id identifier rubyid_wall'>wall</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_wall_gross_area'>wall_gross_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>=</span> <span class='id identifier rubyid_net_wall_area'>net_wall_area</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_gross_area'>wall_gross_area</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Calculated a negative net surface area for Wall &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_wall_height'>wall_height</span> <span class='op'>=</span> <span class='float'>8.0</span>
        <span class='id identifier rubyid_wall_length'>wall_length</span> <span class='op'>=</span> <span class='id identifier rubyid_wall_net_area'>wall_net_area</span> <span class='op'>/</span> <span class='id identifier rubyid_wall_height'>wall_height</span>
        <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_walls_top'>walls_top</span>
        <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='comment'># TODO
</span>        <span class='kw'>end</span>

        <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_length'>wall_length</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_height'>wall_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                  <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_wall_length'>wall_length</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_wall_azimuth'>wall_azimuth</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_exterior'>set_surface_exterior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSunExposure'>setSunExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSun</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setWindExposure'>setWindExposure</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoWind</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='comment'># Apply construction
</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_is_external_thermal_boundary'>is_external_thermal_boundary</span><span class='lparen'>(</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_film_r'>film_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmVertical-class_method" title="Material.AirFilmVertical (method)">AirFilmVertical</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmOutside-class_method" title="Material.AirFilmOutside (method)">AirFilmOutside</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
          <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#ExtFinishWoodLight-class_method" title="Material.ExtFinishWoodLight (method)">ExtFinishWoodLight</a></span></span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_film_r'>film_r</span> <span class='op'>=</span> <span class='float'>2.0</span> <span class='op'>*</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#AirFilmVertical-class_method" title="Material.AirFilmVertical (method)">AirFilmVertical</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
          <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_solar_abs'>solar_abs</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SolarAbsorptance</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_emitt'>emitt</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Emittance</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_child_name'><span class='object_link'><a href="XMLHelper.html#get_child_name-class_method" title="XMLHelper.get_child_name (method)">get_child_name</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Insulation/AssemblyEffectiveRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_apply_wall_construction'>apply_wall_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_type'>wall_type</span><span class='comma'>,</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span>
                                <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='comma'>,</span> <span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='comma'>,</span> <span class='id identifier rubyid_emitt'>emitt</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_windows'>add_windows</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_cooling_season'>cooling_season</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='id identifier rubyid_get_foundation_top'>get_foundation_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_surfaces'>surfaces</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Windows/Window</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_window'>window</span><span class='op'>|</span>
      <span class='id identifier rubyid_window_id'>window_id</span> <span class='op'>=</span> <span class='id identifier rubyid_window'>window</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_window_height'>window_height</span> <span class='op'>=</span> <span class='float'>4.0</span> <span class='comment'># ft, default
</span>      <span class='id identifier rubyid_overhang_depth'>overhang_depth</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_window'>window</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Overhangs</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_overhang_depth'>overhang_depth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Overhangs/Depth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_overhang_distance_to_top'>overhang_distance_to_top</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Overhangs/DistanceToTopOfWindow</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_overhang_distance_to_bottom'>overhang_distance_to_bottom</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Overhangs/DistanceToBottomOfWindow</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_window_height'>window_height</span> <span class='op'>=</span> <span class='id identifier rubyid_overhang_distance_to_bottom'>overhang_distance_to_bottom</span> <span class='op'>-</span> <span class='id identifier rubyid_overhang_distance_to_top'>overhang_distance_to_top</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_window_area'>window_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_window_width'>window_width</span> <span class='op'>=</span> <span class='id identifier rubyid_window_area'>window_area</span> <span class='op'>/</span> <span class='id identifier rubyid_window_height'>window_height</span>
      <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span>
      <span class='id identifier rubyid_window_azimuth'>window_azimuth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_window_width'>window_width</span><span class='comma'>,</span> <span class='id identifier rubyid_window_height'>window_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                <span class='id identifier rubyid_window_azimuth'>window_azimuth</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='float'>0.001</span><span class='comma'>,</span> <span class='float'>0.001</span> <span class='op'>*</span> <span class='int'>2</span><span class='comma'>,</span> <span class='float'>0.001</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span> <span class='comment'># offsets B, L, T, R
</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_window_width'>window_width</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_window_azimuth'>window_azimuth</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>surface </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_window_id'>window_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface_space'>surface_space</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Walls/Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wall'>wall</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_wall'>wall</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_window'>window</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AttachedToWall</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>InteriorAdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_window_id'>window_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Attached wall &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_window'>window</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AttachedToWall</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; not found for window &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_window_id'>window_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setOutsideBoundaryCondition'>setOutsideBoundaryCondition</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outdoors</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># cannot be adiabatic or OS won&#39;t create subsurface
</span>      <span class='id identifier rubyid_surfaces'>surfaces</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_surface'>surface</span>

      <span class='id identifier rubyid_sub_surface'>sub_surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>SubSurface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_window_width'>window_width</span><span class='comma'>,</span> <span class='id identifier rubyid_window_height'>window_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                       <span class='id identifier rubyid_window_azimuth'>window_azimuth</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='op'>-</span><span class='float'>0.001</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='float'>0.001</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span> <span class='comment'># offsets B, L, T, R
</span>      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_window_id'>window_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurface'>setSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setSubSurfaceType'>setSubSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FixedWindow</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_overhang_depth'>overhang_depth</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_overhang'>overhang</span> <span class='op'>=</span> <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_addOverhang'>addOverhang</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_overhang_depth'>overhang_depth</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_overhang_distance_to_top'>overhang_distance_to_top</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_overhang'>overhang</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#ObjectNameOverhangs-class_method" title="Constants.ObjectNameOverhangs (method)">ObjectNameOverhangs</a></span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Apply construction
</span>      <span class='id identifier rubyid_ufactor'>ufactor</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_shgc'>shgc</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHGC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_default_shade_summer'>default_shade_summer</span><span class='comma'>,</span> <span class='id identifier rubyid_default_shade_winter'>default_shade_winter</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="SubsurfaceConstructions.html" title="SubsurfaceConstructions (class)">SubsurfaceConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_interior_shading_factors'><span class='object_link'><a href="SubsurfaceConstructions.html#get_default_interior_shading_factors-class_method" title="SubsurfaceConstructions.get_default_interior_shading_factors (method)">get_default_interior_shading_factors</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cool_shade_mult'>cool_shade_mult</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/InteriorShadingFactorSummer</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cool_shade_mult'>cool_shade_mult</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_cool_shade_mult'>cool_shade_mult</span> <span class='op'>=</span> <span class='id identifier rubyid_default_shade_summer'>default_shade_summer</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_cool_shade_mult'>cool_shade_mult</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_cool_shade_mult'>cool_shade_mult</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_heat_shade_mult'>heat_shade_mult</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_window'>window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/InteriorShadingFactorWinter</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_heat_shade_mult'>heat_shade_mult</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_heat_shade_mult'>heat_shade_mult</span> <span class='op'>=</span> <span class='id identifier rubyid_default_shade_winter'>default_shade_winter</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_heat_shade_mult'>heat_shade_mult</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_heat_shade_mult'>heat_shade_mult</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="SubsurfaceConstructions.html" title="SubsurfaceConstructions (class)">SubsurfaceConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_window'><span class='object_link'><a href="SubsurfaceConstructions.html#apply_window-class_method" title="SubsurfaceConstructions.apply_window (method)">apply_window</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                     <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WindowConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                     <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_cooling_season'>cooling_season</span><span class='comma'>,</span> <span class='id identifier rubyid_ufactor'>ufactor</span><span class='comma'>,</span> <span class='id identifier rubyid_shgc'>shgc</span><span class='comma'>,</span>
                                                     <span class='id identifier rubyid_heat_shade_mult'>heat_shade_mult</span><span class='comma'>,</span> <span class='id identifier rubyid_cool_shade_mult'>cool_shade_mult</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_adiabatic_construction'>apply_adiabatic_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surfaces'>surfaces</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_skylights'>add_skylights</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_cooling_season'>cooling_season</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_walls_top'>walls_top</span> <span class='op'>=</span> <span class='id identifier rubyid_get_walls_top'>get_walls_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_surfaces'>surfaces</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Skylights/Skylight</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_skylight'>skylight</span><span class='op'>|</span>
      <span class='id identifier rubyid_skylight_id'>skylight_id</span> <span class='op'>=</span> <span class='id identifier rubyid_skylight'>skylight</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

      <span class='comment'># Obtain skylight tilt from attached roof
</span>      <span class='id identifier rubyid_skylight_tilt'>skylight_tilt</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Attics/Attic</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attic'>attic</span><span class='op'>|</span>
        <span class='id identifier rubyid_attic_type'>attic_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_attic'>attic</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AtticType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_attic'>attic</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Roofs/Roof</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_roof'>roof</span><span class='op'>|</span>
          <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_roof'>roof</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_skylight'>skylight</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AttachedToRoof</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

          <span class='id identifier rubyid_skylight_tilt'>skylight_tilt</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_roof'>roof</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pitch</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>12.0</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_skylight_tilt'>skylight_tilt</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Attached roof &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_skylight'>skylight</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AttachedToRoof</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; not found for skylight &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_skylight_id'>skylight_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_skylight_area'>skylight_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_skylight'>skylight</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_skylight_height'>skylight_height</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_skylight_area'>skylight_area</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_skylight_width'>skylight_width</span> <span class='op'>=</span> <span class='id identifier rubyid_skylight_area'>skylight_area</span> <span class='op'>/</span> <span class='id identifier rubyid_skylight_height'>skylight_height</span>
      <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_walls_top'>walls_top</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='id identifier rubyid_skylight_tilt'>skylight_tilt</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_skylight_height'>skylight_height</span>
      <span class='id identifier rubyid_skylight_azimuth'>skylight_azimuth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_skylight'>skylight</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_roof_polygon'>add_roof_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_skylight_width'>skylight_width</span> <span class='op'>+</span> <span class='float'>0.001</span><span class='comma'>,</span> <span class='id identifier rubyid_skylight_height'>skylight_height</span> <span class='op'>+</span> <span class='float'>0.001</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                <span class='id identifier rubyid_skylight_azimuth'>skylight_azimuth</span><span class='comma'>,</span> <span class='id identifier rubyid_skylight_tilt'>skylight_tilt</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span> <span class='comment'># base surface must be at least slightly larger than subsurface
</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_skylight_width'>skylight_width</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Width</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_skylight_height'>skylight_height</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tilt</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_skylight_tilt'>skylight_tilt</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_skylight_azimuth'>skylight_azimuth</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>surface </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_skylight_id'>skylight_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RoofCeiling</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeLiving-class_method" title="Constants.SpaceTypeLiving (method)">SpaceTypeLiving</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='comment'># Ensures it is included in Manual J sizing
</span>      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setOutsideBoundaryCondition'>setOutsideBoundaryCondition</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outdoors</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># cannot be adiabatic or OS won&#39;t create subsurface
</span>      <span class='id identifier rubyid_surfaces'>surfaces</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_surface'>surface</span>

      <span class='id identifier rubyid_sub_surface'>sub_surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>SubSurface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_roof_polygon'>add_roof_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_skylight_width'>skylight_width</span><span class='comma'>,</span> <span class='id identifier rubyid_skylight_height'>skylight_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                       <span class='id identifier rubyid_skylight_azimuth'>skylight_azimuth</span><span class='comma'>,</span> <span class='id identifier rubyid_skylight_tilt'>skylight_tilt</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_skylight_id'>skylight_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurface'>setSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setSubSurfaceType'>setSubSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skylight</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='comment'># Apply construction
</span>      <span class='id identifier rubyid_ufactor'>ufactor</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_skylight'>skylight</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_shgc'>shgc</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_skylight'>skylight</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHGC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cool_shade_mult'>cool_shade_mult</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='id identifier rubyid_heat_shade_mult'>heat_shade_mult</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="SubsurfaceConstructions.html" title="SubsurfaceConstructions (class)">SubsurfaceConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_skylight'><span class='object_link'><a href="SubsurfaceConstructions.html#apply_skylight-class_method" title="SubsurfaceConstructions.apply_skylight (method)">apply_skylight</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                       <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SkylightConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                       <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_cooling_season'>cooling_season</span><span class='comma'>,</span> <span class='id identifier rubyid_ufactor'>ufactor</span><span class='comma'>,</span> <span class='id identifier rubyid_shgc'>shgc</span><span class='comma'>,</span>
                                                       <span class='id identifier rubyid_heat_shade_mult'>heat_shade_mult</span><span class='comma'>,</span> <span class='id identifier rubyid_cool_shade_mult'>cool_shade_mult</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_adiabatic_construction'>apply_adiabatic_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surfaces'>surfaces</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>roof</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_doors'>add_doors</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_subsurface_areas'>subsurface_areas</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='id identifier rubyid_get_foundation_top'>get_foundation_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_surfaces'>surfaces</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Doors/Door</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_door'>door</span><span class='op'>|</span>
      <span class='id identifier rubyid_door_id'>door_id</span> <span class='op'>=</span> <span class='id identifier rubyid_door'>door</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_door_area'>door_area</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_door'>door</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Area</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_door_area'>door_area</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_door_area'>door_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_door_area'>door_area</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_door_area'>door_area</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="SubsurfaceConstructions.html" title="SubsurfaceConstructions (class)">SubsurfaceConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_door_area'><span class='object_link'><a href="SubsurfaceConstructions.html#get_default_door_area-class_method" title="SubsurfaceConstructions.get_default_door_area (method)">get_default_door_area</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_door_height'>door_height</span> <span class='op'>=</span> <span class='float'>6.67</span> <span class='comment'># ft
</span>      <span class='id identifier rubyid_door_width'>door_width</span> <span class='op'>=</span> <span class='id identifier rubyid_door_area'>door_area</span> <span class='op'>/</span> <span class='id identifier rubyid_door_height'>door_height</span>
      <span class='id identifier rubyid_z_origin'>z_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span>
      <span class='id identifier rubyid_door_azimuth'>door_azimuth</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_door'>door</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_surface'>surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Surface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_door_width'>door_width</span><span class='comma'>,</span> <span class='id identifier rubyid_door_height'>door_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                <span class='id identifier rubyid_door_azimuth'>door_azimuth</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='float'>0.001</span><span class='comma'>,</span> <span class='float'>0.001</span><span class='comma'>,</span> <span class='float'>0.001</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span> <span class='comment'># offsets B, L, T, R
</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Length</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_door_width'>door_width</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_additionalProperties'>additionalProperties</span><span class='period'>.</span><span class='id identifier rubyid_setFeature'>setFeature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Azimuth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_door_azimuth'>door_azimuth</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>surface </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_door_id'>door_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurfaceType'>setSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_surface_space'>surface_space</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Walls/Wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wall'>wall</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_wall'>wall</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_door'>door</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AttachedToWall</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wall'>wall</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>InteriorAdjacentTo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_door_id'>door_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Attached wall &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_door'>door</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AttachedToWall</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; not found for door &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_door_id'>door_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setOutsideBoundaryCondition'>setOutsideBoundaryCondition</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outdoors</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># cannot be adiabatic or OS won&#39;t create subsurface
</span>      <span class='id identifier rubyid_surfaces'>surfaces</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_surface'>surface</span>

      <span class='id identifier rubyid_sub_surface'>sub_surface</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>SubSurface</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_add_wall_polygon'>add_wall_polygon</span><span class='lparen'>(</span><span class='id identifier rubyid_door_width'>door_width</span><span class='comma'>,</span> <span class='id identifier rubyid_door_height'>door_height</span><span class='comma'>,</span> <span class='id identifier rubyid_z_origin'>z_origin</span><span class='comma'>,</span>
                                                                       <span class='id identifier rubyid_door_azimuth'>door_azimuth</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span> <span class='comment'># offsets B, L, T, R
</span>      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setName'>setName</span><span class='lparen'>(</span><span class='id identifier rubyid_door_id'>door_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setSurface'>setSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='period'>.</span><span class='id identifier rubyid_setSubSurfaceType'>setSubSurfaceType</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Door</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='comment'># Apply construction
</span>      <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_door'>door</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_door'>door</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_rvalue'>rvalue</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_ufactor'>ufactor</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_rvalue'>rvalue</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_ufactor'>ufactor</span><span class='comma'>,</span> <span class='id identifier rubyid_shgc'>shgc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="SubsurfaceConstructions.html" title="SubsurfaceConstructions (class)">SubsurfaceConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_ufactor_shgc'><span class='object_link'><a href="SubsurfaceConstructions.html#get_default_ufactor_shgc-class_method" title="SubsurfaceConstructions.get_default_ufactor_shgc (method)">get_default_ufactor_shgc</a></span></span><span class='lparen'>(</span><span class='ivar'>@iecc_zone_2006</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="SubsurfaceConstructions.html" title="SubsurfaceConstructions (class)">SubsurfaceConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_door'><span class='object_link'><a href="SubsurfaceConstructions.html#apply_door-class_method" title="SubsurfaceConstructions.apply_door (method)">apply_door</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_sub_surface'>sub_surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Door</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ufactor'>ufactor</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_adiabatic_construction'>apply_adiabatic_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surfaces'>surfaces</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_apply_adiabatic_construction'>apply_adiabatic_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surfaces'>surfaces</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
    <span class='comment'># Arbitrary constructions, only heat capacitance matters
</span>    <span class='comment'># Used for surfaces that solely contain subsurfaces (windows, doors, skylights)
</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall</span><span class='tstring_end'>&quot;</span></span>

      <span class='id identifier rubyid_framing_factor'>framing_factor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#DefaultFramingFactorInterior-class_method" title="Constants.DefaultFramingFactorInterior (method)">DefaultFramingFactorInterior</a></span></span>
      <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_install_grade'>install_grade</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_cavity_depth_in'>cavity_depth_in</span> <span class='op'>=</span> <span class='float'>3.5</span>
      <span class='id identifier rubyid_cavity_filled'>cavity_filled</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_rigid_r'>rigid_r</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span>
      <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#ExtFinishStuccoMedDark-class_method" title="Material.ExtFinishStuccoMedDark (method)">ExtFinishStuccoMedDark</a></span></span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_wood_stud'><span class='object_link'><a href="WallConstructions.html#apply_wood_stud-class_method" title="WallConstructions.apply_wood_stud (method)">apply_wood_stud</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surfaces'>surfaces</span><span class='comma'>,</span>
                                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AdiabaticWallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_cavity_r'>cavity_r</span><span class='comma'>,</span> <span class='id identifier rubyid_install_grade'>install_grade</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_depth_in'>cavity_depth_in</span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_cavity_filled'>cavity_filled</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>elsif</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>floor</span><span class='tstring_end'>&quot;</span></span>

      <span class='id identifier rubyid_plywood_thick_in'>plywood_thick_in</span> <span class='op'>=</span> <span class='float'>0.75</span>
      <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_mat_floor_covering'>mat_floor_covering</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#FloorWood-class_method" title="Material.FloorWood (method)">FloorWood</a></span></span>
      <span class='id identifier rubyid_mat_carpet'>mat_carpet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#CoveringBare-class_method" title="Material.CoveringBare (method)">CoveringBare</a></span></span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FloorConstructions.html" title="FloorConstructions (class)">FloorConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_uninsulated'><span class='object_link'><a href="FloorConstructions.html#apply_uninsulated-class_method" title="FloorConstructions.apply_uninsulated (method)">apply_uninsulated</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surfaces'>surfaces</span><span class='comma'>,</span>
                                                     <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AdiabaticFloorConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                     <span class='id identifier rubyid_plywood_thick_in'>plywood_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span>
                                                     <span class='id identifier rubyid_mat_floor_covering'>mat_floor_covering</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_carpet'>mat_carpet</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>elsif</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>roof</span><span class='tstring_end'>&quot;</span></span>

      <span class='id identifier rubyid_framing_thick_in'>framing_thick_in</span> <span class='op'>=</span> <span class='float'>7.25</span>
      <span class='id identifier rubyid_framing_factor'>framing_factor</span> <span class='op'>=</span> <span class='float'>0.07</span>
      <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span> <span class='op'>=</span> <span class='float'>0.75</span>
      <span class='id identifier rubyid_mat_roofing'>mat_roofing</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#RoofingAsphaltShinglesMed-class_method" title="Material.RoofingAsphaltShinglesMed (method)">RoofingAsphaltShinglesMed</a></span></span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="RoofConstructions.html" title="RoofConstructions (class)">RoofConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_uninsulated_roofs'><span class='object_link'><a href="RoofConstructions.html#apply_uninsulated_roofs-class_method" title="RoofConstructions.apply_uninsulated_roofs (method)">apply_uninsulated_roofs</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surfaces'>surfaces</span><span class='comma'>,</span>
                                                          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AdiabaticRoofConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                          <span class='id identifier rubyid_framing_thick_in'>framing_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                                          <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_roofing'>mat_roofing</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_hot_water_and_appliances'>add_hot_water_and_appliances</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_wh'>wh</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/WaterHeating</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

    <span class='comment'># Clothes Washer
</span>    <span class='id identifier rubyid_cw'>cw</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Appliances/ClothesWasher</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_cw'>cw</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_cw_mef'>cw_mef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ModifiedEnergyFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cw_imef'>cw_imef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>IntegratedModifiedEnergyFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cw_mef'>cw_mef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='id identifier rubyid_cw_imef'>cw_imef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_cw_mef'>cw_mef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_clothes_washer_reference_mef'><span class='object_link'><a href="HotWaterAndAppliances.html#get_clothes_washer_reference_mef-class_method" title="HotWaterAndAppliances.get_clothes_washer_reference_mef (method)">get_clothes_washer_reference_mef</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_ler'>cw_ler</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_clothes_washer_reference_ler'><span class='object_link'><a href="HotWaterAndAppliances.html#get_clothes_washer_reference_ler-class_method" title="HotWaterAndAppliances.get_clothes_washer_reference_ler (method)">get_clothes_washer_reference_ler</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_elec_rate'>cw_elec_rate</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_clothes_washer_reference_elec_rate'><span class='object_link'><a href="HotWaterAndAppliances.html#get_clothes_washer_reference_elec_rate-class_method" title="HotWaterAndAppliances.get_clothes_washer_reference_elec_rate (method)">get_clothes_washer_reference_elec_rate</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_gas_rate'>cw_gas_rate</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_clothes_washer_reference_gas_rate'><span class='object_link'><a href="HotWaterAndAppliances.html#get_clothes_washer_reference_gas_rate-class_method" title="HotWaterAndAppliances.get_clothes_washer_reference_gas_rate (method)">get_clothes_washer_reference_gas_rate</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_agc'>cw_agc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_clothes_washer_reference_agc'><span class='object_link'><a href="HotWaterAndAppliances.html#get_clothes_washer_reference_agc-class_method" title="HotWaterAndAppliances.get_clothes_washer_reference_agc (method)">get_clothes_washer_reference_agc</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_cap'>cw_cap</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_clothes_washer_reference_cap'><span class='object_link'><a href="HotWaterAndAppliances.html#get_clothes_washer_reference_cap-class_method" title="HotWaterAndAppliances.get_clothes_washer_reference_cap (method)">get_clothes_washer_reference_cap</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_cw_mef'>cw_mef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_cw_mef'>cw_mef</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_cw_mef'>cw_mef</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='kw'>not</span> <span class='id identifier rubyid_cw_imef'>cw_imef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_cw_mef'>cw_mef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_calc_clothes_washer_mef_from_imef'><span class='object_link'><a href="HotWaterAndAppliances.html#calc_clothes_washer_mef_from_imef-class_method" title="HotWaterAndAppliances.calc_clothes_washer_mef_from_imef (method)">calc_clothes_washer_mef_from_imef</a></span></span><span class='lparen'>(</span><span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_cw_imef'>cw_imef</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_cw_ler'>cw_ler</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RatedAnnualkWh</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_elec_rate'>cw_elec_rate</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LabelElectricRate</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_gas_rate'>cw_gas_rate</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LabelGasRate</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_agc'>cw_agc</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LabelAnnualGasCost</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cw_cap'>cw_cap</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Capacity</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cw_mef'>cw_mef</span> <span class='op'>=</span> <span class='id identifier rubyid_cw_ler'>cw_ler</span> <span class='op'>=</span> <span class='id identifier rubyid_cw_elec_rate'>cw_elec_rate</span> <span class='op'>=</span> <span class='id identifier rubyid_cw_gas_rate'>cw_gas_rate</span> <span class='op'>=</span> <span class='id identifier rubyid_cw_agc'>cw_agc</span> <span class='op'>=</span> <span class='id identifier rubyid_cw_cap'>cw_cap</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='comment'># Clothes Dryer
</span>    <span class='id identifier rubyid_cd'>cd</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Appliances/ClothesDryer</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_cd'>cd</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_cd_fuel'>cd_fuel</span> <span class='op'>=</span> <span class='id identifier rubyid_to_beopt_fuel'>to_beopt_fuel</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FuelType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cd_ef'>cd_ef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EnergyFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cd_cef'>cd_cef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CombinedEnergyFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cd_ef'>cd_ef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='id identifier rubyid_cd_cef'>cd_cef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_cd_ef'>cd_ef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_clothes_dryer_reference_ef'><span class='object_link'><a href="HotWaterAndAppliances.html#get_clothes_dryer_reference_ef-class_method" title="HotWaterAndAppliances.get_clothes_dryer_reference_ef (method)">get_clothes_dryer_reference_ef</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd_fuel'>cd_fuel</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cd_control'>cd_control</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_clothes_dryer_reference_control'><span class='object_link'><a href="HotWaterAndAppliances.html#get_clothes_dryer_reference_control-class_method" title="HotWaterAndAppliances.get_clothes_dryer_reference_control (method)">get_clothes_dryer_reference_control</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_cd_ef'>cd_ef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_cd_ef'>cd_ef</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_cd_ef'>cd_ef</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='kw'>not</span> <span class='id identifier rubyid_cd_cef'>cd_cef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_cd_ef'>cd_ef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_calc_clothes_dryer_ef_from_cef'><span class='object_link'><a href="HotWaterAndAppliances.html#calc_clothes_dryer_ef_from_cef-class_method" title="HotWaterAndAppliances.calc_clothes_dryer_ef_from_cef (method)">calc_clothes_dryer_ef_from_cef</a></span></span><span class='lparen'>(</span><span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_cd_cef'>cd_cef</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_cd_control'>cd_control</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cd'>cd</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ControlType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cd_ef'>cd_ef</span> <span class='op'>=</span> <span class='id identifier rubyid_cd_control'>cd_control</span> <span class='op'>=</span> <span class='id identifier rubyid_cd_fuel'>cd_fuel</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='comment'># Dishwasher
</span>    <span class='id identifier rubyid_dw'>dw</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Appliances/Dishwasher</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_dw'>dw</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_dw_ef'>dw_ef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dw'>dw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EnergyFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dw_annual_kwh'>dw_annual_kwh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dw'>dw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RatedAnnualkWh</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_dw_ef'>dw_ef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='id identifier rubyid_dw_annual_kwh'>dw_annual_kwh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_dw_ef'>dw_ef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_dishwasher_reference_ef'><span class='object_link'><a href="HotWaterAndAppliances.html#get_dishwasher_reference_ef-class_method" title="HotWaterAndAppliances.get_dishwasher_reference_ef (method)">get_dishwasher_reference_ef</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_dw_cap'>dw_cap</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_dishwasher_reference_cap'><span class='object_link'><a href="HotWaterAndAppliances.html#get_dishwasher_reference_cap-class_method" title="HotWaterAndAppliances.get_dishwasher_reference_cap (method)">get_dishwasher_reference_cap</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_dw_ef'>dw_ef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_dw_ef'>dw_ef</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_dw_ef'>dw_ef</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='kw'>not</span> <span class='id identifier rubyid_dw_annual_kwh'>dw_annual_kwh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_dw_ef'>dw_ef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_calc_dishwasher_ef_from_annual_kwh'><span class='object_link'><a href="HotWaterAndAppliances.html#calc_dishwasher_ef_from_annual_kwh-class_method" title="HotWaterAndAppliances.calc_dishwasher_ef_from_annual_kwh (method)">calc_dishwasher_ef_from_annual_kwh</a></span></span><span class='lparen'>(</span><span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_dw_annual_kwh'>dw_annual_kwh</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_dw_cap'>dw_cap</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dw'>dw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PlaceSettingCapacity</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_dw_ef'>dw_ef</span> <span class='op'>=</span> <span class='id identifier rubyid_dw_cap'>dw_cap</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='comment'># Refrigerator
</span>    <span class='id identifier rubyid_fridge'>fridge</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Appliances/Refrigerator</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_fridge'>fridge</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_fridge_annual_kwh'>fridge_annual_kwh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fridge'>fridge</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RatedAnnualkWh</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_fridge_annual_kwh'>fridge_annual_kwh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_fridge_annual_kwh'>fridge_annual_kwh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_refrigerator_reference_annual_kwh'><span class='object_link'><a href="HotWaterAndAppliances.html#get_refrigerator_reference_annual_kwh-class_method" title="HotWaterAndAppliances.get_refrigerator_reference_annual_kwh (method)">get_refrigerator_reference_annual_kwh</a></span></span><span class='lparen'>(</span><span class='ivar'>@nbeds</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_fridge_annual_kwh'>fridge_annual_kwh</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_fridge_annual_kwh'>fridge_annual_kwh</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fridge_annual_kwh'>fridge_annual_kwh</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='comment'># Cooking Range/Oven
</span>    <span class='id identifier rubyid_cook'>cook</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Appliances/CookingRange</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_oven'>oven</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Appliances/Oven</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_cook'>cook</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_oven'>oven</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_cook_fuel_type'>cook_fuel_type</span> <span class='op'>=</span> <span class='id identifier rubyid_to_beopt_fuel'>to_beopt_fuel</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cook'>cook</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FuelType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cook_is_induction'>cook_is_induction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cook'>cook</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>IsInduction</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cook_is_induction'>cook_is_induction</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_cook_is_induction'>cook_is_induction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_range_oven_reference_is_induction'><span class='object_link'><a href="HotWaterAndAppliances.html#get_range_oven_reference_is_induction-class_method" title="HotWaterAndAppliances.get_range_oven_reference_is_induction (method)">get_range_oven_reference_is_induction</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_oven_is_convection'>oven_is_convection</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_range_oven_reference_is_convection'><span class='object_link'><a href="HotWaterAndAppliances.html#get_range_oven_reference_is_convection-class_method" title="HotWaterAndAppliances.get_range_oven_reference_is_convection (method)">get_range_oven_reference_is_convection</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_cook_is_induction'>cook_is_induction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#Boolean-instance_method" title="#Boolean (method)">Boolean</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cook_is_induction'>cook_is_induction</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_oven_is_convection'>oven_is_convection</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#Boolean-instance_method" title="#Boolean (method)">Boolean</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_oven'>oven</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>IsConvection</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cook_fuel_type'>cook_fuel_type</span> <span class='op'>=</span> <span class='id identifier rubyid_cook_is_induction'>cook_is_induction</span> <span class='op'>=</span> <span class='id identifier rubyid_oven_is_convection'>oven_is_convection</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='comment'># Fixtures
</span>    <span class='id identifier rubyid_has_low_flow_fixtures'>has_low_flow_fixtures</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wh'>wh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_low_flow_fixtures_list'>low_flow_fixtures_list</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_wh'>wh</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WaterFixture[WaterFixtureType=&#39;shower head&#39; or WaterFixtureType=&#39;faucet&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wf'>wf</span><span class='op'>|</span>
        <span class='id identifier rubyid_low_flow_fixtures_list'>low_flow_fixtures_list</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#Boolean-instance_method" title="#Boolean (method)">Boolean</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_wf'>wf</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LowFlow</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_low_flow_fixtures_list'>low_flow_fixtures_list</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_low_flow_fixtures_list'>low_flow_fixtures_list</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span> <span class='kw'>and</span> <span class='id identifier rubyid_low_flow_fixtures_list'>low_flow_fixtures_list</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_has_low_flow_fixtures'>has_low_flow_fixtures</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Distribution
</span>    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wh'>wh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_dist'>dist</span> <span class='op'>=</span> <span class='id identifier rubyid_wh'>wh</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HotWaterDistribution</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_dist_type'>dist_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_child_name'><span class='object_link'><a href="XMLHelper.html#get_child_name-class_method" title="XMLHelper.get_child_name (method)">get_child_name</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_dist_type'>dist_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>standard</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemType/Standard/PipingLength</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_std_pipe_length'><span class='object_link'><a href="HotWaterAndAppliances.html#get_default_std_pipe_length-class_method" title="HotWaterAndAppliances.get_default_std_pipe_length (method)">get_default_std_pipe_length</a></span></span><span class='lparen'>(</span><span class='ivar'>@has_uncond_bsmnt</span><span class='comma'>,</span> <span class='ivar'>@cfa</span><span class='comma'>,</span> <span class='ivar'>@ncfl</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_recirc_loop_length'>recirc_loop_length</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_recirc_branch_length'>recirc_branch_length</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_recirc_control_type'>recirc_control_type</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_recirc_pump_power'>recirc_pump_power</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_dist_type'>dist_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>recirculation</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_recirc_loop_length'>recirc_loop_length</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemType/Recirculation/RecirculationPipingLoopLength</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_recirc_loop_length'>recirc_loop_length</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_std_pipe_length'><span class='object_link'><a href="HotWaterAndAppliances.html#get_default_std_pipe_length-class_method" title="HotWaterAndAppliances.get_default_std_pipe_length (method)">get_default_std_pipe_length</a></span></span><span class='lparen'>(</span><span class='ivar'>@has_uncond_bsmnt</span><span class='comma'>,</span> <span class='ivar'>@cfa</span><span class='comma'>,</span> <span class='ivar'>@ncfl</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_recirc_loop_length'>recirc_loop_length</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_recirc_loop_length'><span class='object_link'><a href="HotWaterAndAppliances.html#get_default_recirc_loop_length-class_method" title="HotWaterAndAppliances.get_default_recirc_loop_length (method)">get_default_recirc_loop_length</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_recirc_loop_length'>recirc_loop_length</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_recirc_loop_length'>recirc_loop_length</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_recirc_branch_length'>recirc_branch_length</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemType/Recirculation/BranchPipingLoopLength</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_recirc_control_type'>recirc_control_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemType/Recirculation/ControlType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_recirc_pump_power'>recirc_pump_power</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemType/Recirculation/PumpPower</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_pipe_r'>pipe_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PipeInsulation/PipeRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Drain Water Heat Recovery
</span>    <span class='id identifier rubyid_dwhr_present'>dwhr_present</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_dwhr_facilities_connected'>dwhr_facilities_connected</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_dwhr_is_equal_flow'>dwhr_is_equal_flow</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_dwhr_efficiency'>dwhr_efficiency</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wh'>wh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_has_element'><span class='object_link'><a href="XMLHelper.html#has_element-class_method" title="XMLHelper.has_element (method)">has_element</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DrainWaterHeatRecovery</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_dwhr_present'>dwhr_present</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_dwhr_facilities_connected'>dwhr_facilities_connected</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DrainWaterHeatRecovery/FacilitiesConnected</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_dwhr_is_equal_flow'>dwhr_is_equal_flow</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#Boolean-instance_method" title="#Boolean (method)">Boolean</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DrainWaterHeatRecovery/EqualFlow</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_dwhr_efficiency'>dwhr_efficiency</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dist'>dist</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DrainWaterHeatRecovery/Efficiency</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Water Heater
</span>    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_wh'>wh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_dhw'>dhw</span> <span class='op'>=</span> <span class='id identifier rubyid_wh'>wh</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WaterHeatingSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_location'>location</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Location</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HotWaterTemperature</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Waterheater.html" title="Waterheater (class)">Waterheater</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_hot_water_temperature'><span class='object_link'><a href="Waterheater.html#get_default_hot_water_temperature-class_method" title="Waterheater.get_default_hot_water_temperature (method)">get_default_hot_water_temperature</a></span></span><span class='lparen'>(</span><span class='ivar'>@eri_version</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_wh_type'>wh_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WaterHeaterType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fuel'>fuel</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FuelType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>living space</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_space'>space</span> <span class='op'>=</span> <span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeLiving-class_method" title="Constants.SpaceTypeLiving (method)">SpaceTypeLiving</a></span></span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>basement - unconditioned</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_space'>space</span> <span class='op'>=</span> <span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeUnfinishedBasement-class_method" title="Constants.SpaceTypeUnfinishedBasement (method)">SpaceTypeUnfinishedBasement</a></span></span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>basement - conditioned</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_space'>space</span> <span class='op'>=</span> <span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeFinishedBasement-class_method" title="Constants.SpaceTypeFinishedBasement (method)">SpaceTypeFinishedBasement</a></span></span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attic - unvented</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>or</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attic - vented</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_space'>space</span> <span class='op'>=</span> <span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeUnfinishedAttic-class_method" title="Constants.SpaceTypeUnfinishedAttic (method)">SpaceTypeUnfinishedAttic</a></span></span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>garage</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_space'>space</span> <span class='op'>=</span> <span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeGarage-class_method" title="Constants.SpaceTypeGarage (method)">SpaceTypeGarage</a></span></span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>crawlspace - unvented</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>or</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>crawlspace - vented</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_space'>space</span> <span class='op'>=</span> <span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeCrawl-class_method" title="Constants.SpaceTypeCrawl (method)">SpaceTypeCrawl</a></span></span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unhandled water heater space: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_location'>location</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_ef'>ef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EnergyFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_uef'>uef</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UniformEnergyFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_ef'>ef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Waterheater.html" title="Waterheater (class)">Waterheater</a></span></span><span class='period'>.</span><span class='id identifier rubyid_calc_ef_from_uef'><span class='object_link'><a href="Waterheater.html#calc_ef_from_uef-class_method" title="Waterheater.calc_ef_from_uef (method)">calc_ef_from_uef</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_uef'>uef</span><span class='comma'>,</span> <span class='id identifier rubyid_to_beopt_wh_type'>to_beopt_wh_type</span><span class='lparen'>(</span><span class='id identifier rubyid_wh_type'>wh_type</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_to_beopt_fuel'>to_beopt_fuel</span><span class='lparen'>(</span><span class='id identifier rubyid_fuel'>fuel</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_ef'>ef</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_ef'>ef</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_ef_adj'>ef_adj</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/EnergyFactorMultiplier</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_ef_adj'>ef_adj</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_ef_adj'>ef_adj</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Waterheater.html" title="Waterheater (class)">Waterheater</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_ef_multiplier'><span class='object_link'><a href="Waterheater.html#get_ef_multiplier-class_method" title="Waterheater.get_ef_multiplier (method)">get_ef_multiplier</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_to_beopt_wh_type'>to_beopt_wh_type</span><span class='lparen'>(</span><span class='id identifier rubyid_wh_type'>wh_type</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_ef_adj'>ef_adj</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_ef_adj'>ef_adj</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_ec_adj'>ec_adj</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_dist_energy_consumption_adjustment'><span class='object_link'><a href="HotWaterAndAppliances.html#get_dist_energy_consumption_adjustment-class_method" title="HotWaterAndAppliances.get_dist_energy_consumption_adjustment (method)">get_dist_energy_consumption_adjustment</a></span></span><span class='lparen'>(</span><span class='ivar'>@has_uncond_bsmnt</span><span class='comma'>,</span> <span class='ivar'>@cfa</span><span class='comma'>,</span> <span class='ivar'>@ncfl</span><span class='comma'>,</span>
                                                                            <span class='id identifier rubyid_dist_type'>dist_type</span><span class='comma'>,</span> <span class='id identifier rubyid_recirc_control_type'>recirc_control_type</span><span class='comma'>,</span>
                                                                            <span class='id identifier rubyid_pipe_r'>pipe_r</span><span class='comma'>,</span> <span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span><span class='comma'>,</span> <span class='id identifier rubyid_recirc_loop_length'>recirc_loop_length</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_wh_type'>wh_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>storage water heater</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_tank_vol'>tank_vol</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TankVolume</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_fuel'>fuel</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>electricity</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_re'>re</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RecoveryEfficiency</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_re'>re</span> <span class='op'>=</span> <span class='float'>0.98</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_capacity_kbtuh'>capacity_kbtuh</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HeatingCapacity</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>1000.0</span>
        <span class='id identifier rubyid_oncycle_power'>oncycle_power</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_offcycle_power'>offcycle_power</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Waterheater.html" title="Waterheater (class)">Waterheater</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_tank'><span class='object_link'><a href="Waterheater.html#apply_tank-class_method" title="Waterheater.apply_tank (method)">apply_tank</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_space'>space</span><span class='comma'>,</span> <span class='id identifier rubyid_to_beopt_fuel'>to_beopt_fuel</span><span class='lparen'>(</span><span class='id identifier rubyid_fuel'>fuel</span><span class='rparen'>)</span><span class='comma'>,</span>
                                         <span class='id identifier rubyid_capacity_kbtuh'>capacity_kbtuh</span><span class='comma'>,</span> <span class='id identifier rubyid_tank_vol'>tank_vol</span><span class='comma'>,</span> <span class='id identifier rubyid_ef'>ef</span> <span class='op'>*</span> <span class='id identifier rubyid_ef_adj'>ef_adj</span><span class='comma'>,</span> <span class='id identifier rubyid_re'>re</span><span class='comma'>,</span> <span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span><span class='comma'>,</span>
                                         <span class='id identifier rubyid_oncycle_power'>oncycle_power</span><span class='comma'>,</span> <span class='id identifier rubyid_offcycle_power'>offcycle_power</span><span class='comma'>,</span> <span class='id identifier rubyid_ec_adj'>ec_adj</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_wh_type'>wh_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>instantaneous water heater</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_capacity_kbtuh'>capacity_kbtuh</span> <span class='op'>=</span> <span class='float'>100000000.0</span>
        <span class='id identifier rubyid_oncycle_power'>oncycle_power</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_offcycle_power'>offcycle_power</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Waterheater.html" title="Waterheater (class)">Waterheater</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_tankless'><span class='object_link'><a href="Waterheater.html#apply_tankless-class_method" title="Waterheater.apply_tankless (method)">apply_tankless</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_space'>space</span><span class='comma'>,</span> <span class='id identifier rubyid_to_beopt_fuel'>to_beopt_fuel</span><span class='lparen'>(</span><span class='id identifier rubyid_fuel'>fuel</span><span class='rparen'>)</span><span class='comma'>,</span>
                                             <span class='id identifier rubyid_capacity_kbtuh'>capacity_kbtuh</span><span class='comma'>,</span> <span class='id identifier rubyid_ef'>ef</span><span class='comma'>,</span> <span class='id identifier rubyid_ef_adj'>ef_adj</span><span class='comma'>,</span>
                                             <span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span><span class='comma'>,</span> <span class='id identifier rubyid_oncycle_power'>oncycle_power</span><span class='comma'>,</span> <span class='id identifier rubyid_offcycle_power'>offcycle_power</span><span class='comma'>,</span> <span class='id identifier rubyid_ec_adj'>ec_adj</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_wh_type'>wh_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>heat pump water heater</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_tank_vol'>tank_vol</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dhw'>dhw</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TankVolume</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_e_cap'>e_cap</span> <span class='op'>=</span> <span class='float'>4.5</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_min_temp'>min_temp</span> <span class='op'>=</span> <span class='float'>45.0</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_max_temp'>max_temp</span> <span class='op'>=</span> <span class='float'>120.0</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_cap'>cap</span> <span class='op'>=</span> <span class='float'>0.5</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_cop'>cop</span> <span class='op'>=</span> <span class='float'>2.8</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_shr'>shr</span> <span class='op'>=</span> <span class='float'>0.88</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_airflow_rate'>airflow_rate</span> <span class='op'>=</span> <span class='float'>181.0</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_fan_power'>fan_power</span> <span class='op'>=</span> <span class='float'>0.0462</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_parasitics'>parasitics</span> <span class='op'>=</span> <span class='float'>3.0</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_tank_ua'>tank_ua</span> <span class='op'>=</span> <span class='float'>3.9</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_int_factor'>int_factor</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_temp_depress'>temp_depress</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='comment'># FIXME
</span>        <span class='id identifier rubyid_ducting'>ducting</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>none</span><span class='tstring_end'>&quot;</span></span>
        <span class='comment'># FIXME: Use ef, ef_adj, ec_adj
</span>        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Waterheater.html" title="Waterheater (class)">Waterheater</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_heatpump'><span class='object_link'><a href="Waterheater.html#apply_heatpump-class_method" title="Waterheater.apply_heatpump (method)">apply_heatpump</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_space'>space</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span>
                                             <span class='id identifier rubyid_e_cap'>e_cap</span><span class='comma'>,</span> <span class='id identifier rubyid_tank_vol'>tank_vol</span><span class='comma'>,</span> <span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span><span class='comma'>,</span> <span class='id identifier rubyid_min_temp'>min_temp</span><span class='comma'>,</span> <span class='id identifier rubyid_max_temp'>max_temp</span><span class='comma'>,</span>
                                             <span class='id identifier rubyid_cap'>cap</span><span class='comma'>,</span> <span class='id identifier rubyid_cop'>cop</span><span class='comma'>,</span> <span class='id identifier rubyid_shr'>shr</span><span class='comma'>,</span> <span class='id identifier rubyid_airflow_rate'>airflow_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power'>fan_power</span><span class='comma'>,</span>
                                             <span class='id identifier rubyid_parasitics'>parasitics</span><span class='comma'>,</span> <span class='id identifier rubyid_tank_ua'>tank_ua</span><span class='comma'>,</span> <span class='id identifier rubyid_int_factor'>int_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_temp_depress'>temp_depress</span><span class='comma'>,</span>
                                             <span class='id identifier rubyid_ducting'>ducting</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>else</span>

        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unhandled water heater (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wh_type'>wh_type</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HotWaterAndAppliances.html" title="HotWaterAndAppliances (class)">HotWaterAndAppliances</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply'><span class='object_link'><a href="HotWaterAndAppliances.html#apply-class_method" title="HotWaterAndAppliances.apply (method)">apply</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span>
                                          <span class='ivar'>@cfa</span><span class='comma'>,</span> <span class='ivar'>@nbeds</span><span class='comma'>,</span> <span class='ivar'>@ncfl</span><span class='comma'>,</span> <span class='ivar'>@has_uncond_bsmnt</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_cw_mef'>cw_mef</span><span class='comma'>,</span> <span class='id identifier rubyid_cw_ler'>cw_ler</span><span class='comma'>,</span> <span class='id identifier rubyid_cw_elec_rate'>cw_elec_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_cw_gas_rate'>cw_gas_rate</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_cw_agc'>cw_agc</span><span class='comma'>,</span> <span class='id identifier rubyid_cw_cap'>cw_cap</span><span class='comma'>,</span> <span class='id identifier rubyid_cd_fuel'>cd_fuel</span><span class='comma'>,</span> <span class='id identifier rubyid_cd_ef'>cd_ef</span><span class='comma'>,</span> <span class='id identifier rubyid_cd_control'>cd_control</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_dw_ef'>dw_ef</span><span class='comma'>,</span> <span class='id identifier rubyid_dw_cap'>dw_cap</span><span class='comma'>,</span> <span class='id identifier rubyid_fridge_annual_kwh'>fridge_annual_kwh</span><span class='comma'>,</span> <span class='id identifier rubyid_cook_fuel_type'>cook_fuel_type</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_cook_is_induction'>cook_is_induction</span><span class='comma'>,</span> <span class='id identifier rubyid_oven_is_convection'>oven_is_convection</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_has_low_flow_fixtures'>has_low_flow_fixtures</span><span class='comma'>,</span> <span class='id identifier rubyid_dist_type'>dist_type</span><span class='comma'>,</span> <span class='id identifier rubyid_pipe_r'>pipe_r</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_std_pipe_length'>std_pipe_length</span><span class='comma'>,</span> <span class='id identifier rubyid_recirc_loop_length'>recirc_loop_length</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_recirc_branch_length'>recirc_branch_length</span><span class='comma'>,</span> <span class='id identifier rubyid_recirc_control_type'>recirc_control_type</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_recirc_pump_power'>recirc_pump_power</span><span class='comma'>,</span> <span class='id identifier rubyid_dwhr_present'>dwhr_present</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_dwhr_facilities_connected'>dwhr_facilities_connected</span><span class='comma'>,</span> <span class='id identifier rubyid_dwhr_is_equal_flow'>dwhr_is_equal_flow</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_dwhr_efficiency'>dwhr_efficiency</span><span class='comma'>,</span> <span class='id identifier rubyid_setpoint_temp'>setpoint_temp</span><span class='comma'>,</span> <span class='ivar'>@eri_version</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_cooling_system'>add_cooling_system</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span>

    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACPlant/CoolingSystem</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='op'>|</span>
      <span class='id identifier rubyid_clg_type'>clg_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CoolingSystemType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CoolingCapacity</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span> <span class='op'>&lt;=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SizingAuto-class_method" title="Constants.SizingAuto (method)">SizingAuto</a></span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_load_frac'>load_frac</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FractionCoolLoadServed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_cool'>dse_cool</span><span class='comma'>,</span> <span class='id identifier rubyid_has_dse'>has_dse</span> <span class='op'>=</span> <span class='id identifier rubyid_get_dse'>get_dse</span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_clgsys'>clgsys</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_orig_air_loops'>orig_air_loops</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getAirLoopHVACs'>getAirLoopHVACs</span>
      <span class='id identifier rubyid_orig_plant_loops'>orig_plant_loops</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getPlantLoops'>getPlantLoops</span>
      <span class='id identifier rubyid_orig_zone_hvacs'>orig_zone_hvacs</span> <span class='op'>=</span> <span class='id identifier rubyid_get_zone_hvacs'>get_zone_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_clg_type'>clg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>central air conditioning</span><span class='tstring_end'>&quot;</span></span>

        <span class='comment'># FIXME: Generalize
</span>        <span class='id identifier rubyid_seer'>seer</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualCoolingEfficiency[Units=&#39;SEER&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>=</span> <span class='id identifier rubyid_get_ac_num_speeds'>get_ac_num_speeds</span><span class='lparen'>(</span><span class='id identifier rubyid_seer'>seer</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_crankcase_kw'>crankcase_kw</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_crankcase_temp'>crankcase_temp</span> <span class='op'>=</span> <span class='float'>55.0</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1-Speed</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_eers'>eers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.82</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>+</span> <span class='float'>0.64</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_shrs'>shrs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.73</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span> <span class='op'>=</span> <span class='float'>0.365</span>
          <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span> <span class='op'>=</span> <span class='float'>0.5</span>
          <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_central_ac_1speed'><span class='object_link'><a href="HVAC.html#apply_central_ac_1speed-class_method" title="HVAC.apply_central_ac_1speed (method)">apply_central_ac_1speed</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='id identifier rubyid_eers'>eers</span><span class='comma'>,</span> <span class='id identifier rubyid_shrs'>shrs</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_crankcase_kw'>crankcase_kw</span><span class='comma'>,</span> <span class='id identifier rubyid_crankcase_temp'>crankcase_temp</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span><span class='comma'>,</span> <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_dse_cool'>dse_cool</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='kw'>elsif</span> <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2-Speed</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_eers'>eers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.83</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>+</span> <span class='float'>0.15</span><span class='comma'>,</span> <span class='float'>0.56</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>+</span> <span class='float'>3.57</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_shrs'>shrs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.71</span><span class='comma'>,</span> <span class='float'>0.73</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_capacity_ratios'>capacity_ratios</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.72</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_speed_ratios'>fan_speed_ratios</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.86</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span> <span class='op'>=</span> <span class='float'>0.14</span>
          <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span> <span class='op'>=</span> <span class='float'>0.3</span>
          <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_central_ac_2speed'><span class='object_link'><a href="HVAC.html#apply_central_ac_2speed-class_method" title="HVAC.apply_central_ac_2speed (method)">apply_central_ac_2speed</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='id identifier rubyid_eers'>eers</span><span class='comma'>,</span> <span class='id identifier rubyid_shrs'>shrs</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_capacity_ratios'>capacity_ratios</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_speed_ratios'>fan_speed_ratios</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_crankcase_kw'>crankcase_kw</span><span class='comma'>,</span> <span class='id identifier rubyid_crankcase_temp'>crankcase_temp</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span><span class='comma'>,</span> <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_dse_cool'>dse_cool</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='kw'>elsif</span> <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Variable-Speed</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_eers'>eers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.80</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.75</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.65</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.60</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_shrs'>shrs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.98</span><span class='comma'>,</span> <span class='float'>0.82</span><span class='comma'>,</span> <span class='float'>0.745</span><span class='comma'>,</span> <span class='float'>0.77</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_capacity_ratios'>capacity_ratios</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.36</span><span class='comma'>,</span> <span class='float'>0.64</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.16</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_speed_ratios'>fan_speed_ratios</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.51</span><span class='comma'>,</span> <span class='float'>0.84</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.19</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span> <span class='op'>=</span> <span class='float'>0.14</span>
          <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span> <span class='op'>=</span> <span class='float'>0.3</span>
          <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_central_ac_4speed'><span class='object_link'><a href="HVAC.html#apply_central_ac_4speed-class_method" title="HVAC.apply_central_ac_4speed (method)">apply_central_ac_4speed</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='id identifier rubyid_eers'>eers</span><span class='comma'>,</span> <span class='id identifier rubyid_shrs'>shrs</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_capacity_ratios'>capacity_ratios</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_speed_ratios'>fan_speed_ratios</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_crankcase_kw'>crankcase_kw</span><span class='comma'>,</span> <span class='id identifier rubyid_crankcase_temp'>crankcase_temp</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span><span class='comma'>,</span> <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_dse_cool'>dse_cool</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='kw'>else</span>

          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected number of speeds (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_num_speeds'>num_speeds</span><span class='embexpr_end'>}</span><span class='tstring_content'>) for cooling system.</span><span class='tstring_end'>&quot;</span></span>

        <span class='kw'>end</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_clg_type'>clg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>room air conditioner</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_eer'>eer</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualCoolingEfficiency[Units=&#39;EER&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_shr'>shr</span> <span class='op'>=</span> <span class='float'>0.65</span>
        <span class='id identifier rubyid_airflow_rate'>airflow_rate</span> <span class='op'>=</span> <span class='float'>350.0</span>

        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_room_ac'><span class='object_link'><a href="HVAC.html#apply_room_ac-class_method" title="HVAC.apply_room_ac (method)">apply_room_ac</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_eer'>eer</span><span class='comma'>,</span> <span class='id identifier rubyid_shr'>shr</span><span class='comma'>,</span>
                                     <span class='id identifier rubyid_airflow_rate'>airflow_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>end</span>

      <span class='id identifier rubyid_update_loop_hvacs'>update_loop_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_clgsys'>clgsys</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_air_loops'>orig_air_loops</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_plant_loops'>orig_plant_loops</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_zone_hvacs'>orig_zone_hvacs</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_heating_system'>add_heating_system</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span>

    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACPlant/HeatingSystem</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='op'>|</span>
      <span class='id identifier rubyid_fuel'>fuel</span> <span class='op'>=</span> <span class='id identifier rubyid_to_beopt_fuel'>to_beopt_fuel</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HeatingSystemFuel</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_heat_capacity_btuh'>heat_capacity_btuh</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HeatingCapacity</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_heat_capacity_btuh'>heat_capacity_btuh</span> <span class='op'>&lt;=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_heat_capacity_btuh'>heat_capacity_btuh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SizingAuto-class_method" title="Constants.SizingAuto (method)">SizingAuto</a></span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_child_name'><span class='object_link'><a href="XMLHelper.html#get_child_name-class_method" title="XMLHelper.get_child_name (method)">get_child_name</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HeatingSystemType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_load_frac'>load_frac</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FractionHeatLoadServed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_cool'>dse_cool</span><span class='comma'>,</span> <span class='id identifier rubyid_has_dse'>has_dse</span> <span class='op'>=</span> <span class='id identifier rubyid_get_dse'>get_dse</span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_htgsys'>htgsys</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_orig_air_loops'>orig_air_loops</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getAirLoopHVACs'>getAirLoopHVACs</span>
      <span class='id identifier rubyid_orig_plant_loops'>orig_plant_loops</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getPlantLoops'>getPlantLoops</span>
      <span class='id identifier rubyid_orig_zone_hvacs'>orig_zone_hvacs</span> <span class='op'>=</span> <span class='id identifier rubyid_get_zone_hvacs'>get_zone_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Furnace</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_afue'>afue</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingEfficiency[Units=&#39;AFUE&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_fan_power'>fan_power</span> <span class='op'>=</span> <span class='float'>0.5</span> <span class='comment'># For fuel furnaces, will be overridden by EAE later
</span>        <span class='id identifier rubyid_attached_to_multispeed_ac'>attached_to_multispeed_ac</span> <span class='op'>=</span> <span class='id identifier rubyid_get_attached_to_multispeed_ac'>get_attached_to_multispeed_ac</span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_furnace'><span class='object_link'><a href="HVAC.html#apply_furnace-class_method" title="HVAC.apply_furnace (method)">apply_furnace</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel'>fuel</span><span class='comma'>,</span> <span class='id identifier rubyid_afue'>afue</span><span class='comma'>,</span>
                                     <span class='id identifier rubyid_heat_capacity_btuh'>heat_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power'>fan_power</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span>
                                     <span class='id identifier rubyid_load_frac'>load_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_attached_to_multispeed_ac'>attached_to_multispeed_ac</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallFurnace</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_efficiency'>efficiency</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingEfficiency[Units=&#39;AFUE&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_fan_power'>fan_power</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_airflow_rate'>airflow_rate</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='comment'># TODO: Allow DSE
</span>        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_unit_heater'><span class='object_link'><a href="HVAC.html#apply_unit_heater-class_method" title="HVAC.apply_unit_heater (method)">apply_unit_heater</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel'>fuel</span><span class='comma'>,</span>
                                         <span class='id identifier rubyid_efficiency'>efficiency</span><span class='comma'>,</span> <span class='id identifier rubyid_heat_capacity_btuh'>heat_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power'>fan_power</span><span class='comma'>,</span>
                                         <span class='id identifier rubyid_airflow_rate'>airflow_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Boiler</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_system_type'>system_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#BoilerTypeForcedDraft-class_method" title="Constants.BoilerTypeForcedDraft (method)">BoilerTypeForcedDraft</a></span></span>
        <span class='id identifier rubyid_afue'>afue</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingEfficiency[Units=&#39;AFUE&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_oat_reset_enabled'>oat_reset_enabled</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_oat_high'>oat_high</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_oat_low'>oat_low</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_oat_hwst_high'>oat_hwst_high</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_oat_hwst_low'>oat_hwst_low</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_design_temp'>design_temp</span> <span class='op'>=</span> <span class='float'>180.0</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_boiler'><span class='object_link'><a href="HVAC.html#apply_boiler-class_method" title="HVAC.apply_boiler (method)">apply_boiler</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel'>fuel</span><span class='comma'>,</span> <span class='id identifier rubyid_system_type'>system_type</span><span class='comma'>,</span> <span class='id identifier rubyid_afue'>afue</span><span class='comma'>,</span>
                                    <span class='id identifier rubyid_oat_reset_enabled'>oat_reset_enabled</span><span class='comma'>,</span> <span class='id identifier rubyid_oat_high'>oat_high</span><span class='comma'>,</span> <span class='id identifier rubyid_oat_low'>oat_low</span><span class='comma'>,</span> <span class='id identifier rubyid_oat_hwst_high'>oat_hwst_high</span><span class='comma'>,</span> <span class='id identifier rubyid_oat_hwst_low'>oat_hwst_low</span><span class='comma'>,</span>
                                    <span class='id identifier rubyid_heat_capacity_btuh'>heat_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_design_temp'>design_temp</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ElectricResistance</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_efficiency'>efficiency</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingEfficiency[Units=&#39;Percent&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='comment'># TODO: Allow DSE
</span>        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_electric_baseboard'><span class='object_link'><a href="HVAC.html#apply_electric_baseboard-class_method" title="HVAC.apply_electric_baseboard (method)">apply_electric_baseboard</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_efficiency'>efficiency</span><span class='comma'>,</span>
                                                <span class='id identifier rubyid_heat_capacity_btuh'>heat_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Stove</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_efficiency'>efficiency</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingEfficiency[Units=&#39;Percent&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_airflow_rate'>airflow_rate</span> <span class='op'>=</span> <span class='float'>125.0</span> <span class='comment'># cfm/ton; doesn&#39;t affect energy consumption
</span>        <span class='id identifier rubyid_fan_power'>fan_power</span> <span class='op'>=</span> <span class='float'>0.5</span> <span class='comment'># For fuel equipment, will be overridden by EAE later
</span>        <span class='comment'># TODO: Allow DSE
</span>        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_unit_heater'><span class='object_link'><a href="HVAC.html#apply_unit_heater-class_method" title="HVAC.apply_unit_heater (method)">apply_unit_heater</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel'>fuel</span><span class='comma'>,</span>
                                         <span class='id identifier rubyid_efficiency'>efficiency</span><span class='comma'>,</span> <span class='id identifier rubyid_heat_capacity_btuh'>heat_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power'>fan_power</span><span class='comma'>,</span>
                                         <span class='id identifier rubyid_airflow_rate'>airflow_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>end</span>

      <span class='id identifier rubyid_update_loop_hvacs'>update_loop_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_air_loops'>orig_air_loops</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_plant_loops'>orig_plant_loops</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_zone_hvacs'>orig_zone_hvacs</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_heat_pump'>add_heat_pump</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span>

    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACPlant/HeatPump</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hp'>hp</span><span class='op'>|</span>
      <span class='id identifier rubyid_hp_type'>hp_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HeatPumpType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CoolingCapacity</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SizingAuto-class_method" title="Constants.SizingAuto (method)">SizingAuto</a></span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_load_frac_heat'>load_frac_heat</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FractionHeatLoadServed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_load_frac_cool'>load_frac_cool</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FractionCoolLoadServed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BackupHeatingCapacity</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># TODO: Require in ERI Use Case?
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SizingAuto-class_method" title="Constants.SizingAuto (method)">SizingAuto</a></span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_cool'>dse_cool</span><span class='comma'>,</span> <span class='id identifier rubyid_has_dse'>has_dse</span> <span class='op'>=</span> <span class='id identifier rubyid_get_dse'>get_dse</span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_hp'>hp</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span> <span class='op'>!=</span> <span class='id identifier rubyid_dse_cool'>dse_cool</span>
        <span class='comment'># TODO: Can we remove this since we use separate airloops for
</span>        <span class='comment'># heating and cooling?
</span>        <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot handle different distribution system efficiency (DSE) values for heating and cooling.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_orig_air_loops'>orig_air_loops</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getAirLoopHVACs'>getAirLoopHVACs</span>
      <span class='id identifier rubyid_orig_plant_loops'>orig_plant_loops</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getPlantLoops'>getPlantLoops</span>
      <span class='id identifier rubyid_orig_zone_hvacs'>orig_zone_hvacs</span> <span class='op'>=</span> <span class='id identifier rubyid_get_zone_hvacs'>get_zone_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_hp_type'>hp_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>air-to-air</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_seer'>seer</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualCoolingEfficiency[Units=&#39;SEER&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_hspf'>hspf</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingEfficiency[Units=&#39;HSPF&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>=</span> <span class='id identifier rubyid_get_ashp_num_speeds'>get_ashp_num_speeds</span><span class='lparen'>(</span><span class='id identifier rubyid_seer'>seer</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_crankcase_kw'>crankcase_kw</span> <span class='op'>=</span> <span class='float'>0.02</span>
        <span class='id identifier rubyid_crankcase_temp'>crankcase_temp</span> <span class='op'>=</span> <span class='float'>55.0</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1-Speed</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_eers'>eers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.80</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>+</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_cops'>cops</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.45</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>-</span> <span class='float'>0.34</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_shrs'>shrs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.73</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span> <span class='op'>=</span> <span class='float'>0.365</span>
          <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span> <span class='op'>=</span> <span class='float'>0.5</span>
          <span class='id identifier rubyid_min_temp'>min_temp</span> <span class='op'>=</span> <span class='float'>0.0</span>
          <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_cop_capacity_derates'>cop_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span> <span class='op'>=</span> <span class='float'>1.0</span>
          <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_central_ashp_1speed'><span class='object_link'><a href="HVAC.html#apply_central_ashp_1speed-class_method" title="HVAC.apply_central_ashp_1speed (method)">apply_central_ashp_1speed</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='id identifier rubyid_hspf'>hspf</span><span class='comma'>,</span> <span class='id identifier rubyid_eers'>eers</span><span class='comma'>,</span> <span class='id identifier rubyid_cops'>cops</span><span class='comma'>,</span> <span class='id identifier rubyid_shrs'>shrs</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span><span class='comma'>,</span> <span class='id identifier rubyid_min_temp'>min_temp</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_crankcase_kw'>crankcase_kw</span><span class='comma'>,</span> <span class='id identifier rubyid_crankcase_temp'>crankcase_temp</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span><span class='comma'>,</span> <span class='id identifier rubyid_cop_capacity_derates'>cop_capacity_derates</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_load_frac_heat'>load_frac_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac_cool'>load_frac_cool</span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='kw'>elsif</span> <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2-Speed</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_eers'>eers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.78</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>+</span> <span class='float'>0.6</span><span class='comma'>,</span> <span class='float'>0.68</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>+</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_cops'>cops</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.60</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>-</span> <span class='float'>1.40</span><span class='comma'>,</span> <span class='float'>0.50</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>-</span> <span class='float'>0.94</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_shrs'>shrs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.71</span><span class='comma'>,</span> <span class='float'>0.724</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_capacity_ratios'>capacity_ratios</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.72</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_speed_ratios_cooling'>fan_speed_ratios_cooling</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.86</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_speed_ratios_heating'>fan_speed_ratios_heating</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.8</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span> <span class='op'>=</span> <span class='float'>0.14</span>
          <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span> <span class='op'>=</span> <span class='float'>0.3</span>
          <span class='id identifier rubyid_min_temp'>min_temp</span> <span class='op'>=</span> <span class='float'>0.0</span>
          <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_cop_capacity_derates'>cop_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span> <span class='op'>=</span> <span class='float'>1.0</span>
          <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_central_ashp_2speed'><span class='object_link'><a href="HVAC.html#apply_central_ashp_2speed-class_method" title="HVAC.apply_central_ashp_2speed (method)">apply_central_ashp_2speed</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='id identifier rubyid_hspf'>hspf</span><span class='comma'>,</span> <span class='id identifier rubyid_eers'>eers</span><span class='comma'>,</span> <span class='id identifier rubyid_cops'>cops</span><span class='comma'>,</span> <span class='id identifier rubyid_shrs'>shrs</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_capacity_ratios'>capacity_ratios</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_speed_ratios_cooling'>fan_speed_ratios_cooling</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_fan_speed_ratios_heating'>fan_speed_ratios_heating</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span><span class='comma'>,</span> <span class='id identifier rubyid_min_temp'>min_temp</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_crankcase_kw'>crankcase_kw</span><span class='comma'>,</span> <span class='id identifier rubyid_crankcase_temp'>crankcase_temp</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span><span class='comma'>,</span> <span class='id identifier rubyid_cop_capacity_derates'>cop_capacity_derates</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_load_frac_heat'>load_frac_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac_cool'>load_frac_cool</span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='kw'>elsif</span> <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Variable-Speed</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_eers'>eers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.80</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.75</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.65</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.60</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_cops'>cops</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.48</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.45</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.39</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='float'>0.39</span> <span class='op'>*</span> <span class='id identifier rubyid_seer'>seer</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_shrs'>shrs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.84</span><span class='comma'>,</span> <span class='float'>0.79</span><span class='comma'>,</span> <span class='float'>0.76</span><span class='comma'>,</span> <span class='float'>0.77</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_capacity_ratios'>capacity_ratios</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.49</span><span class='comma'>,</span> <span class='float'>0.67</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.2</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_speed_ratios_cooling'>fan_speed_ratios_cooling</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.7</span><span class='comma'>,</span> <span class='float'>0.9</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.26</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_speed_ratios_heating'>fan_speed_ratios_heating</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.74</span><span class='comma'>,</span> <span class='float'>0.92</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.22</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span> <span class='op'>=</span> <span class='float'>0.14</span>
          <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span> <span class='op'>=</span> <span class='float'>0.3</span>
          <span class='id identifier rubyid_min_temp'>min_temp</span> <span class='op'>=</span> <span class='float'>0.0</span>
          <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_cop_capacity_derates'>cop_capacity_derates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span> <span class='op'>=</span> <span class='float'>1.0</span>
          <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_central_ashp_4speed'><span class='object_link'><a href="HVAC.html#apply_central_ashp_4speed-class_method" title="HVAC.apply_central_ashp_4speed (method)">apply_central_ashp_4speed</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='id identifier rubyid_hspf'>hspf</span><span class='comma'>,</span> <span class='id identifier rubyid_eers'>eers</span><span class='comma'>,</span> <span class='id identifier rubyid_cops'>cops</span><span class='comma'>,</span> <span class='id identifier rubyid_shrs'>shrs</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_capacity_ratios'>capacity_ratios</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_speed_ratios_cooling'>fan_speed_ratios_cooling</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_fan_speed_ratios_heating'>fan_speed_ratios_heating</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_fan_power_rated'>fan_power_rated</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power_installed'>fan_power_installed</span><span class='comma'>,</span> <span class='id identifier rubyid_min_temp'>min_temp</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_crankcase_kw'>crankcase_kw</span><span class='comma'>,</span> <span class='id identifier rubyid_crankcase_temp'>crankcase_temp</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_eer_capacity_derates'>eer_capacity_derates</span><span class='comma'>,</span> <span class='id identifier rubyid_cop_capacity_derates'>cop_capacity_derates</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_load_frac_heat'>load_frac_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac_cool'>load_frac_cool</span><span class='rparen'>)</span>
          <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

        <span class='kw'>else</span>

          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected number of speeds (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_num_speeds'>num_speeds</span><span class='embexpr_end'>}</span><span class='tstring_content'>) for heat pump system.</span><span class='tstring_end'>&quot;</span></span>

        <span class='kw'>end</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_hp_type'>hp_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mini-split</span><span class='tstring_end'>&quot;</span></span>

        <span class='comment'># FIXME: Generalize
</span>        <span class='id identifier rubyid_seer'>seer</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualCoolingEfficiency[Units=&#39;SEER&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_hspf'>hspf</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingEfficiency[Units=&#39;HSPF&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_shr'>shr</span> <span class='op'>=</span> <span class='float'>0.73</span>
        <span class='id identifier rubyid_min_cooling_capacity'>min_cooling_capacity</span> <span class='op'>=</span> <span class='float'>0.4</span>
        <span class='id identifier rubyid_max_cooling_capacity'>max_cooling_capacity</span> <span class='op'>=</span> <span class='float'>1.2</span>
        <span class='id identifier rubyid_min_cooling_airflow_rate'>min_cooling_airflow_rate</span> <span class='op'>=</span> <span class='float'>200.0</span>
        <span class='id identifier rubyid_max_cooling_airflow_rate'>max_cooling_airflow_rate</span> <span class='op'>=</span> <span class='float'>425.0</span>
        <span class='id identifier rubyid_min_heating_capacity'>min_heating_capacity</span> <span class='op'>=</span> <span class='float'>0.3</span>
        <span class='id identifier rubyid_max_heating_capacity'>max_heating_capacity</span> <span class='op'>=</span> <span class='float'>1.2</span>
        <span class='id identifier rubyid_min_heating_airflow_rate'>min_heating_airflow_rate</span> <span class='op'>=</span> <span class='float'>200.0</span>
        <span class='id identifier rubyid_max_heating_airflow_rate'>max_heating_airflow_rate</span> <span class='op'>=</span> <span class='float'>400.0</span>
        <span class='id identifier rubyid_heating_capacity_offset'>heating_capacity_offset</span> <span class='op'>=</span> <span class='float'>2300.0</span>
        <span class='id identifier rubyid_cap_retention_frac'>cap_retention_frac</span> <span class='op'>=</span> <span class='float'>0.25</span>
        <span class='id identifier rubyid_cap_retention_temp'>cap_retention_temp</span> <span class='op'>=</span> <span class='op'>-</span><span class='float'>5.0</span>
        <span class='id identifier rubyid_pan_heater_power'>pan_heater_power</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_fan_power'>fan_power</span> <span class='op'>=</span> <span class='float'>0.07</span>
        <span class='id identifier rubyid_is_ducted'>is_ducted</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_has_element'><span class='object_link'><a href="XMLHelper.html#has_element-class_method" title="XMLHelper.has_element (method)">has_element</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_has_dse'>has_dse</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span> <span class='op'>=</span> <span class='float'>1.0</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_mshp'><span class='object_link'><a href="HVAC.html#apply_mshp-class_method" title="HVAC.apply_mshp (method)">apply_mshp</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_seer'>seer</span><span class='comma'>,</span> <span class='id identifier rubyid_hspf'>hspf</span><span class='comma'>,</span> <span class='id identifier rubyid_shr'>shr</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_min_cooling_capacity'>min_cooling_capacity</span><span class='comma'>,</span> <span class='id identifier rubyid_max_cooling_capacity'>max_cooling_capacity</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_min_cooling_airflow_rate'>min_cooling_airflow_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_max_cooling_airflow_rate'>max_cooling_airflow_rate</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_min_heating_capacity'>min_heating_capacity</span><span class='comma'>,</span> <span class='id identifier rubyid_max_heating_capacity'>max_heating_capacity</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_min_heating_airflow_rate'>min_heating_airflow_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_max_heating_airflow_rate'>max_heating_airflow_rate</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_heating_capacity_offset'>heating_capacity_offset</span><span class='comma'>,</span> <span class='id identifier rubyid_cap_retention_frac'>cap_retention_frac</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_cap_retention_temp'>cap_retention_temp</span><span class='comma'>,</span> <span class='id identifier rubyid_pan_heater_power'>pan_heater_power</span><span class='comma'>,</span> <span class='id identifier rubyid_fan_power'>fan_power</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_is_ducted'>is_ducted</span><span class='comma'>,</span> <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span><span class='comma'>,</span> <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac_heat'>load_frac_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac_cool'>load_frac_cool</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>elsif</span> <span class='id identifier rubyid_hp_type'>hp_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ground-to-air</span><span class='tstring_end'>&quot;</span></span>

        <span class='comment'># FIXME: Generalize
</span>        <span class='id identifier rubyid_cop'>cop</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingEfficiency[Units=&#39;COP&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_eer'>eer</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualCoolingEfficiency[Units=&#39;EER&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_shr'>shr</span> <span class='op'>=</span> <span class='float'>0.732</span>
        <span class='id identifier rubyid_ground_conductivity'>ground_conductivity</span> <span class='op'>=</span> <span class='float'>0.6</span>
        <span class='id identifier rubyid_grout_conductivity'>grout_conductivity</span> <span class='op'>=</span> <span class='float'>0.4</span>
        <span class='id identifier rubyid_bore_config'>bore_config</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SizingAuto-class_method" title="Constants.SizingAuto (method)">SizingAuto</a></span></span>
        <span class='id identifier rubyid_bore_holes'>bore_holes</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SizingAuto-class_method" title="Constants.SizingAuto (method)">SizingAuto</a></span></span>
        <span class='id identifier rubyid_bore_depth'>bore_depth</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SizingAuto-class_method" title="Constants.SizingAuto (method)">SizingAuto</a></span></span>
        <span class='id identifier rubyid_bore_spacing'>bore_spacing</span> <span class='op'>=</span> <span class='float'>20.0</span>
        <span class='id identifier rubyid_bore_diameter'>bore_diameter</span> <span class='op'>=</span> <span class='float'>5.0</span>
        <span class='id identifier rubyid_pipe_size'>pipe_size</span> <span class='op'>=</span> <span class='float'>0.75</span>
        <span class='id identifier rubyid_ground_diffusivity'>ground_diffusivity</span> <span class='op'>=</span> <span class='float'>0.0208</span>
        <span class='id identifier rubyid_fluid_type'>fluid_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#FluidPropyleneGlycol-class_method" title="Constants.FluidPropyleneGlycol (method)">FluidPropyleneGlycol</a></span></span>
        <span class='id identifier rubyid_frac_glycol'>frac_glycol</span> <span class='op'>=</span> <span class='float'>0.3</span>
        <span class='id identifier rubyid_design_delta_t'>design_delta_t</span> <span class='op'>=</span> <span class='float'>10.0</span>
        <span class='id identifier rubyid_pump_head'>pump_head</span> <span class='op'>=</span> <span class='float'>50.0</span>
        <span class='id identifier rubyid_u_tube_leg_spacing'>u_tube_leg_spacing</span> <span class='op'>=</span> <span class='float'>0.9661</span>
        <span class='id identifier rubyid_u_tube_spacing_type'>u_tube_spacing_type</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_fan_power'>fan_power</span> <span class='op'>=</span> <span class='float'>0.5</span>
        <span class='id identifier rubyid_heat_pump_capacity'>heat_pump_capacity</span> <span class='op'>=</span> <span class='id identifier rubyid_cool_capacity_btuh'>cool_capacity_btuh</span>
        <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span> <span class='op'>=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_supplemental_capacity'>supplemental_capacity</span> <span class='op'>=</span> <span class='id identifier rubyid_backup_heat_capacity_btuh'>backup_heat_capacity_btuh</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_gshp'><span class='object_link'><a href="HVAC.html#apply_gshp-class_method" title="HVAC.apply_gshp (method)">apply_gshp</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_cop'>cop</span><span class='comma'>,</span> <span class='id identifier rubyid_eer'>eer</span><span class='comma'>,</span> <span class='id identifier rubyid_shr'>shr</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_ground_conductivity'>ground_conductivity</span><span class='comma'>,</span> <span class='id identifier rubyid_grout_conductivity'>grout_conductivity</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_bore_config'>bore_config</span><span class='comma'>,</span> <span class='id identifier rubyid_bore_holes'>bore_holes</span><span class='comma'>,</span> <span class='id identifier rubyid_bore_depth'>bore_depth</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_bore_spacing'>bore_spacing</span><span class='comma'>,</span> <span class='id identifier rubyid_bore_diameter'>bore_diameter</span><span class='comma'>,</span> <span class='id identifier rubyid_pipe_size'>pipe_size</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_ground_diffusivity'>ground_diffusivity</span><span class='comma'>,</span> <span class='id identifier rubyid_fluid_type'>fluid_type</span><span class='comma'>,</span> <span class='id identifier rubyid_frac_glycol'>frac_glycol</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_design_delta_t'>design_delta_t</span><span class='comma'>,</span> <span class='id identifier rubyid_pump_head'>pump_head</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_u_tube_leg_spacing'>u_tube_leg_spacing</span><span class='comma'>,</span> <span class='id identifier rubyid_u_tube_spacing_type'>u_tube_spacing_type</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_fan_power'>fan_power</span><span class='comma'>,</span> <span class='id identifier rubyid_heat_pump_capacity'>heat_pump_capacity</span><span class='comma'>,</span> <span class='id identifier rubyid_supplemental_efficiency'>supplemental_efficiency</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_supplemental_capacity'>supplemental_capacity</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span>
                                  <span class='id identifier rubyid_load_frac_heat'>load_frac_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac_cool'>load_frac_cool</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

      <span class='kw'>end</span>

      <span class='id identifier rubyid_update_loop_hvacs'>update_loop_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_hp'>hp</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_air_loops'>orig_air_loops</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_plant_loops'>orig_plant_loops</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_zone_hvacs'>orig_zone_hvacs</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_residual_hvac'>add_residual_hvac</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span><span class='rparen'>)</span>
    <span class='comment'># Residual heating
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span>
      <span class='id identifier rubyid_residual_htg_load_frac'>residual_htg_load_frac</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_htg_load_frac'>htg_load_frac</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sum(BuildingDetails/Systems/HVAC/HVACPlant/HeatingSystem/FractionHeatLoadServed)</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_htg_load_frac'>htg_load_frac</span> <span class='op'>+=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sum(BuildingDetails/Systems/HVAC/HVACPlant/HeatPump/FractionHeatLoadServed)</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_residual_htg_load_frac'>residual_htg_load_frac</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>-</span> <span class='id identifier rubyid_htg_load_frac'>htg_load_frac</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_residual_htg_load_frac'>residual_htg_load_frac</span> <span class='op'>&gt;</span> <span class='float'>0.02</span> <span class='comment'># TODO: Ensure that E+ will re-normalize if == 0.01
</span>      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_ideal_air_loads_heating'><span class='object_link'><a href="HVAC.html#apply_ideal_air_loads_heating-class_method" title="HVAC.apply_ideal_air_loads_heating (method)">apply_ideal_air_loads_heating</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_residual_htg_load_frac'>residual_htg_load_frac</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='comment'># Residual cooling
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_use_only_ideal_air'>use_only_ideal_air</span>
      <span class='id identifier rubyid_residual_clg_load_frac'>residual_clg_load_frac</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_clg_load_frac'>clg_load_frac</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sum(BuildingDetails/Systems/HVAC/HVACPlant/CoolingSystem/FractionCoolLoadServed)</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_clg_load_frac'>clg_load_frac</span> <span class='op'>+=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sum(BuildingDetails/Systems/HVAC/HVACPlant/HeatPump/FractionCoolLoadServed)</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_residual_clg_load_frac'>residual_clg_load_frac</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>-</span> <span class='id identifier rubyid_clg_load_frac'>clg_load_frac</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_residual_clg_load_frac'>residual_clg_load_frac</span> <span class='op'>&gt;</span> <span class='float'>0.02</span> <span class='comment'># TODO: Ensure that E+ will re-normalize if == 0.01
</span>      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_ideal_air_loads_cooling'><span class='object_link'><a href="HVAC.html#apply_ideal_air_loads_cooling-class_method" title="HVAC.apply_ideal_air_loads_cooling (method)">apply_ideal_air_loads_cooling</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_residual_clg_load_frac'>residual_clg_load_frac</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_setpoints'>add_setpoints</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_control'>control</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACControl</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_control'>control</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='id identifier rubyid_control_type'>control_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_control'>control</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ControlType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_heating_temp'>heating_temp</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_control'>control</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SetpointTempHeatingSeason</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_heating_temp'>heating_temp</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># Use provided value
</span>      <span class='id identifier rubyid_htg_weekday_setpoints'>htg_weekday_setpoints</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_heating_temp'>heating_temp</span><span class='rparen'>)</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>24</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>12</span>
    <span class='kw'>else</span> <span class='comment'># Use ERI default
</span>      <span class='id identifier rubyid_htg_sp'>htg_sp</span><span class='comma'>,</span> <span class='id identifier rubyid_htg_setback_sp'>htg_setback_sp</span><span class='comma'>,</span> <span class='id identifier rubyid_htg_setback_hrs_per_week'>htg_setback_hrs_per_week</span><span class='comma'>,</span> <span class='id identifier rubyid_htg_setback_start_hr'>htg_setback_start_hr</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_heating_setpoint'><span class='object_link'><a href="HVAC.html#get_default_heating_setpoint-class_method" title="HVAC.get_default_heating_setpoint (method)">get_default_heating_setpoint</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_control_type'>control_type</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_htg_setback_sp'>htg_setback_sp</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_htg_weekday_setpoints'>htg_weekday_setpoints</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_htg_sp'>htg_sp</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>24</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>12</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_htg_weekday_setpoints'>htg_weekday_setpoints</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_htg_sp'>htg_sp</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>24</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>12</span>
        <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='int'>11</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
          <span class='kw'>for</span> <span class='id identifier rubyid_hr'>hr</span> <span class='kw'>in</span> <span class='id identifier rubyid_htg_setback_start_hr'>htg_setback_start_hr</span><span class='op'>..</span><span class='id identifier rubyid_htg_setback_start_hr'>htg_setback_start_hr</span> <span class='op'>+</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_htg_setback_hrs_per_week'>htg_setback_hrs_per_week</span> <span class='op'>/</span> <span class='float'>7.0</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span>
            <span class='id identifier rubyid_htg_weekday_setpoints'>htg_weekday_setpoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_hr'>hr</span> <span class='op'>%</span> <span class='int'>24</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_htg_setback_sp'>htg_setback_sp</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_htg_weekend_setpoints'>htg_weekend_setpoints</span> <span class='op'>=</span> <span class='id identifier rubyid_htg_weekday_setpoints'>htg_weekday_setpoints</span>
    <span class='id identifier rubyid_htg_use_auto_season'>htg_use_auto_season</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_htg_season_start_month'>htg_season_start_month</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_htg_season_end_month'>htg_season_end_month</span> <span class='op'>=</span> <span class='int'>12</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_heating_setpoints'><span class='object_link'><a href="HVAC.html#apply_heating_setpoints-class_method" title="HVAC.apply_heating_setpoints (method)">apply_heating_setpoints</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_htg_weekday_setpoints'>htg_weekday_setpoints</span><span class='comma'>,</span> <span class='id identifier rubyid_htg_weekend_setpoints'>htg_weekend_setpoints</span><span class='comma'>,</span>
                                           <span class='id identifier rubyid_htg_use_auto_season'>htg_use_auto_season</span><span class='comma'>,</span> <span class='id identifier rubyid_htg_season_start_month'>htg_season_start_month</span><span class='comma'>,</span> <span class='id identifier rubyid_htg_season_end_month'>htg_season_end_month</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_cooling_temp'>cooling_temp</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_control'>control</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SetpointTempCoolingSeason</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_cooling_temp'>cooling_temp</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># Use provided value
</span>      <span class='id identifier rubyid_clg_weekday_setpoints'>clg_weekday_setpoints</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_cooling_temp'>cooling_temp</span><span class='rparen'>)</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>24</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>12</span>
    <span class='kw'>else</span> <span class='comment'># Use ERI default
</span>      <span class='id identifier rubyid_clg_sp'>clg_sp</span><span class='comma'>,</span> <span class='id identifier rubyid_clg_setup_sp'>clg_setup_sp</span><span class='comma'>,</span> <span class='id identifier rubyid_clg_setup_hrs_per_week'>clg_setup_hrs_per_week</span><span class='comma'>,</span> <span class='id identifier rubyid_clg_setup_start_hr'>clg_setup_start_hr</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_cooling_setpoint'><span class='object_link'><a href="HVAC.html#get_default_cooling_setpoint-class_method" title="HVAC.get_default_cooling_setpoint (method)">get_default_cooling_setpoint</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_control_type'>control_type</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_clg_setup_sp'>clg_setup_sp</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_clg_weekday_setpoints'>clg_weekday_setpoints</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_clg_sp'>clg_sp</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>24</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>12</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_clg_weekday_setpoints'>clg_weekday_setpoints</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_clg_sp'>clg_sp</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>24</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>12</span>
        <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='int'>11</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
          <span class='kw'>for</span> <span class='id identifier rubyid_hr'>hr</span> <span class='kw'>in</span> <span class='id identifier rubyid_clg_setup_start_hr'>clg_setup_start_hr</span><span class='op'>..</span><span class='id identifier rubyid_clg_setup_start_hr'>clg_setup_start_hr</span> <span class='op'>+</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_clg_setup_hrs_per_week'>clg_setup_hrs_per_week</span> <span class='op'>/</span> <span class='float'>7.0</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span>
            <span class='id identifier rubyid_clg_weekday_setpoints'>clg_weekday_setpoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_hr'>hr</span> <span class='op'>%</span> <span class='int'>24</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_clg_setup_sp'>clg_setup_sp</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'># Apply ceiling fan offset?
</span>    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Lighting/CeilingFan</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_cooling_setpoint_offset'>cooling_setpoint_offset</span> <span class='op'>=</span> <span class='float'>0.5</span> <span class='comment'># deg-F
</span>      <span class='id identifier rubyid_monthly_avg_temp_control'>monthly_avg_temp_control</span> <span class='op'>=</span> <span class='float'>63.0</span> <span class='comment'># deg-F
</span>      <span class='id identifier rubyid_weather'>weather</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>MonthlyAvgDrybulbs</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_monthly_avg_temp_control'>monthly_avg_temp_control</span>

        <span class='id identifier rubyid_clg_weekday_setpoints'>clg_weekday_setpoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_clg_weekday_setpoints'>clg_weekday_setpoints</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>24</span><span class='comma'>,</span> <span class='id identifier rubyid_cooling_setpoint_offset'>cooling_setpoint_offset</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_transpose'>transpose</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_reduce'>reduce</span><span class='lparen'>(</span><span class='symbol'>:+</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_clg_weekend_setpoints'>clg_weekend_setpoints</span> <span class='op'>=</span> <span class='id identifier rubyid_clg_weekday_setpoints'>clg_weekday_setpoints</span>
    <span class='id identifier rubyid_clg_use_auto_season'>clg_use_auto_season</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_clg_season_start_month'>clg_season_start_month</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_clg_season_end_month'>clg_season_end_month</span> <span class='op'>=</span> <span class='int'>12</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_cooling_setpoints'><span class='object_link'><a href="HVAC.html#apply_cooling_setpoints-class_method" title="HVAC.apply_cooling_setpoints (method)">apply_cooling_setpoints</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='id identifier rubyid_clg_weekday_setpoints'>clg_weekday_setpoints</span><span class='comma'>,</span> <span class='id identifier rubyid_clg_weekend_setpoints'>clg_weekend_setpoints</span><span class='comma'>,</span>
                                           <span class='id identifier rubyid_clg_use_auto_season'>clg_use_auto_season</span><span class='comma'>,</span> <span class='id identifier rubyid_clg_season_start_month'>clg_season_start_month</span><span class='comma'>,</span> <span class='id identifier rubyid_clg_season_end_month'>clg_season_end_month</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_dehumidifier'>add_dehumidifier</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dehumidifier'>dehumidifier</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/extension/Dehumidifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_dehumidifier'>dehumidifier</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='id identifier rubyid_energy_factor'>energy_factor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dehumidifier'>dehumidifier</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EnergyFactor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_water_removal_rate'>water_removal_rate</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dehumidifier'>dehumidifier</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WaterRemovalRrate</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_air_flow_rate'>air_flow_rate</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dehumidifier'>dehumidifier</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AirFlowRate</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_humidity_setpoint'>humidity_setpoint</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dehumidifier'>dehumidifier</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HumiditySetpoint</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_dehumidifier'><span class='object_link'><a href="HVAC.html#apply_dehumidifier-class_method" title="HVAC.apply_dehumidifier (method)">apply_dehumidifier</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_energy_factor'>energy_factor</span><span class='comma'>,</span>
                                      <span class='id identifier rubyid_water_removal_rate'>water_removal_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_air_flow_rate'>air_flow_rate</span><span class='comma'>,</span> <span class='id identifier rubyid_humidity_setpoint'>humidity_setpoint</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_ceiling_fans'>add_ceiling_fans</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cf'>cf</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Lighting/CeilingFan</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_cf'>cf</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='id identifier rubyid_medium_cfm'>medium_cfm</span> <span class='op'>=</span> <span class='float'>3000.0</span>
    <span class='id identifier rubyid_weekday_sch'>weekday_sch</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_weekend_sch'>weekend_sch</span> <span class='op'>=</span> <span class='id identifier rubyid_weekday_sch'>weekday_sch</span>
    <span class='id identifier rubyid_hrs_per_day'>hrs_per_day</span> <span class='op'>=</span> <span class='id identifier rubyid_weekday_sch'>weekday_sch</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_sum'>sum</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='op'>|</span> <span class='id identifier rubyid_sum'>sum</span> <span class='op'>+</span> <span class='id identifier rubyid_n'>n</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_cfm_per_w'>cfm_per_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cf'>cf</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Airflow[FanSpeed=&#39;medium&#39;]/Efficiency</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_cfm_per_w'>cfm_per_w</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_fan_power_w'>fan_power_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_ceiling_fan_power'><span class='object_link'><a href="HVAC.html#get_default_ceiling_fan_power-class_method" title="HVAC.get_default_ceiling_fan_power (method)">get_default_ceiling_fan_power</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cfm_per_w'>cfm_per_w</span> <span class='op'>=</span> <span class='id identifier rubyid_medium_cfm'>medium_cfm</span> <span class='op'>/</span> <span class='id identifier rubyid_fan_power_w'>fan_power_w</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cfm_per_w'>cfm_per_w</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_cfm_per_w'>cfm_per_w</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_quantity'>quantity</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_cf'>cf</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Quantity</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_quantity'>quantity</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_quantity'>quantity</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_ceiling_fan_quantity'><span class='object_link'><a href="HVAC.html#get_default_ceiling_fan_quantity-class_method" title="HVAC.get_default_ceiling_fan_quantity (method)">get_default_ceiling_fan_quantity</a></span></span><span class='lparen'>(</span><span class='ivar'>@nbeds</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_quantity'>quantity</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_quantity'>quantity</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_annual_kwh'>annual_kwh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_quantity'>quantity</span> <span class='op'>*</span> <span class='id identifier rubyid_medium_cfm'>medium_cfm</span> <span class='op'>/</span> <span class='id identifier rubyid_cfm_per_w'>cfm_per_w</span> <span class='op'>*</span> <span class='id identifier rubyid_hrs_per_day'>hrs_per_day</span> <span class='op'>*</span> <span class='float'>365.0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wh</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>kWh</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_eri_ceiling_fans'><span class='object_link'><a href="HVAC.html#apply_eri_ceiling_fans-class_method" title="HVAC.apply_eri_ceiling_fans (method)">apply_eri_ceiling_fans</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_annual_kwh'>annual_kwh</span><span class='comma'>,</span> <span class='id identifier rubyid_weekday_sch'>weekday_sch</span><span class='comma'>,</span> <span class='id identifier rubyid_weekend_sch'>weekend_sch</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_dse'>get_dse</span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_system'>system</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_system'>system</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># No distribution system
</span>      <span class='kw'>return</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># Get attached distribution system
</span>    <span class='id identifier rubyid_ducts'>ducts</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_duct_id'>duct_id</span> <span class='op'>=</span> <span class='id identifier rubyid_system'>system</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACDistribution</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dist'>dist</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_duct_id'>duct_id</span> <span class='op'>!=</span> <span class='id identifier rubyid_dist'>dist</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_dist'>dist</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystemType[Other=&#39;DSE&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

      <span class='id identifier rubyid_ducts'>ducts</span> <span class='op'>=</span> <span class='id identifier rubyid_dist'>dist</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ducts'>ducts</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># No attached DSEs for system
</span>      <span class='kw'>return</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_dse_cool'>dse_cool</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_ducts'>ducts</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualCoolingDistributionSystemEfficiency</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dse_heat'>dse_heat</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_ducts'>ducts</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualHeatingDistributionSystemEfficiency</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_cool'>dse_cool</span><span class='comma'>,</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_zone_hvacs'>get_zone_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getThermalZones'>getThermalZones</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_zone'>zone</span><span class='op'>|</span>
      <span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_equipment'>equipment</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_zone_hvac'>zone_hvac</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_zone_hvac'>zone_hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_ZoneHVACComponent'>to_ZoneHVACComponent</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>

        <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_zone_hvac'>zone_hvac</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_loop_hvacs'>update_loop_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_sys'>sys</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_air_loops'>orig_air_loops</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_plant_loops'>orig_plant_loops</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_zone_hvacs'>orig_zone_hvacs</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sys_id'>sys_id</span> <span class='op'>=</span> <span class='id identifier rubyid_sys'>sys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getAirLoopHVACs'>getAirLoopHVACs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_air_loop'>air_loop</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_orig_air_loops'>orig_air_loops</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_air_loop'>air_loop</span> <span class='comment'># Only include newly added air loops
</span>
      <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_air_loop'>air_loop</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getPlantLoops'>getPlantLoops</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_plant_loop'>plant_loop</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_orig_plant_loops'>orig_plant_loops</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_plant_loop'>plant_loop</span> <span class='comment'># Only include newly added plant loops
</span>
      <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_plant_loop'>plant_loop</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_get_zone_hvacs'>get_zone_hvacs</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_zone_hvac'>zone_hvac</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_orig_zone_hvacs'>orig_zone_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_zone_hvac'>zone_hvac</span>

      <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_zone_hvac'>zone_hvac</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='comma'>,</span> <span class='id identifier rubyid_loops'>loops</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_loops'>loops</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

      <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='comma'>,</span> <span class='id identifier rubyid_hvacs'>hvacs</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_hvacs'>hvacs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

      <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_mels'>add_mels</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_living_space'>living_space</span> <span class='op'>=</span> <span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeLiving-class_method" title="Constants.SpaceTypeLiving (method)">SpaceTypeLiving</a></span></span><span class='rparen'>)</span>

    <span class='comment'># Misc
</span>    <span class='id identifier rubyid_misc'>misc</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/PlugLoad[PlugLoadType=&#39;other&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_misc'>misc</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_misc_annual_kwh'>misc_annual_kwh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/PlugLoad[PlugLoadType=&#39;other&#39;]/Load[Units=&#39;kWh/year&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_misc_annual_kwh'>misc_annual_kwh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_misc_annual_kwh'>misc_annual_kwh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MiscLoads.html" title="MiscLoads (class)">MiscLoads</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_residual_mels_values'><span class='object_link'><a href="MiscLoads.html#get_residual_mels_values-class_method" title="MiscLoads.get_residual_mels_values (method)">get_residual_mels_values</a></span></span><span class='lparen'>(</span><span class='ivar'>@cfa</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_misc_annual_kwh'>misc_annual_kwh</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_misc_annual_kwh'>misc_annual_kwh</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_misc_sens_frac'>misc_sens_frac</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/PlugLoad[PlugLoadType=&#39;other&#39;]/extension/FracSensible</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_misc_sens_frac'>misc_sens_frac</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_misc_sens_frac'>misc_sens_frac</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MiscLoads.html" title="MiscLoads (class)">MiscLoads</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_residual_mels_values'><span class='object_link'><a href="MiscLoads.html#get_residual_mels_values-class_method" title="MiscLoads.get_residual_mels_values (method)">get_residual_mels_values</a></span></span><span class='lparen'>(</span><span class='ivar'>@cfa</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_misc_sens_frac'>misc_sens_frac</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_misc_sens_frac'>misc_sens_frac</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_misc_lat_frac'>misc_lat_frac</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/PlugLoad[PlugLoadType=&#39;other&#39;]/extension/FracLatent</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_misc_lat_frac'>misc_lat_frac</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_misc_lat_frac'>misc_lat_frac</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MiscLoads.html" title="MiscLoads (class)">MiscLoads</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_residual_mels_values'><span class='object_link'><a href="MiscLoads.html#get_residual_mels_values-class_method" title="MiscLoads.get_residual_mels_values (method)">get_residual_mels_values</a></span></span><span class='lparen'>(</span><span class='ivar'>@cfa</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_misc_lat_frac'>misc_lat_frac</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_misc_lat_frac'>misc_lat_frac</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_misc_weekday_sch'>misc_weekday_sch</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/extension/WeekdayScheduleFractions</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_misc_weekday_sch'>misc_weekday_sch</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_misc_weekday_sch'>misc_weekday_sch</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.04, 0.037, 0.037, 0.036, 0.033, 0.036, 0.043, 0.047, 0.034, 0.023, 0.024, 0.025, 0.024, 0.028, 0.031, 0.032, 0.039, 0.053, 0.063, 0.067, 0.071, 0.069, 0.059, 0.05</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_misc_weekend_sch'>misc_weekend_sch</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/extension/WeekendScheduleFractions</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_misc_weekend_sch'>misc_weekend_sch</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_misc_weekend_sch'>misc_weekend_sch</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.04, 0.037, 0.037, 0.036, 0.033, 0.036, 0.043, 0.047, 0.034, 0.023, 0.024, 0.025, 0.024, 0.028, 0.031, 0.032, 0.039, 0.053, 0.063, 0.067, 0.071, 0.069, 0.059, 0.05</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_misc_monthly_sch'>misc_monthly_sch</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/extension/MonthlyScheduleMultipliers</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_misc_monthly_sch'>misc_monthly_sch</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_misc_monthly_sch'>misc_monthly_sch</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1.248, 1.257, 0.993, 0.989, 0.993, 0.827, 0.821, 0.821, 0.827, 0.99, 0.987, 1.248</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_sch'>sch</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MiscLoads.html" title="MiscLoads (class)">MiscLoads</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_plug'><span class='object_link'><a href="MiscLoads.html#apply_plug-class_method" title="MiscLoads.apply_plug (method)">apply_plug</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_misc_annual_kwh'>misc_annual_kwh</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_misc_sens_frac'>misc_sens_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_misc_lat_frac'>misc_lat_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_misc_weekday_sch'>misc_weekday_sch</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_misc_weekend_sch'>misc_weekend_sch</span><span class='comma'>,</span> <span class='id identifier rubyid_misc_monthly_sch'>misc_monthly_sch</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='comment'># Television
</span>    <span class='id identifier rubyid_tv'>tv</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/PlugLoad[PlugLoadType=&#39;TV other&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_tv'>tv</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_tv_annual_kwh'>tv_annual_kwh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/MiscLoads/PlugLoad[PlugLoadType=&#39;TV other&#39;]/Load[Units=&#39;kWh/year&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_tv_annual_kwh'>tv_annual_kwh</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_tv_annual_kwh'>tv_annual_kwh</span><span class='comma'>,</span> <span class='id identifier rubyid_tv_sens_frac'>tv_sens_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_tv_lat_frac'>tv_lat_frac</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MiscLoads.html" title="MiscLoads (class)">MiscLoads</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_televisions_values'><span class='object_link'><a href="MiscLoads.html#get_televisions_values-class_method" title="MiscLoads.get_televisions_values (method)">get_televisions_values</a></span></span><span class='lparen'>(</span><span class='ivar'>@cfa</span><span class='comma'>,</span> <span class='ivar'>@nbeds</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_tv_annual_kwh'>tv_annual_kwh</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_tv_annual_kwh'>tv_annual_kwh</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MiscLoads.html" title="MiscLoads (class)">MiscLoads</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_tv'><span class='object_link'><a href="MiscLoads.html#apply_tv-class_method" title="MiscLoads.apply_tv (method)">apply_tv</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_tv_annual_kwh'>tv_annual_kwh</span><span class='comma'>,</span> <span class='id identifier rubyid_sch'>sch</span><span class='comma'>,</span> <span class='id identifier rubyid_living_space'>living_space</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_lighting'>add_lighting</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Lighting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='id identifier rubyid_lighting_fractions'>lighting_fractions</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Lighting/LightingFractions</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_lighting_fractions'>lighting_fractions</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_fFI_int'>fFI_int</span><span class='comma'>,</span> <span class='id identifier rubyid_fFI_ext'>fFI_ext</span><span class='comma'>,</span> <span class='id identifier rubyid_fFI_grg'>fFI_grg</span><span class='comma'>,</span> <span class='id identifier rubyid_fFII_int'>fFII_int</span><span class='comma'>,</span> <span class='id identifier rubyid_fFII_ext'>fFII_ext</span><span class='comma'>,</span> <span class='id identifier rubyid_fFII_grg'>fFII_grg</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Lighting.html" title="Lighting (class)">Lighting</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_reference_fractions'><span class='object_link'><a href="Lighting.html#get_reference_fractions-class_method" title="Lighting.get_reference_fractions (method)">get_reference_fractions</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fFI_int'>fFI_int</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lighting_fractions'>lighting_fractions</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/FractionQualifyingTierIFixturesInterior</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fFI_ext'>fFI_ext</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lighting_fractions'>lighting_fractions</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/FractionQualifyingTierIFixturesExterior</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fFI_grg'>fFI_grg</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lighting_fractions'>lighting_fractions</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/FractionQualifyingTierIFixturesGarage</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fFII_int'>fFII_int</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lighting_fractions'>lighting_fractions</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/FractionQualifyingTierIIFixturesInterior</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fFII_ext'>fFII_ext</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lighting_fractions'>lighting_fractions</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/FractionQualifyingTierIIFixturesExterior</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fFII_grg'>fFII_grg</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lighting_fractions'>lighting_fractions</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/FractionQualifyingTierIIFixturesGarage</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_int_kwh'>int_kwh</span><span class='comma'>,</span> <span class='id identifier rubyid_ext_kwh'>ext_kwh</span><span class='comma'>,</span> <span class='id identifier rubyid_grg_kwh'>grg_kwh</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Lighting.html" title="Lighting (class)">Lighting</a></span></span><span class='period'>.</span><span class='id identifier rubyid_calc_lighting_energy'><span class='object_link'><a href="Lighting.html#calc_lighting_energy-class_method" title="Lighting.calc_lighting_energy (method)">calc_lighting_energy</a></span></span><span class='lparen'>(</span><span class='ivar'>@eri_version</span><span class='comma'>,</span> <span class='ivar'>@cfa</span><span class='comma'>,</span> <span class='ivar'>@garage_present</span><span class='comma'>,</span> <span class='id identifier rubyid_fFI_int'>fFI_int</span><span class='comma'>,</span> <span class='id identifier rubyid_fFI_ext'>fFI_ext</span><span class='comma'>,</span> <span class='id identifier rubyid_fFI_grg'>fFI_grg</span><span class='comma'>,</span> <span class='id identifier rubyid_fFII_int'>fFII_int</span><span class='comma'>,</span> <span class='id identifier rubyid_fFII_ext'>fFII_ext</span><span class='comma'>,</span> <span class='id identifier rubyid_fFII_grg'>fFII_grg</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_sch'>sch</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Lighting.html" title="Lighting (class)">Lighting</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_interior'><span class='object_link'><a href="Lighting.html#apply_interior-class_method" title="Lighting.apply_interior (method)">apply_interior</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_int_kwh'>int_kwh</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Lighting.html" title="Lighting (class)">Lighting</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_garage'><span class='object_link'><a href="Lighting.html#apply_garage-class_method" title="Lighting.apply_garage (method)">apply_garage</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_sch'>sch</span><span class='comma'>,</span> <span class='id identifier rubyid_grg_kwh'>grg_kwh</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Lighting.html" title="Lighting (class)">Lighting</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_exterior'><span class='object_link'><a href="Lighting.html#apply_exterior-class_method" title="Lighting.apply_exterior (method)">apply_exterior</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_sch'>sch</span><span class='comma'>,</span> <span class='id identifier rubyid_ext_kwh'>ext_kwh</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_airflow'>add_airflow</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='rparen'>)</span>
    <span class='comment'># Infiltration
</span>    <span class='id identifier rubyid_infiltration'>infiltration</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/AirInfiltration</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_infil_ach50'>infil_ach50</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_infiltration'>infiltration</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AirInfiltrationMeasurement[HousePressure=&#39;50&#39;]/BuildingAirLeakage[UnitofMeasure=&#39;ACH&#39;]/AirLeakage</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_infil_const_ach'>infil_const_ach</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_infiltration'>infiltration</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AirInfiltrationMeasurement/extension/ConstantACHnatural</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_infil_ach50'>infil_ach50</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_infil_ach50'>infil_ach50</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_infil_ach50'>infil_ach50</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='kw'>not</span> <span class='id identifier rubyid_infil_const_ach'>infil_const_ach</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_infil_const_ach'>infil_const_ach</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_infil_const_ach'>infil_const_ach</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Vented crawl SLA
</span>    <span class='id identifier rubyid_vented_crawl_area'>vented_crawl_area</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='id identifier rubyid_vented_crawl_sla_area'>vented_crawl_sla_area</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Foundations/Foundation[FoundationType/Crawlspace[Vented=&#39;true&#39;]]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_vented_crawl'>vented_crawl</span><span class='op'>|</span>
      <span class='id identifier rubyid_area'>area</span> <span class='op'>=</span> <span class='const'>REXML</span><span class='op'>::</span><span class='const'>XPath</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lparen'>(</span><span class='id identifier rubyid_vented_crawl'>vented_crawl</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sum(FrameFloor/Area)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_vented_crawl_sla'>vented_crawl_sla</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_vented_crawl'>vented_crawl</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/CrawlspaceSpecificLeakageArea</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_vented_crawl_sla'>vented_crawl_sla</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_vented_crawl_sla'>vented_crawl_sla</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_vented_crawl_sla'>vented_crawl_sla</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_vented_crawl_sla'>vented_crawl_sla</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airflow.html" title="Airflow (class)">Airflow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_vented_crawl_sla'><span class='object_link'><a href="Airflow.html#get_default_vented_crawl_sla-class_method" title="Airflow.get_default_vented_crawl_sla (method)">get_default_vented_crawl_sla</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_vented_crawl_sla_area'>vented_crawl_sla_area</span> <span class='op'>+=</span> <span class='lparen'>(</span><span class='id identifier rubyid_vented_crawl_sla'>vented_crawl_sla</span> <span class='op'>*</span> <span class='id identifier rubyid_area'>area</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_vented_crawl_area'>vented_crawl_area</span> <span class='op'>+=</span> <span class='id identifier rubyid_area'>area</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_vented_crawl_area'>vented_crawl_area</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_crawl_sla'>crawl_sla</span> <span class='op'>=</span> <span class='id identifier rubyid_vented_crawl_sla_area'>vented_crawl_sla_area</span> <span class='op'>/</span> <span class='id identifier rubyid_vented_crawl_area'>vented_crawl_area</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_crawl_sla'>crawl_sla</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='kw'>end</span>

    <span class='comment'># Vented attic SLA
</span>    <span class='id identifier rubyid_vented_attic_area'>vented_attic_area</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='id identifier rubyid_vented_attic_sla_area'>vented_attic_sla_area</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='id identifier rubyid_vented_attic_const_ach'>vented_attic_const_ach</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/Attics/Attic[AtticType=&#39;vented attic&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_vented_attic'>vented_attic</span><span class='op'>|</span>
      <span class='id identifier rubyid_area'>area</span> <span class='op'>=</span> <span class='const'>REXML</span><span class='op'>::</span><span class='const'>XPath</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lparen'>(</span><span class='id identifier rubyid_vented_attic'>vented_attic</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sum(Floors/Floor/Area)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_vented_attic_sla'>vented_attic_sla</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_vented_attic'>vented_attic</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/AtticSpecificLeakageArea</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_vented_attic_const_ach'>vented_attic_const_ach</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_vented_attic'>vented_attic</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extension/AtticConstantACHnatural</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_vented_attic_sla'>vented_attic_sla</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_vented_attic_sla'>vented_attic_sla</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_vented_attic_sla'>vented_attic_sla</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_vented_attic_sla_area'>vented_attic_sla_area</span> <span class='op'>+=</span> <span class='lparen'>(</span><span class='id identifier rubyid_vented_attic_sla'>vented_attic_sla</span> <span class='op'>*</span> <span class='id identifier rubyid_area'>area</span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='kw'>not</span> <span class='id identifier rubyid_vented_attic_const_ach'>vented_attic_const_ach</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_vented_attic_const_ach'>vented_attic_const_ach</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_vented_attic_const_ach'>vented_attic_const_ach</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_vented_attic_sla'>vented_attic_sla</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airflow.html" title="Airflow (class)">Airflow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_vented_attic_sla'><span class='object_link'><a href="Airflow.html#get_default_vented_attic_sla-class_method" title="Airflow.get_default_vented_attic_sla (method)">get_default_vented_attic_sla</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_vented_attic_sla_area'>vented_attic_sla_area</span> <span class='op'>+=</span> <span class='lparen'>(</span><span class='id identifier rubyid_vented_attic_sla'>vented_attic_sla</span> <span class='op'>*</span> <span class='id identifier rubyid_area'>area</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_vented_attic_area'>vented_attic_area</span> <span class='op'>+=</span> <span class='id identifier rubyid_area'>area</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_vented_attic_area'>vented_attic_area</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='id identifier rubyid_attic_sla'>attic_sla</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_attic_const_ach'>attic_const_ach</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_vented_attic_sla_area'>vented_attic_sla_area</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_attic_sla'>attic_sla</span> <span class='op'>=</span> <span class='id identifier rubyid_vented_attic_sla_area'>vented_attic_sla_area</span> <span class='op'>/</span> <span class='id identifier rubyid_vented_attic_area'>vented_attic_area</span>
      <span class='id identifier rubyid_attic_const_ach'>attic_const_ach</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_attic_sla'>attic_sla</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_attic_const_ach'>attic_const_ach</span> <span class='op'>=</span> <span class='id identifier rubyid_vented_attic_const_ach'>vented_attic_const_ach</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_living_ach50'>living_ach50</span> <span class='op'>=</span> <span class='id identifier rubyid_infil_ach50'>infil_ach50</span>
    <span class='id identifier rubyid_living_constant_ach'>living_constant_ach</span> <span class='op'>=</span> <span class='id identifier rubyid_infil_const_ach'>infil_const_ach</span>
    <span class='id identifier rubyid_garage_ach50'>garage_ach50</span> <span class='op'>=</span> <span class='id identifier rubyid_infil_ach50'>infil_ach50</span>
    <span class='id identifier rubyid_finished_basement_ach'>finished_basement_ach</span> <span class='op'>=</span> <span class='int'>0</span> <span class='comment'># TODO: Need to handle above-grade basement
</span>    <span class='id identifier rubyid_unfinished_basement_ach'>unfinished_basement_ach</span> <span class='op'>=</span> <span class='float'>0.1</span> <span class='comment'># TODO: Need to handle above-grade basement
</span>    <span class='id identifier rubyid_crawl_ach'>crawl_ach</span> <span class='op'>=</span> <span class='id identifier rubyid_crawl_sla'>crawl_sla</span> <span class='comment'># FIXME: sla vs ach
</span>    <span class='id identifier rubyid_pier_beam_ach'>pier_beam_ach</span> <span class='op'>=</span> <span class='int'>100</span>
    <span class='id identifier rubyid_shelter_coef'>shelter_coef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/BuildingSummary/Site/extension/ShelterCoefficient</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_shelter_coef'>shelter_coef</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_shelter_coef'>shelter_coef</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airflow.html" title="Airflow (class)">Airflow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_shelter_coefficient'><span class='object_link'><a href="Airflow.html#get_default_shelter_coefficient-class_method" title="Airflow.get_default_shelter_coefficient (method)">get_default_shelter_coefficient</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_shelter_coef'>shelter_coef</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_shelter_coef'>shelter_coef</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_has_flue_chimney'>has_flue_chimney</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_is_existing_home'>is_existing_home</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_terrain'>terrain</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#TerrainSuburban-class_method" title="Constants.TerrainSuburban (method)">TerrainSuburban</a></span></span>
    <span class='id identifier rubyid_infil'>infil</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Infiltration.html" title="Infiltration (class)">Infiltration</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Infiltration.html#initialize-instance_method" title="Infiltration#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_living_ach50'>living_ach50</span><span class='comma'>,</span> <span class='id identifier rubyid_living_constant_ach'>living_constant_ach</span><span class='comma'>,</span> <span class='id identifier rubyid_shelter_coef'>shelter_coef</span><span class='comma'>,</span> <span class='id identifier rubyid_garage_ach50'>garage_ach50</span><span class='comma'>,</span> <span class='id identifier rubyid_crawl_ach'>crawl_ach</span><span class='comma'>,</span> <span class='id identifier rubyid_attic_sla'>attic_sla</span><span class='comma'>,</span> <span class='id identifier rubyid_attic_const_ach'>attic_const_ach</span><span class='comma'>,</span> <span class='id identifier rubyid_unfinished_basement_ach'>unfinished_basement_ach</span><span class='comma'>,</span>
                             <span class='id identifier rubyid_finished_basement_ach'>finished_basement_ach</span><span class='comma'>,</span> <span class='id identifier rubyid_pier_beam_ach'>pier_beam_ach</span><span class='comma'>,</span> <span class='id identifier rubyid_has_flue_chimney'>has_flue_chimney</span><span class='comma'>,</span> <span class='id identifier rubyid_is_existing_home'>is_existing_home</span><span class='comma'>,</span> <span class='id identifier rubyid_terrain'>terrain</span><span class='rparen'>)</span>

    <span class='comment'># Mechanical Ventilation
</span>    <span class='id identifier rubyid_whole_house_fan'>whole_house_fan</span> <span class='op'>=</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/MechanicalVentilation/VentilationFans/VentilationFan[UsedForWholeBuildingVentilation=&#39;true&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_whole_house_fan'>whole_house_fan</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_mech_vent_type'>mech_vent_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#VentTypeNone-class_method" title="Constants.VentTypeNone (method)">VentTypeNone</a></span></span>
      <span class='id identifier rubyid_mech_vent_total_efficiency'>mech_vent_total_efficiency</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_mech_vent_sensible_efficiency'>mech_vent_sensible_efficiency</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_mech_vent_fan_power'>mech_vent_fan_power</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_mech_vent_cfm'>mech_vent_cfm</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='kw'>else</span>
      <span class='comment'># FIXME: HoursInOperation isn&#39;t hooked up
</span>      <span class='comment'># FIXME: AttachedToHVACDistributionSystem isn&#39;t hooked up
</span>      <span class='id identifier rubyid_fan_type'>fan_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_whole_house_fan'>whole_house_fan</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FanType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_fan_type'>fan_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>supply only</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_mech_vent_type'>mech_vent_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#VentTypeSupply-class_method" title="Constants.VentTypeSupply (method)">VentTypeSupply</a></span></span>
        <span class='id identifier rubyid_num_fans'>num_fans</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_fan_type'>fan_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exhaust only</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_mech_vent_type'>mech_vent_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#VentTypeExhaust-class_method" title="Constants.VentTypeExhaust (method)">VentTypeExhaust</a></span></span>
        <span class='id identifier rubyid_num_fans'>num_fans</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_fan_type'>fan_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>central fan integrated supply</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_mech_vent_type'>mech_vent_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#VentTypeCFIS-class_method" title="Constants.VentTypeCFIS (method)">VentTypeCFIS</a></span></span>
        <span class='id identifier rubyid_num_fans'>num_fans</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>balanced</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>energy recovery ventilator</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>heat recovery ventilator</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_fan_type'>fan_type</span>
        <span class='id identifier rubyid_mech_vent_type'>mech_vent_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#VentTypeBalanced-class_method" title="Constants.VentTypeBalanced (method)">VentTypeBalanced</a></span></span>
        <span class='id identifier rubyid_num_fans'>num_fans</span> <span class='op'>=</span> <span class='float'>2.0</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_mech_vent_total_efficiency'>mech_vent_total_efficiency</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='id identifier rubyid_mech_vent_sensible_efficiency'>mech_vent_sensible_efficiency</span> <span class='op'>=</span> <span class='float'>0.0</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_fan_type'>fan_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>energy recovery ventilator</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='id identifier rubyid_fan_type'>fan_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>heat recovery ventilator</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_mech_vent_sensible_efficiency'>mech_vent_sensible_efficiency</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_whole_house_fan'>whole_house_fan</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SensibleRecoveryEfficiency</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_fan_type'>fan_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>energy recovery ventilator</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_mech_vent_total_efficiency'>mech_vent_total_efficiency</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_whole_house_fan'>whole_house_fan</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TotalRecoveryEfficiency</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_mech_vent_cfm'>mech_vent_cfm</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_whole_house_fan'>whole_house_fan</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RatedFlowRate</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_mech_vent_w'>mech_vent_w</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_whole_house_fan'>whole_house_fan</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FanPower</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_mech_vent_fan_power'>mech_vent_fan_power</span> <span class='op'>=</span> <span class='id identifier rubyid_mech_vent_w'>mech_vent_w</span> <span class='op'>/</span> <span class='id identifier rubyid_mech_vent_cfm'>mech_vent_cfm</span> <span class='op'>/</span> <span class='id identifier rubyid_num_fans'>num_fans</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_mech_vent_ashrae_std'>mech_vent_ashrae_std</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2013</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_mech_vent_infil_credit'>mech_vent_infil_credit</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_mech_vent_cfis_open_time'>mech_vent_cfis_open_time</span> <span class='op'>=</span> <span class='float'>20.0</span>
    <span class='id identifier rubyid_mech_vent_cfis_airflow_frac'>mech_vent_cfis_airflow_frac</span> <span class='op'>=</span> <span class='float'>1.0</span>
    <span class='id identifier rubyid_clothes_dryer_exhaust'>clothes_dryer_exhaust</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='id identifier rubyid_range_exhaust'>range_exhaust</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='id identifier rubyid_range_exhaust_hour'>range_exhaust_hour</span> <span class='op'>=</span> <span class='int'>16</span>
    <span class='id identifier rubyid_bathroom_exhaust'>bathroom_exhaust</span> <span class='op'>=</span> <span class='float'>0.0</span>
    <span class='id identifier rubyid_bathroom_exhaust_hour'>bathroom_exhaust_hour</span> <span class='op'>=</span> <span class='int'>5</span>
    <span class='id identifier rubyid_mech_vent'>mech_vent</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MechanicalVentilation.html" title="MechanicalVentilation (class)">MechanicalVentilation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="MechanicalVentilation.html#initialize-instance_method" title="MechanicalVentilation#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_mech_vent_type'>mech_vent_type</span><span class='comma'>,</span> <span class='id identifier rubyid_mech_vent_infil_credit'>mech_vent_infil_credit</span><span class='comma'>,</span> <span class='id identifier rubyid_mech_vent_total_efficiency'>mech_vent_total_efficiency</span><span class='comma'>,</span>
                                          <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_mech_vent_cfm'>mech_vent_cfm</span><span class='comma'>,</span> <span class='id identifier rubyid_mech_vent_fan_power'>mech_vent_fan_power</span><span class='comma'>,</span> <span class='id identifier rubyid_mech_vent_sensible_efficiency'>mech_vent_sensible_efficiency</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_mech_vent_ashrae_std'>mech_vent_ashrae_std</span><span class='comma'>,</span> <span class='id identifier rubyid_clothes_dryer_exhaust'>clothes_dryer_exhaust</span><span class='comma'>,</span> <span class='id identifier rubyid_range_exhaust'>range_exhaust</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_range_exhaust_hour'>range_exhaust_hour</span><span class='comma'>,</span> <span class='id identifier rubyid_bathroom_exhaust'>bathroom_exhaust</span><span class='comma'>,</span> <span class='id identifier rubyid_bathroom_exhaust_hour'>bathroom_exhaust_hour</span><span class='rparen'>)</span>
    <span class='comment'># FIXME: AttachedToHVACDistributionSystem isn&#39;t hooked up
</span>    <span class='id identifier rubyid_cfis'>cfis</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="CFIS.html" title="CFIS (class)">CFIS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="CFIS.html#initialize-instance_method" title="CFIS#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_mech_vent_cfis_open_time'>mech_vent_cfis_open_time</span><span class='comma'>,</span> <span class='id identifier rubyid_mech_vent_cfis_airflow_frac'>mech_vent_cfis_airflow_frac</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cfis_systems'>cfis_systems</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_cfis'>cfis</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getAirLoopHVACs'>getAirLoopHVACs</span> <span class='rbrace'>}</span>

    <span class='comment'># Natural Ventilation
</span>    <span class='id identifier rubyid_disable_nat_vent'>disable_nat_vent</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Enclosure/extension/DisableNaturalVentilation</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_disable_nat_vent'>disable_nat_vent</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#Boolean-instance_method" title="#Boolean (method)">Boolean</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_disable_nat_vent'>disable_nat_vent</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_nat_vent_htg_offset'>nat_vent_htg_offset</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_nat_vent_clg_offset'>nat_vent_clg_offset</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_nat_vent_ovlp_offset'>nat_vent_ovlp_offset</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_nat_vent_htg_season'>nat_vent_htg_season</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_nat_vent_clg_season'>nat_vent_clg_season</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_nat_vent_ovlp_season'>nat_vent_ovlp_season</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_nat_vent_num_weekdays'>nat_vent_num_weekdays</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_nat_vent_num_weekends'>nat_vent_num_weekends</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_nat_vent_frac_windows_open'>nat_vent_frac_windows_open</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_nat_vent_frac_window_area_openable'>nat_vent_frac_window_area_openable</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_nat_vent_max_oa_hr'>nat_vent_max_oa_hr</span> <span class='op'>=</span> <span class='float'>0.0115</span>
      <span class='id identifier rubyid_nat_vent_max_oa_rh'>nat_vent_max_oa_rh</span> <span class='op'>=</span> <span class='float'>0.7</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_nat_vent_htg_offset'>nat_vent_htg_offset</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='id identifier rubyid_nat_vent_clg_offset'>nat_vent_clg_offset</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='id identifier rubyid_nat_vent_ovlp_offset'>nat_vent_ovlp_offset</span> <span class='op'>=</span> <span class='float'>1.0</span>
      <span class='id identifier rubyid_nat_vent_htg_season'>nat_vent_htg_season</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_nat_vent_clg_season'>nat_vent_clg_season</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_nat_vent_ovlp_season'>nat_vent_ovlp_season</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_nat_vent_num_weekdays'>nat_vent_num_weekdays</span> <span class='op'>=</span> <span class='int'>5</span>
      <span class='id identifier rubyid_nat_vent_num_weekends'>nat_vent_num_weekends</span> <span class='op'>=</span> <span class='int'>2</span>
      <span class='id identifier rubyid_nat_vent_frac_windows_open'>nat_vent_frac_windows_open</span> <span class='op'>=</span> <span class='float'>0.33</span>
      <span class='id identifier rubyid_nat_vent_frac_window_area_openable'>nat_vent_frac_window_area_openable</span> <span class='op'>=</span> <span class='float'>0.2</span>
      <span class='id identifier rubyid_nat_vent_max_oa_hr'>nat_vent_max_oa_hr</span> <span class='op'>=</span> <span class='float'>0.0115</span>
      <span class='id identifier rubyid_nat_vent_max_oa_rh'>nat_vent_max_oa_rh</span> <span class='op'>=</span> <span class='float'>0.7</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_nat_vent'>nat_vent</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="NaturalVentilation.html" title="NaturalVentilation (class)">NaturalVentilation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="NaturalVentilation.html#initialize-instance_method" title="NaturalVentilation#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_nat_vent_htg_offset'>nat_vent_htg_offset</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent_clg_offset'>nat_vent_clg_offset</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent_ovlp_offset'>nat_vent_ovlp_offset</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent_htg_season'>nat_vent_htg_season</span><span class='comma'>,</span>
                                      <span class='id identifier rubyid_nat_vent_clg_season'>nat_vent_clg_season</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent_ovlp_season'>nat_vent_ovlp_season</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent_num_weekdays'>nat_vent_num_weekdays</span><span class='comma'>,</span>
                                      <span class='id identifier rubyid_nat_vent_num_weekends'>nat_vent_num_weekends</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent_frac_windows_open'>nat_vent_frac_windows_open</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent_frac_window_area_openable'>nat_vent_frac_window_area_openable</span><span class='comma'>,</span>
                                      <span class='id identifier rubyid_nat_vent_max_oa_hr'>nat_vent_max_oa_hr</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent_max_oa_rh'>nat_vent_max_oa_rh</span><span class='rparen'>)</span>

    <span class='comment'># Ducts
</span>    <span class='id identifier rubyid_duct_systems'>duct_systems</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACDistribution</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hvac_distribution'>hvac_distribution</span><span class='op'>|</span>
      <span class='id identifier rubyid_air_distribution'>air_distribution</span> <span class='op'>=</span> <span class='id identifier rubyid_hvac_distribution'>hvac_distribution</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystemType/AirDistribution</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_air_distribution'>air_distribution</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

      <span class='comment'># Ducts
</span>      <span class='id identifier rubyid_supply_cfm25'>supply_cfm25</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_air_distribution'>air_distribution</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DuctLeakageMeasurement[DuctType=&#39;supply&#39;]/DuctLeakage[Units=&#39;CFM25&#39; and TotalOrToOutside=&#39;to outside&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_return_cfm25'>return_cfm25</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_air_distribution'>air_distribution</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DuctLeakageMeasurement[DuctType=&#39;return&#39;]/DuctLeakage[Units=&#39;CFM25&#39; and TotalOrToOutside=&#39;to outside&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_supply_r'>supply_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_air_distribution'>air_distribution</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ducts[DuctType=&#39;supply&#39;]/DuctInsulationRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_return_r'>return_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_air_distribution'>air_distribution</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ducts[DuctType=&#39;return&#39;]/DuctInsulationRValue</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_supply_area'>supply_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_air_distribution'>air_distribution</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ducts[DuctType=&#39;supply&#39;]/DuctSurfaceArea</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_return_area'>return_area</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_air_distribution'>air_distribution</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ducts[DuctType=&#39;return&#39;]/DuctSurfaceArea</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='comment'># FIXME: Values below
</span>      <span class='id identifier rubyid_duct_location'>duct_location</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#Auto-class_method" title="Constants.Auto (method)">Auto</a></span></span>
      <span class='id identifier rubyid_duct_total_leakage'>duct_total_leakage</span> <span class='op'>=</span> <span class='float'>0.3</span>
      <span class='id identifier rubyid_duct_supply_frac'>duct_supply_frac</span> <span class='op'>=</span> <span class='float'>0.6</span>
      <span class='id identifier rubyid_duct_return_frac'>duct_return_frac</span> <span class='op'>=</span> <span class='float'>0.067</span>
      <span class='id identifier rubyid_duct_ah_supply_frac'>duct_ah_supply_frac</span> <span class='op'>=</span> <span class='float'>0.067</span>
      <span class='id identifier rubyid_duct_ah_return_frac'>duct_ah_return_frac</span> <span class='op'>=</span> <span class='float'>0.267</span>
      <span class='id identifier rubyid_duct_location_frac'>duct_location_frac</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#Auto-class_method" title="Constants.Auto (method)">Auto</a></span></span>
      <span class='id identifier rubyid_duct_num_returns'>duct_num_returns</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_duct_supply_area_mult'>duct_supply_area_mult</span> <span class='op'>=</span> <span class='id identifier rubyid_supply_area'>supply_area</span> <span class='op'>/</span> <span class='float'>100.0</span>
      <span class='id identifier rubyid_duct_return_area_mult'>duct_return_area_mult</span> <span class='op'>=</span> <span class='id identifier rubyid_return_area'>return_area</span> <span class='op'>/</span> <span class='float'>100.0</span>
      <span class='id identifier rubyid_duct_r'>duct_r</span> <span class='op'>=</span> <span class='float'>4.0</span>
      <span class='id identifier rubyid_duct_norm_leakage_25pa'>duct_norm_leakage_25pa</span> <span class='op'>=</span> <span class='kw'>nil</span>

      <span class='id identifier rubyid_ducts'>ducts</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Ducts.html" title="Ducts (class)">Ducts</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Ducts.html#initialize-instance_method" title="Ducts#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_duct_total_leakage'>duct_total_leakage</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_norm_leakage_25pa'>duct_norm_leakage_25pa</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_supply_area_mult'>duct_supply_area_mult</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_return_area_mult'>duct_return_area_mult</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_r'>duct_r</span><span class='comma'>,</span>
                        <span class='id identifier rubyid_duct_supply_frac'>duct_supply_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_return_frac'>duct_return_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_ah_supply_frac'>duct_ah_supply_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_ah_return_frac'>duct_ah_return_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_location_frac'>duct_location_frac</span><span class='comma'>,</span>
                        <span class='id identifier rubyid_duct_num_returns'>duct_num_returns</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_location'>duct_location</span><span class='rparen'>)</span>

      <span class='comment'># Connect AirLoopHVACs to ducts
</span>      <span class='id identifier rubyid_systems_for_this_duct'>systems_for_this_duct</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_duct_id'>duct_id</span> <span class='op'>=</span> <span class='id identifier rubyid_hvac_distribution'>hvac_distribution</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACPlant/HeatingSystem[FractionHeatLoadServed &gt; 0] |
                              BuildingDetails/Systems/HVAC/HVACPlant/CoolingSystem[FractionCoolLoadServed &gt; 0] |
                              BuildingDetails/Systems/HVAC/HVACPlant/HeatPump[FractionHeatLoadServed &gt; 0 &amp;&amp; FractionCoolLoadServed &gt; 0]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys'>sys</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_sys'>sys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_duct_id'>duct_id</span> <span class='op'>!=</span> <span class='id identifier rubyid_sys'>sys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_sys_id'>sys_id</span> <span class='op'>=</span> <span class='id identifier rubyid_sys'>sys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_loop'>loop</span><span class='op'>|</span>
          <span class='kw'>next</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_loop'>loop</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>AirLoopHVAC</span>

          <span class='id identifier rubyid_systems_for_this_duct'>systems_for_this_duct</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_loop'>loop</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_duct_systems'>duct_systems</span><span class='lbracket'>[</span><span class='id identifier rubyid_ducts'>ducts</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_systems_for_this_duct'>systems_for_this_duct</span>
    <span class='kw'>end</span>

    <span class='comment'># Set no ducts for HVAC without duct systems
</span>    <span class='id identifier rubyid_systems_for_no_duct'>systems_for_no_duct</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_no_ducts'>no_ducts</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Ducts.html" title="Ducts (class)">Ducts</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Ducts.html#initialize-instance_method" title="Ducts#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#Auto-class_method" title="Constants.Auto (method)">Auto</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#Auto-class_method" title="Constants.Auto (method)">Auto</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>none</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='comma'>,</span> <span class='id identifier rubyid_loops'>loops</span><span class='op'>|</span>
      <span class='id identifier rubyid_loops'>loops</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_loop'>loop</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_loop'>loop</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>AirLoopHVAC</span>

        <span class='comment'># Look for loop already associated with a duct system
</span>        <span class='id identifier rubyid_loop_found'>loop_found</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_duct_systems'>duct_systems</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_duct_system'>duct_system</span><span class='op'>|</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_duct_systems'>duct_systems</span><span class='lbracket'>[</span><span class='id identifier rubyid_duct_system'>duct_system</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_loop'>loop</span>
            <span class='id identifier rubyid_loop_found'>loop_found</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_loop_found'>loop_found</span>

        <span class='comment'># Loop has no associated ducts; associate with no duct system
</span>        <span class='id identifier rubyid_systems_for_no_duct'>systems_for_no_duct</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_loop'>loop</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_systems_for_no_duct'>systems_for_no_duct</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_duct_systems'>duct_systems</span><span class='lbracket'>[</span><span class='id identifier rubyid_no_ducts'>no_ducts</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_systems_for_no_duct'>systems_for_no_duct</span>
    <span class='kw'>end</span>

    <span class='comment'># FIXME: Throw error if, e.g., multiple heating systems connected to same distribution system?
</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airflow.html" title="Airflow (class)">Airflow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply'><span class='object_link'><a href="Airflow.html#apply-class_method" title="Airflow.apply (method)">apply</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_infil'>infil</span><span class='comma'>,</span> <span class='id identifier rubyid_mech_vent'>mech_vent</span><span class='comma'>,</span> <span class='id identifier rubyid_nat_vent'>nat_vent</span><span class='comma'>,</span> <span class='id identifier rubyid_duct_systems'>duct_systems</span><span class='comma'>,</span> <span class='id identifier rubyid_cfis_systems'>cfis_systems</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_hvac_sizing'>add_hvac_sizing</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVACSizing.html" title="HVACSizing (class)">HVACSizing</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply'><span class='object_link'><a href="HVACSizing.html#apply-class_method" title="HVACSizing.apply (method)">apply</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_unit'>unit</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_weather'>weather</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_fuel_heating_eae'>add_fuel_heating_eae</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='rparen'>)</span>
    <span class='comment'># Needs to come after HVAC sizing (needs heating capacity and airflow rate)
</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACPlant/HeatingSystem[FractionHeatLoadServed &gt; 0]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='op'>|</span>
      <span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_child_name'><span class='object_link'><a href="XMLHelper.html#get_child_name-class_method" title="XMLHelper.get_child_name (method)">get_child_name</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HeatingSystemType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Furnace</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallFurnace</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Stove</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Boiler</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_htg_type'>htg_type</span>

      <span class='id identifier rubyid_fuel'>fuel</span> <span class='op'>=</span> <span class='id identifier rubyid_to_beopt_fuel'>to_beopt_fuel</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HeatingSystemFuel</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_fuel'>fuel</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#FuelTypeElectric-class_method" title="Constants.FuelTypeElectric (method)">FuelTypeElectric</a></span></span>

      <span class='id identifier rubyid_fuel_eae'>fuel_eae</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ElectricAuxiliaryEnergy</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_fuel_eae'>fuel_eae</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_fuel_eae'>fuel_eae</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_fuel_eae'>fuel_eae</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_load_frac'>load_frac</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FractionHeatLoadServed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_cool'>dse_cool</span><span class='comma'>,</span> <span class='id identifier rubyid_has_dse'>has_dse</span> <span class='op'>=</span> <span class='id identifier rubyid_get_dse'>get_dse</span><span class='lparen'>(</span><span class='id identifier rubyid_building'>building</span><span class='comma'>,</span> <span class='id identifier rubyid_htgsys'>htgsys</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_sys_id'>sys_id</span> <span class='op'>=</span> <span class='id identifier rubyid_htgsys'>htgsys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_eae_loop_hvac'>eae_loop_hvac</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_eae_zone_hvacs'>eae_zone_hvacs</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_eae_loop_hvac_cool'>eae_loop_hvac_cool</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_sys_id'>sys_id</span>
        <span class='id identifier rubyid_eae_loop_hvac'>eae_loop_hvac</span> <span class='op'>=</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_has_furnace'>has_furnace</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Furnace</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_has_boiler'>has_boiler</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_htg_type'>htg_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Boiler</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_has_furnace'>has_furnace</span>
          <span class='comment'># Check for cooling system on the same supply fan
</span>          <span class='id identifier rubyid_htgdist'>htgdist</span> <span class='op'>=</span> <span class='id identifier rubyid_htgsys'>htgsys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACPlant/CoolingSystem[FractionCoolLoadServed &gt; 0]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='op'>|</span>
            <span class='id identifier rubyid_clgdist'>clgdist</span> <span class='op'>=</span> <span class='id identifier rubyid_clgsys'>clgsys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_htgdist'>htgdist</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_clgdist'>clgdist</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_clgdist'>clgdist</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_htgdist'>htgdist</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

            <span class='id identifier rubyid_eae_loop_hvac_cool'>eae_loop_hvac_cool</span> <span class='op'>=</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_sys_id'>sys_id</span>
        <span class='id identifier rubyid_eae_zone_hvacs'>eae_zone_hvacs</span> <span class='op'>=</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_eae_to_heating_fan'><span class='object_link'><a href="HVAC.html#apply_eae_to_heating_fan-class_method" title="HVAC.apply_eae_to_heating_fan (method)">apply_eae_to_heating_fan</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_eae_loop_hvac'>eae_loop_hvac</span><span class='comma'>,</span> <span class='id identifier rubyid_eae_zone_hvacs'>eae_zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel_eae'>fuel_eae</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel'>fuel</span><span class='comma'>,</span> <span class='id identifier rubyid_dse_heat'>dse_heat</span><span class='comma'>,</span>
                                              <span class='id identifier rubyid_has_furnace'>has_furnace</span><span class='comma'>,</span> <span class='id identifier rubyid_has_boiler'>has_boiler</span><span class='comma'>,</span> <span class='id identifier rubyid_load_frac'>load_frac</span><span class='comma'>,</span> <span class='id identifier rubyid_eae_loop_hvac_cool'>eae_loop_hvac_cool</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_photovoltaics'>add_photovoltaics</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/Photovoltaics/PVSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='id identifier rubyid_modules_map'>modules_map</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>standard</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#PVModuleTypeStandard-class_method" title="Constants.PVModuleTypeStandard (method)">PVModuleTypeStandard</a></span></span><span class='comma'>,</span>
                    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>premium</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#PVModuleTypePremium-class_method" title="Constants.PVModuleTypePremium (method)">PVModuleTypePremium</a></span></span><span class='comma'>,</span>
                    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>thin film</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#PVModuleTypeThinFilm-class_method" title="Constants.PVModuleTypeThinFilm (method)">PVModuleTypeThinFilm</a></span></span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_arrays_map'>arrays_map</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fixed open rack</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#PVArrayTypeFixedOpenRack-class_method" title="Constants.PVArrayTypeFixedOpenRack (method)">PVArrayTypeFixedOpenRack</a></span></span><span class='comma'>,</span>
                   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fixed roof mount</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#PVArrayTypeFixedRoofMount-class_method" title="Constants.PVArrayTypeFixedRoofMount (method)">PVArrayTypeFixedRoofMount</a></span></span><span class='comma'>,</span>
                   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1-axis</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#PVArrayTypeFixed1Axis-class_method" title="Constants.PVArrayTypeFixed1Axis (method)">PVArrayTypeFixed1Axis</a></span></span><span class='comma'>,</span>
                   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1-axis backtracked</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#PVArrayTypeFixed1AxisBacktracked-class_method" title="Constants.PVArrayTypeFixed1AxisBacktracked (method)">PVArrayTypeFixed1AxisBacktracked</a></span></span><span class='comma'>,</span>
                   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2-axis</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#PVArrayTypeFixed2Axis-class_method" title="Constants.PVArrayTypeFixed2Axis (method)">PVArrayTypeFixed2Axis</a></span></span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/Photovoltaics/PVSystem</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pvsys'>pvsys</span><span class='op'>|</span>
      <span class='id identifier rubyid_pv_id'>pv_id</span> <span class='op'>=</span> <span class='id identifier rubyid_pvsys'>pvsys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemIdentifier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_module_type'>module_type</span> <span class='op'>=</span> <span class='id identifier rubyid_modules_map'>modules_map</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_pvsys'>pvsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ModuleType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_array_type'>array_type</span> <span class='op'>=</span> <span class='id identifier rubyid_arrays_map'>arrays_map</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_pvsys'>pvsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ArrayType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_az'>az</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_pvsys'>pvsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ArrayAzimuth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_tilt'>tilt</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_pvsys'>pvsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ArrayTilt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_power_w'>power_w</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_pvsys'>pvsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MaxPowerOutput</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_inv_eff'>inv_eff</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_pvsys'>pvsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>InverterEfficiency</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_system_losses'>system_losses</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_pvsys'>pvsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SystemLossesFraction</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PV.html" title="PV (class)">PV</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply'><span class='object_link'><a href="PV.html#apply-class_method" title="PV.apply (method)">apply</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_pv_id'>pv_id</span><span class='comma'>,</span> <span class='id identifier rubyid_power_w'>power_w</span><span class='comma'>,</span> <span class='id identifier rubyid_module_type'>module_type</span><span class='comma'>,</span>
                         <span class='id identifier rubyid_system_losses'>system_losses</span><span class='comma'>,</span> <span class='id identifier rubyid_inv_eff'>inv_eff</span><span class='comma'>,</span> <span class='id identifier rubyid_tilt'>tilt</span><span class='comma'>,</span> <span class='id identifier rubyid_az'>az</span><span class='comma'>,</span> <span class='id identifier rubyid_array_type'>array_type</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_building_output_variables'>add_building_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='comma'>,</span> <span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_htg_mapping'>htg_mapping</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_clg_mapping'>clg_mapping</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

    <span class='comment'># AirLoopHVAC systems
</span>    <span class='id identifier rubyid_loop_hvacs'>loop_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='comma'>,</span> <span class='id identifier rubyid_loops'>loops</span><span class='op'>|</span>
      <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_loops'>loops</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_loop'>loop</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_loop'>loop</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>AirLoopHVAC</span>

        <span class='id identifier rubyid_loop'>loop</span><span class='period'>.</span><span class='id identifier rubyid_supplyComponents'>supplyComponents</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_comp'>comp</span><span class='op'>|</span>
          <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_to_AirLoopHVACUnitarySystem'>to_AirLoopHVACUnitarySystem</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>

          <span class='id identifier rubyid_unitary_system'>unitary_system</span> <span class='op'>=</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_to_AirLoopHVACUnitarySystem'>to_AirLoopHVACUnitarySystem</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_coolingCoil'>coolingCoil</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
            <span class='comment'># Cooling system: Cooling coil, supply fan
</span>            <span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_coil_from_hvac_component'>get_coil_from_hvac_component</span><span class='lparen'>(</span><span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_coolingCoil'>coolingCoil</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_supplyFan'>supplyFan</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_to_FanOnOff'>to_FanOnOff</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
          <span class='kw'>elsif</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_heatingCoil'>heatingCoil</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
            <span class='comment'># Heating system: Heating coil, supply fan, supplemental coil
</span>            <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_coil_from_hvac_component'>get_coil_from_hvac_component</span><span class='lparen'>(</span><span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_heatingCoil'>heatingCoil</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_supplyFan'>supplyFan</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_to_FanOnOff'>to_FanOnOff</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_supplementalHeatingCoil'>supplementalHeatingCoil</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
              <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_coil_from_hvac_component'>get_coil_from_hvac_component</span><span class='lparen'>(</span><span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_supplementalHeatingCoil'>supplementalHeatingCoil</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_zone_hvacs'>zone_hvacs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='comma'>,</span> <span class='id identifier rubyid_hvacs'>hvacs</span><span class='op'>|</span>
      <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_hvacs'>hvacs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hvac'>hvac</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_ZoneHVACComponent'>to_ZoneHVACComponent</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_AirLoopHVACUnitarySystem'>to_AirLoopHVACUnitarySystem</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>

          <span class='id identifier rubyid_unitary_system'>unitary_system</span> <span class='op'>=</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_AirLoopHVACUnitarySystem'>to_AirLoopHVACUnitarySystem</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_coolingCoil'>coolingCoil</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
            <span class='comment'># Cooling system: Cooling coil, supply fan
</span>            <span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_coil_from_hvac_component'>get_coil_from_hvac_component</span><span class='lparen'>(</span><span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_coolingCoil'>coolingCoil</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_supplyFan'>supplyFan</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_to_FanOnOff'>to_FanOnOff</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
          <span class='kw'>elsif</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_heatingCoil'>heatingCoil</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
            <span class='comment'># Heating system: Heating coil, supply fan
</span>            <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_coil_from_hvac_component'>get_coil_from_hvac_component</span><span class='lparen'>(</span><span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_heatingCoil'>heatingCoil</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_unitary_system'>unitary_system</span><span class='period'>.</span><span class='id identifier rubyid_supplyFan'>supplyFan</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_to_FanOnOff'>to_FanOnOff</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
          <span class='kw'>end</span>

        <span class='kw'>elsif</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_ZoneHVACPackagedTerminalAirConditioner'>to_ZoneHVACPackagedTerminalAirConditioner</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>

          <span class='id identifier rubyid_ptac'>ptac</span> <span class='op'>=</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_ZoneHVACPackagedTerminalAirConditioner'>to_ZoneHVACPackagedTerminalAirConditioner</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
          <span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="HVAC.html" title="HVAC (class)">HVAC</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_coil_from_hvac_component'>get_coil_from_hvac_component</span><span class='lparen'>(</span><span class='id identifier rubyid_ptac'>ptac</span><span class='period'>.</span><span class='id identifier rubyid_coolingCoil'>coolingCoil</span><span class='rparen'>)</span>

        <span class='kw'>elsif</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_ZoneHVACBaseboardConvectiveElectric'>to_ZoneHVACBaseboardConvectiveElectric</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>

          <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_ZoneHVACBaseboardConvectiveElectric'>to_ZoneHVACBaseboardConvectiveElectric</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>

        <span class='kw'>elsif</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_ZoneHVACBaseboardConvectiveWater'>to_ZoneHVACBaseboardConvectiveWater</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>

          <span class='id identifier rubyid_baseboard'>baseboard</span> <span class='op'>=</span> <span class='id identifier rubyid_hvac'>hvac</span><span class='period'>.</span><span class='id identifier rubyid_to_ZoneHVACBaseboardConvectiveWater'>to_ZoneHVACBaseboardConvectiveWater</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
          <span class='id identifier rubyid_baseboard'>baseboard</span><span class='period'>.</span><span class='id identifier rubyid_heatingCoil'>heatingCoil</span><span class='period'>.</span><span class='id identifier rubyid_plantLoop'>plantLoop</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_components'>components</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_comp'>comp</span><span class='op'>|</span>
            <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_to_BoilerHotWater'>to_BoilerHotWater</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>

            <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_to_BoilerHotWater'>to_BoilerHotWater</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='comma'>,</span> <span class='id identifier rubyid_htg_equip_list'>htg_equip_list</span><span class='op'>|</span>
      <span class='id identifier rubyid_add_output_variables'>add_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#OutputVarsSpaceHeatingElectricity-class_method" title="Constants.OutputVarsSpaceHeatingElectricity (method)">OutputVarsSpaceHeatingElectricity</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_htg_equip_list'>htg_equip_list</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_add_output_variables'>add_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#OutputVarsSpaceHeatingFuel-class_method" title="Constants.OutputVarsSpaceHeatingFuel (method)">OutputVarsSpaceHeatingFuel</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_htg_equip_list'>htg_equip_list</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_add_output_variables'>add_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#OutputVarsSpaceHeatingLoad-class_method" title="Constants.OutputVarsSpaceHeatingLoad (method)">OutputVarsSpaceHeatingLoad</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_htg_equip_list'>htg_equip_list</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='comma'>,</span> <span class='id identifier rubyid_clg_equip_list'>clg_equip_list</span><span class='op'>|</span>
      <span class='id identifier rubyid_add_output_variables'>add_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#OutputVarsSpaceCoolingElectricity-class_method" title="Constants.OutputVarsSpaceCoolingElectricity (method)">OutputVarsSpaceCoolingElectricity</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_clg_equip_list'>clg_equip_list</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_add_output_variables'>add_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#OutputVarsSpaceCoolingLoad-class_method" title="Constants.OutputVarsSpaceCoolingLoad (method)">OutputVarsSpaceCoolingLoad</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_clg_equip_list'>clg_equip_list</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_add_output_variables'>add_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#OutputVarsWaterHeatingLoad-class_method" title="Constants.OutputVarsWaterHeatingLoad (method)">OutputVarsWaterHeatingLoad</a></span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
      <span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
      <span class='id identifier rubyid_write_mapping'>write_mapping</span><span class='lparen'>(</span><span class='id identifier rubyid_htg_mapping'>htg_mapping</span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map_hvac_heating.tsv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_write_mapping'>write_mapping</span><span class='lparen'>(</span><span class='id identifier rubyid_clg_mapping'>clg_mapping</span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_map_tsv_dir'>map_tsv_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map_hvac_cooling.tsv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_output_variables'>add_output_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_vars'>vars</span><span class='comma'>,</span> <span class='id identifier rubyid_objects'>objects</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_objects'>objects</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_vars'>vars</span><span class='lbracket'>[</span><span class='kw'>nil</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_object_var'>object_var</span><span class='op'>|</span>
        <span class='id identifier rubyid_outputVariable'>outputVariable</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>OutputVariable</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_object_var'>object_var</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_outputVariable'>outputVariable</span><span class='period'>.</span><span class='id identifier rubyid_setReportingFrequency'>setReportingFrequency</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>runperiod</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_outputVariable'>outputVariable</span><span class='period'>.</span><span class='id identifier rubyid_setKeyValue'>setKeyValue</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_objects'>objects</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_vars'>vars</span><span class='lbracket'>[</span><span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected object type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_vars'>vars</span><span class='lbracket'>[</span><span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_object_var'>object_var</span><span class='op'>|</span>
          <span class='id identifier rubyid_outputVariable'>outputVariable</span> <span class='op'>=</span> <span class='const'>OpenStudio</span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>OutputVariable</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_object_var'>object_var</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_outputVariable'>outputVariable</span><span class='period'>.</span><span class='id identifier rubyid_setReportingFrequency'>setReportingFrequency</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>runperiod</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_outputVariable'>outputVariable</span><span class='period'>.</span><span class='id identifier rubyid_setKeyValue'>setKeyValue</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_write_mapping'>write_mapping</span><span class='lparen'>(</span><span class='id identifier rubyid_mapping'>mapping</span><span class='comma'>,</span> <span class='id identifier rubyid_map_tsv_path'>map_tsv_path</span><span class='rparen'>)</span>
    <span class='comment'># Write simple mapping TSV file for use by ERI calculation. Mapping file correlates
</span>    <span class='comment'># EnergyPlus object name to a HPXML object name.
</span>
    <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_map_tsv_path'>map_tsv_path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>w</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>col_sep:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tsv'>tsv</span><span class='op'>|</span>
      <span class='comment'># Header
</span>      <span class='id identifier rubyid_tsv'>tsv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HPXML Name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>E+ Name(s)</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='comma'>,</span> <span class='id identifier rubyid_objects'>objects</span><span class='op'>|</span>
        <span class='id identifier rubyid_out_data'>out_data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_sys_id'>sys_id</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_objects'>objects</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='op'>|</span>
          <span class='id identifier rubyid_out_data'>out_data</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_tsv'>tsv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_out_data'>out_data</span> <span class='kw'>if</span> <span class='id identifier rubyid_out_data'>out_data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calc_non_cavity_r'>calc_non_cavity_r</span><span class='lparen'>(</span><span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='rparen'>)</span>
    <span class='comment'># Calculate R-value for all non-cavity layers
</span>    <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_film_r'>film_r</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>+=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>+=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>+=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Plywood-class_method" title="Material.Plywood (method)">Plywood</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>+=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#GypsumWall-class_method" title="Material.GypsumWall (method)">GypsumWall</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_apply_wall_construction'>apply_wall_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_id'>wall_id</span><span class='comma'>,</span> <span class='id identifier rubyid_wall_type'>wall_type</span><span class='comma'>,</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span>
                                   <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='comma'>,</span> <span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='comma'>,</span> <span class='id identifier rubyid_emitt'>emitt</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WoodStud</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_default_frame_wall_ufactor'><span class='object_link'><a href="WallConstructions.html#get_default_frame_wall_ufactor-class_method" title="WallConstructions.get_default_frame_wall_ufactor (method)">get_default_frame_wall_ufactor</a></span></span><span class='lparen'>(</span><span class='ivar'>@iecc_zone_2006</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_install_grade'>install_grade</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_cavity_filled'>cavity_filled</span> <span class='op'>=</span> <span class='kw'>true</span>

      <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x6-class_method" title="Material.Stud2x6 (method)">Stud2x6</a></span></span><span class='comma'>,</span> <span class='float'>0.20</span><span class='comma'>,</span> <span class='float'>10.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 2x6, 24&quot; o.c. + R10
</span>        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x6-class_method" title="Material.Stud2x6 (method)">Stud2x6</a></span></span><span class='comma'>,</span> <span class='float'>0.20</span><span class='comma'>,</span> <span class='float'>5.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x6, 24&quot; o.c. + R5
</span>        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x6-class_method" title="Material.Stud2x6 (method)">Stud2x6</a></span></span><span class='comma'>,</span> <span class='float'>0.20</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x6, 24&quot; o.c.
</span>        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.23</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x4, 16&quot; o.c.
</span>        <span class='const'>WoodStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                          <span class='comment'># Fallback
</span>      <span class='rbracket'>]</span>
      <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_wood_stud_construction_set'>pick_wood_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_wood_stud'><span class='object_link'><a href="WallConstructions.html#apply_wood_stud-class_method" title="WallConstructions.apply_wood_stud (method)">apply_wood_stud</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_cavity_r'>cavity_r</span><span class='comma'>,</span> <span class='id identifier rubyid_install_grade'>install_grade</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_cavity_filled'>cavity_filled</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SteelFrame</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_install_grade'>install_grade</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_cavity_filled'>cavity_filled</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_corr_factor'>corr_factor</span> <span class='op'>=</span> <span class='float'>0.45</span>

      <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
        <span class='const'>SteelStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>5.5</span><span class='comma'>,</span> <span class='id identifier rubyid_corr_factor'>corr_factor</span><span class='comma'>,</span> <span class='float'>0.20</span><span class='comma'>,</span> <span class='float'>10.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 2x6, 24&quot; o.c. + R10
</span>        <span class='const'>SteelStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>5.5</span><span class='comma'>,</span> <span class='id identifier rubyid_corr_factor'>corr_factor</span><span class='comma'>,</span> <span class='float'>0.20</span><span class='comma'>,</span> <span class='float'>5.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x6, 24&quot; o.c. + R5
</span>        <span class='const'>SteelStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>5.5</span><span class='comma'>,</span> <span class='id identifier rubyid_corr_factor'>corr_factor</span><span class='comma'>,</span> <span class='float'>0.20</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x6, 24&quot; o.c.
</span>        <span class='const'>SteelStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>3.5</span><span class='comma'>,</span> <span class='id identifier rubyid_corr_factor'>corr_factor</span><span class='comma'>,</span> <span class='float'>0.23</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x4, 16&quot; o.c.
</span>        <span class='const'>SteelStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>3.5</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                                  <span class='comment'># Fallback
</span>      <span class='rbracket'>]</span>
      <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_steel_stud_construction_set'>pick_steel_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_steel_stud'><span class='object_link'><a href="WallConstructions.html#apply_steel_stud-class_method" title="WallConstructions.apply_steel_stud (method)">apply_steel_stud</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_cavity_r'>cavity_r</span><span class='comma'>,</span> <span class='id identifier rubyid_install_grade'>install_grade</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_cavity_thick_in'>cavity_thick_in</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_cavity_filled'>cavity_filled</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_corr_factor'>corr_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span>
                                                   <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DoubleWoodStud</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_install_grade'>install_grade</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_is_staggered'>is_staggered</span> <span class='op'>=</span> <span class='kw'>false</span>

      <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
        <span class='const'>DoubleStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.23</span><span class='comma'>,</span> <span class='float'>24.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 2x4, 24&quot; o.c.
</span>        <span class='const'>DoubleStudConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Material.html#Stud2x4-class_method" title="Material.Stud2x4 (method)">Stud2x4</a></span></span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>16.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                          <span class='comment'># Fallback
</span>      <span class='rbracket'>]</span>
      <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_double_stud_construction_set'>pick_double_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_double_stud'><span class='object_link'><a href="WallConstructions.html#apply_double_stud-class_method" title="WallConstructions.apply_double_stud (method)">apply_double_stud</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                    <span class='id identifier rubyid_cavity_r'>cavity_r</span><span class='comma'>,</span> <span class='id identifier rubyid_install_grade'>install_grade</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span>
                                                    <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                                    <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_spacing'>framing_spacing</span><span class='comma'>,</span> <span class='id identifier rubyid_is_staggered'>is_staggered</span><span class='comma'>,</span>
                                                    <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span>
                                                    <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ConcreteMasonryUnit</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_density'>density</span> <span class='op'>=</span> <span class='float'>119.0</span> <span class='comment'># lb/ft^3
</span>      <span class='id identifier rubyid_furring_r'>furring_r</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_furring_cavity_depth_in'>furring_cavity_depth_in</span> <span class='op'>=</span> <span class='int'>0</span> <span class='comment'># in
</span>      <span class='id identifier rubyid_furring_spacing'>furring_spacing</span> <span class='op'>=</span> <span class='int'>0</span>

      <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
        <span class='const'>CMUConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>8.0</span><span class='comma'>,</span> <span class='float'>1.4</span><span class='comma'>,</span> <span class='float'>0.08</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 8&quot; perlite-filled CMU
</span>        <span class='const'>CMUConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>6.0</span><span class='comma'>,</span> <span class='float'>5.29</span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                         <span class='comment'># Fallback (6&quot; hollow CMU)
</span>      <span class='rbracket'>]</span>
      <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_cmu_construction_set'>pick_cmu_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_cmu'><span class='object_link'><a href="WallConstructions.html#apply_cmu-class_method" title="WallConstructions.apply_cmu (method)">apply_cmu</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_cond_in'>cond_in</span><span class='comma'>,</span> <span class='id identifier rubyid_density'>density</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_furring_r'>furring_r</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_furring_cavity_depth_in'>furring_cavity_depth_in</span><span class='comma'>,</span> <span class='id identifier rubyid_furring_spacing'>furring_spacing</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StructurallyInsulatedPanel</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sheathing_thick_in'>sheathing_thick_in</span> <span class='op'>=</span> <span class='float'>0.44</span>
      <span class='id identifier rubyid_sheathing_type'>sheathing_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#MaterialOSB-class_method" title="Constants.MaterialOSB (method)">MaterialOSB</a></span></span>

      <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
        <span class='const'>SIPConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>10.0</span><span class='comma'>,</span> <span class='float'>0.16</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='id identifier rubyid_sheathing_thick_in'>sheathing_thick_in</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># 10&quot; SIP core
</span>        <span class='const'>SIPConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>5.0</span><span class='comma'>,</span> <span class='float'>0.16</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='id identifier rubyid_sheathing_thick_in'>sheathing_thick_in</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># 5&quot; SIP core
</span>        <span class='const'>SIPConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='id identifier rubyid_sheathing_thick_in'>sheathing_thick_in</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                          <span class='comment'># Fallback
</span>      <span class='rbracket'>]</span>
      <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_sip_construction_set'>pick_sip_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_sip'><span class='object_link'><a href="WallConstructions.html#apply_sip-class_method" title="WallConstructions.apply_sip (method)">apply_sip</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_cavity_r'>cavity_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_sheathing_type'>sheathing_type</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_sheath_thick_in'>sheath_thick_in</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>InsulatedConcreteForms</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
        <span class='const'>ICFConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>2.0</span><span class='comma'>,</span> <span class='float'>4.0</span><span class='comma'>,</span> <span class='float'>0.08</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># ICF w/4&quot; concrete and 2&quot; rigid ins layers
</span>        <span class='const'>ICFConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='float'>0.01</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                         <span class='comment'># Fallback
</span>      <span class='rbracket'>]</span>
      <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_icf_r'>icf_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_icf_construction_set'>pick_icf_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_icf'><span class='object_link'><a href="WallConstructions.html#apply_icf-class_method" title="WallConstructions.apply_icf (method)">apply_icf</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_icf_r'>icf_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_ins_thick_in'>ins_thick_in</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_concrete_thick_in'>concrete_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SolidConcrete</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StructuralBrick</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StrawBale</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Stone</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LogWall</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_wall_type'>wall_type</span>
      <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_constr_sets'>constr_sets</span> <span class='op'>=</span> <span class='lbracket'>[</span>
        <span class='const'>GenericConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>10.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># w/R-10 rigid
</span>        <span class='const'>GenericConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.5</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_mat_ext_finish'>mat_ext_finish</span><span class='rparen'>)</span><span class='comma'>,</span>  <span class='comment'># Standard
</span>        <span class='const'>GenericConstructionSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span>                          <span class='comment'># Fallback
</span>      <span class='rbracket'>]</span>
      <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_layer_r'>layer_r</span> <span class='op'>=</span> <span class='id identifier rubyid_pick_generic_construction_set'>pick_generic_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_id'>wall_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SolidConcrete</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_thick_in'>thick_in</span> <span class='op'>=</span> <span class='float'>6.0</span>
        <span class='id identifier rubyid_base_mat'>base_mat</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Concrete-class_method" title="BaseMaterial.Concrete (method)">Concrete</a></span></span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StructuralBrick</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_thick_in'>thick_in</span> <span class='op'>=</span> <span class='float'>8.0</span>
        <span class='id identifier rubyid_base_mat'>base_mat</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Brick-class_method" title="BaseMaterial.Brick (method)">Brick</a></span></span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StrawBale</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_thick_in'>thick_in</span> <span class='op'>=</span> <span class='float'>23.0</span>
        <span class='id identifier rubyid_base_mat'>base_mat</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#StrawBale-class_method" title="BaseMaterial.StrawBale (method)">StrawBale</a></span></span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Stone</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_thick_in'>thick_in</span> <span class='op'>=</span> <span class='float'>6.0</span>
        <span class='id identifier rubyid_base_mat'>base_mat</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Stone-class_method" title="BaseMaterial.Stone (method)">Stone</a></span></span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_wall_type'>wall_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LogWall</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_thick_in'>thick_in</span> <span class='op'>=</span> <span class='float'>6.0</span>
        <span class='id identifier rubyid_base_mat'>base_mat</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Wood-class_method" title="BaseMaterial.Wood (method)">Wood</a></span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_thick_ins'>thick_ins</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_conds'>conds</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_thick_in'>thick_in</span> <span class='op'>/</span> <span class='id identifier rubyid_layer_r'>layer_r</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_denss'>denss</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_base_mat'>base_mat</span><span class='period'>.</span><span class='id identifier rubyid_rho'>rho</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_specheats'>specheats</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_base_mat'>base_mat</span><span class='period'>.</span><span class='id identifier rubyid_cp'>cp</span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WallConstructions.html" title="WallConstructions (class)">WallConstructions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_generic'><span class='object_link'><a href="WallConstructions.html#apply_generic-class_method" title="WallConstructions.apply_generic (method)">apply_generic</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_runner'>runner</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_surface'>surface</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WallConstruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                <span class='id identifier rubyid_thick_ins'>thick_ins</span><span class='comma'>,</span> <span class='id identifier rubyid_conds'>conds</span><span class='comma'>,</span> <span class='id identifier rubyid_denss'>denss</span><span class='comma'>,</span> <span class='id identifier rubyid_specheats'>specheats</span><span class='comma'>,</span>
                                                <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span>
                                                <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_success'>success</span>

    <span class='kw'>else</span>

      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected wall type &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wall_type'>wall_type</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>

    <span class='kw'>end</span>

    <span class='id identifier rubyid_check_surface_assembly_rvalue'>check_surface_assembly_rvalue</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_apply_solar_abs_emittance_to_construction'>apply_solar_abs_emittance_to_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='comma'>,</span> <span class='id identifier rubyid_emitt'>emitt</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pick_wood_stud_construction_set'>pick_wood_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_name'>surface_name</span><span class='rparen'>)</span>
    <span class='comment'># Picks a construction set from supplied constr_sets for which a positive R-value
</span>    <span class='comment'># can be calculated for the unknown insulation to achieve the assembly R-value.
</span>
    <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='op'>|</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected object.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>WoodStudConstructionSet</span>

      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_calc_non_cavity_r'>calc_non_cavity_r</span><span class='lparen'>(</span><span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='rparen'>)</span>

      <span class='comment'># Calculate effective cavity R-value
</span>      <span class='comment'># Assumes installation quality 1
</span>      <span class='id identifier rubyid_cavity_frac'>cavity_frac</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>-</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span>
      <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_cavity_frac'>cavity_frac</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='float'>1.0</span> <span class='op'>/</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>-</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span> <span class='op'>+</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='comment'># Choose this construction set
</span>        <span class='kw'>return</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to calculate a construction for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_name'>surface_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; using the provided assembly R-value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pick_steel_stud_construction_set'>pick_steel_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_name'>surface_name</span><span class='rparen'>)</span>
    <span class='comment'># Picks a construction set from supplied constr_sets for which a positive R-value
</span>    <span class='comment'># can be calculated for the unknown insulation to achieve the assembly R-value.
</span>
    <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='op'>|</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected object.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>SteelStudConstructionSet</span>

      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_calc_non_cavity_r'>calc_non_cavity_r</span><span class='lparen'>(</span><span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='rparen'>)</span>

      <span class='comment'># Calculate effective cavity R-value
</span>      <span class='comment'># Assumes installation quality 1
</span>      <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>-</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_corr_factor'>corr_factor</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='comment'># Choose this construction set
</span>        <span class='kw'>return</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to calculate a construction for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_name'>surface_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; using the provided assembly R-value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pick_double_stud_construction_set'>pick_double_stud_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_name'>surface_name</span><span class='rparen'>)</span>
    <span class='comment'># Picks a construction set from supplied constr_sets for which a positive R-value
</span>    <span class='comment'># can be calculated for the unknown insulation to achieve the assembly R-value.
</span>
    <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='op'>|</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected object.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>DoubleStudConstructionSet</span>

      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_calc_non_cavity_r'>calc_non_cavity_r</span><span class='lparen'>(</span><span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='rparen'>)</span>

      <span class='comment'># Calculate effective cavity R-value
</span>      <span class='comment'># Assumes installation quality 1, not staggered, gap depth == stud depth
</span>      <span class='comment'># Solved in Wolfram Alpha: https://www.wolframalpha.com/input/?i=1%2FA+%3D+B%2F(2*C%2Bx%2BD)+%2B+E%2F(3*C%2BD)+%2B+(1-B-E)%2F(3*x%2BD)
</span>      <span class='id identifier rubyid_stud_frac'>stud_frac</span> <span class='op'>=</span> <span class='float'>1.5</span> <span class='op'>/</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_spacing'>framing_spacing</span>
      <span class='id identifier rubyid_misc_framing_factor'>misc_framing_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span> <span class='op'>-</span> <span class='id identifier rubyid_stud_frac'>stud_frac</span>
      <span class='id identifier rubyid_cavity_frac'>cavity_frac</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_stud_frac'>stud_frac</span> <span class='op'>+</span> <span class='id identifier rubyid_misc_framing_factor'>misc_framing_factor</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span>
      <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_stud_frac'>stud_frac</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_stud'>stud</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'>rvalue</span>
      <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_misc_framing_factor'>misc_framing_factor</span>
      <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>+</span> <span class='int'>12</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>+</span> <span class='int'>9</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>-</span> <span class='int'>6</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>-</span> <span class='int'>48</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='int'>16</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>-</span> <span class='int'>36</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='int'>12</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='int'>12</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>+</span> <span class='int'>36</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>+</span> <span class='int'>24</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>+</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>6</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>+</span> <span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+</span> <span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>-</span> <span class='int'>18</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>-</span> <span class='int'>18</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>-</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='int'>2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='int'>9</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+</span> <span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='comment'># Choose this construction set
</span>        <span class='kw'>return</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to calculate a construction for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_name'>surface_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; using the provided assembly R-value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pick_sip_construction_set'>pick_sip_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_name'>surface_name</span><span class='rparen'>)</span>
    <span class='comment'># Picks a construction set from supplied constr_sets for which a positive R-value
</span>    <span class='comment'># can be calculated for the unknown insulation to achieve the assembly R-value.
</span>
    <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='op'>|</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected object.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>SIPConstructionSet</span>

      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_calc_non_cavity_r'>calc_non_cavity_r</span><span class='lparen'>(</span><span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>+=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Material.html#initialize-instance_method" title="Material#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_sheath_thick_in'>sheath_thick_in</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Wood-class_method" title="BaseMaterial.Wood (method)">Wood</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'><span class='object_link'><a href="Material.html#rvalue-instance_method" title="Material#rvalue (method)">rvalue</a></span></span>

      <span class='comment'># Calculate effective SIP core R-value
</span>      <span class='comment'># Solved in Wolfram Alpha: https://www.wolframalpha.com/input/?i=1%2FA+%3D+B%2F(C%2BD)+%2B+E%2F(2*F%2BG%2FH*x%2BD)+%2B+(1-B-E)%2F(x%2BD)
</span>      <span class='id identifier rubyid_spline_thick_in'>spline_thick_in</span> <span class='op'>=</span> <span class='float'>0.5</span> <span class='comment'># in
</span>      <span class='id identifier rubyid_ins_thick_in'>ins_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='float'>2.0</span> <span class='op'>*</span> <span class='id identifier rubyid_spline_thick_in'>spline_thick_in</span><span class='rparen'>)</span> <span class='comment'># in
</span>      <span class='id identifier rubyid_framing_r'>framing_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Material.html#initialize-instance_method" title="Material#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Wood-class_method" title="BaseMaterial.Wood (method)">Wood</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'><span class='object_link'><a href="Material.html#rvalue-instance_method" title="Material#rvalue (method)">rvalue</a></span></span>
      <span class='id identifier rubyid_spline_r'>spline_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Material.html#initialize-instance_method" title="Material#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_spline_thick_in'>spline_thick_in</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Wood-class_method" title="BaseMaterial.Wood (method)">Wood</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'><span class='object_link'><a href="Material.html#rvalue-instance_method" title="Material#rvalue (method)">rvalue</a></span></span>
      <span class='id identifier rubyid_spline_frac'>spline_frac</span> <span class='op'>=</span> <span class='float'>4.0</span> <span class='op'>/</span> <span class='float'>48.0</span> <span class='comment'># One 4&quot; spline for every 48&quot; wide panel
</span>      <span class='id identifier rubyid_cavity_frac'>cavity_frac</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_spline_frac'>spline_frac</span> <span class='op'>+</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span>
      <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_framing_r'>framing_r</span>
      <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_spline_frac'>spline_frac</span>
      <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='id identifier rubyid_spline_r'>spline_r</span>
      <span class='id identifier rubyid_g'>g</span> <span class='op'>=</span> <span class='id identifier rubyid_ins_thick_in'>ins_thick_in</span>
      <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span>
      <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>-</span> <span class='int'>4</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>-</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='int'>2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_g'>g</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='comment'># Choose this construction set
</span>        <span class='kw'>return</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_cavity_r'>cavity_r</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to calculate a construction for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_name'>surface_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; using the provided assembly R-value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pick_cmu_construction_set'>pick_cmu_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_name'>surface_name</span><span class='rparen'>)</span>
    <span class='comment'># Picks a construction set from supplied constr_sets for which a positive R-value
</span>    <span class='comment'># can be calculated for the unknown insulation to achieve the assembly R-value.
</span>
    <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='op'>|</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected object.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>CMUConstructionSet</span>

      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_calc_non_cavity_r'>calc_non_cavity_r</span><span class='lparen'>(</span><span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='rparen'>)</span>

      <span class='comment'># Calculate effective other CMU R-value
</span>      <span class='comment'># Assumes no furring strips
</span>      <span class='comment'># Solved in Wolfram Alpha: https://www.wolframalpha.com/input/?i=1%2FA+%3D+B%2F(C%2BE%2Bx)+%2B+(1-B)%2F(D%2BE%2Bx)
</span>      <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span>
      <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Material.html#initialize-instance_method" title="Material#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Wood-class_method" title="BaseMaterial.Wood (method)">Wood</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'><span class='object_link'><a href="Material.html#rvalue-instance_method" title="Material#rvalue (method)">rvalue</a></span></span> <span class='comment'># Framing
</span>      <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Material.html#initialize-instance_method" title="Material#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Concrete-class_method" title="BaseMaterial.Concrete (method)">Concrete</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_cond_in'>cond_in</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'><span class='object_link'><a href="Material.html#rvalue-instance_method" title="Material#rvalue (method)">rvalue</a></span></span> <span class='comment'># Concrete
</span>      <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span>
      <span class='id identifier rubyid_rigid_r'>rigid_r</span> <span class='op'>=</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>-</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span><span class='op'>**</span><span class='int'>2</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='comment'># Choose this construction set
</span>        <span class='kw'>return</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to calculate a construction for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_name'>surface_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; using the provided assembly R-value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pick_icf_construction_set'>pick_icf_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_name'>surface_name</span><span class='rparen'>)</span>
    <span class='comment'># Picks a construction set from supplied constr_sets for which a positive R-value
</span>    <span class='comment'># can be calculated for the unknown insulation to achieve the assembly R-value.
</span>
    <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='op'>|</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected object.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>ICFConstructionSet</span>

      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_calc_non_cavity_r'>calc_non_cavity_r</span><span class='lparen'>(</span><span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='rparen'>)</span>

      <span class='comment'># Calculate effective ICF rigid ins R-value
</span>      <span class='comment'># Solved in Wolfram Alpha: https://www.wolframalpha.com/input/?i=1%2FA+%3D+B%2F(C%2BE)+%2B+(1-B)%2F(D%2BE%2B2*x)
</span>      <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span>
      <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_framing_factor'>framing_factor</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Material.html#initialize-instance_method" title="Material#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_ins_thick_in'>ins_thick_in</span> <span class='op'>+</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_concrete_thick_in'>concrete_thick_in</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Wood-class_method" title="BaseMaterial.Wood (method)">Wood</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'><span class='object_link'><a href="Material.html#rvalue-instance_method" title="Material#rvalue (method)">rvalue</a></span></span> <span class='comment'># Framing
</span>      <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Material.html" title="Material (class)">Material</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Material.html#initialize-instance_method" title="Material#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_concrete_thick_in'>concrete_thick_in</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="BaseMaterial.html" title="BaseMaterial (class)">BaseMaterial</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="BaseMaterial.html#Concrete-class_method" title="BaseMaterial.Concrete (method)">Concrete</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rvalue'><span class='object_link'><a href="Material.html#rvalue-instance_method" title="Material#rvalue (method)">rvalue</a></span></span> <span class='comment'># Concrete
</span>      <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span>
      <span class='id identifier rubyid_icf_r'>icf_r</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='id identifier rubyid_e'>e</span><span class='op'>**</span><span class='int'>2</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='int'>2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_icf_r'>icf_r</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='comment'># Choose this construction set
</span>        <span class='kw'>return</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_icf_r'>icf_r</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to calculate a construction for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_name'>surface_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; using the provided assembly R-value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pick_generic_construction_set'>pick_generic_construction_set</span><span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_name'>surface_name</span><span class='rparen'>)</span>
    <span class='comment'># Picks a construction set from supplied constr_sets for which a positive R-value
</span>    <span class='comment'># can be calculated for the unknown insulation to achieve the assembly R-value.
</span>
    <span class='id identifier rubyid_constr_sets'>constr_sets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_constr_set'>constr_set</span><span class='op'>|</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected object.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>GenericConstructionSet</span>

      <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span> <span class='op'>=</span> <span class='id identifier rubyid_calc_non_cavity_r'>calc_non_cavity_r</span><span class='lparen'>(</span><span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='rparen'>)</span>

      <span class='comment'># Calculate effective ins layer R-value
</span>      <span class='id identifier rubyid_layer_r'>layer_r</span> <span class='op'>=</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>-</span> <span class='id identifier rubyid_non_cavity_r'>non_cavity_r</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_layer_r'>layer_r</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='comment'># Choose this construction set
</span>        <span class='kw'>return</span> <span class='id identifier rubyid_constr_set'>constr_set</span><span class='comma'>,</span> <span class='id identifier rubyid_layer_r'>layer_r</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to calculate a construction for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_name'>surface_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; using the provided assembly R-value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_apply_solar_abs_emittance_to_construction'>apply_solar_abs_emittance_to_construction</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='comma'>,</span> <span class='id identifier rubyid_emitt'>emitt</span><span class='rparen'>)</span>
    <span class='comment'># Applies the solar absorptance and emittance to the construction&#39;s exterior layer
</span>    <span class='id identifier rubyid_exterior_material'>exterior_material</span> <span class='op'>=</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_construction'>construction</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_to_LayeredConstruction'>to_LayeredConstruction</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_layers'>layers</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_StandardOpaqueMaterial'>to_StandardOpaqueMaterial</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
    <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='period'>.</span><span class='id identifier rubyid_setThermalAbsorptance'>setThermalAbsorptance</span><span class='lparen'>(</span><span class='id identifier rubyid_emitt'>emitt</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='period'>.</span><span class='id identifier rubyid_setSolarAbsorptance'>setSolarAbsorptance</span><span class='lparen'>(</span><span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='period'>.</span><span class='id identifier rubyid_setVisibleAbsorptance'>setVisibleAbsorptance</span><span class='lparen'>(</span><span class='id identifier rubyid_solar_abs'>solar_abs</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_surface_assembly_rvalue'>check_surface_assembly_rvalue</span><span class='lparen'>(</span><span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_film_r'>film_r</span><span class='comma'>,</span> <span class='id identifier rubyid_assembly_r'>assembly_r</span><span class='rparen'>)</span>
    <span class='comment'># Verify that the actual OpenStudio construction R-value matches our target assembly R-value
</span>
    <span class='id identifier rubyid_constr_r'>constr_r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='float'>1.0</span> <span class='op'>/</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_construction'>construction</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_uFactor'>uFactor</span><span class='lparen'>(</span><span class='float'>0.0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>m^2*k/w</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hr*ft^2*f/btu</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_film_r'>film_r</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentFoundation'>adjacentFoundation</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
      <span class='id identifier rubyid_foundation'>foundation</span> <span class='op'>=</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_adjacentFoundation'>adjacentFoundation</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_interiorVerticalInsulationMaterial'>interiorVerticalInsulationMaterial</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
        <span class='id identifier rubyid_int_mat'>int_mat</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_interiorVerticalInsulationMaterial'>interiorVerticalInsulationMaterial</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_to_StandardOpaqueMaterial'>to_StandardOpaqueMaterial</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
        <span class='id identifier rubyid_constr_r'>constr_r</span> <span class='op'>+=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_int_mat'>int_mat</span><span class='period'>.</span><span class='id identifier rubyid_thickness'>thickness</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>/</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_int_mat'>int_mat</span><span class='period'>.</span><span class='id identifier rubyid_thermalConductivity'>thermalConductivity</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>W/(m*K)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Btu/(hr*ft*R)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_exteriorVerticalInsulationMaterial'>exteriorVerticalInsulationMaterial</span><span class='period'>.</span><span class='id identifier rubyid_is_initialized'>is_initialized</span>
        <span class='id identifier rubyid_ext_mat'>ext_mat</span> <span class='op'>=</span> <span class='id identifier rubyid_foundation'>foundation</span><span class='period'>.</span><span class='id identifier rubyid_exteriorVerticalInsulationMaterial'>exteriorVerticalInsulationMaterial</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_to_StandardOpaqueMaterial'>to_StandardOpaqueMaterial</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
        <span class='id identifier rubyid_constr_r'>constr_r</span> <span class='op'>+=</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_ext_mat'>ext_mat</span><span class='period'>.</span><span class='id identifier rubyid_thickness'>thickness</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>/</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_ext_mat'>ext_mat</span><span class='period'>.</span><span class='id identifier rubyid_thermalConductivity'>thermalConductivity</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>W/(m*K)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Btu/(hr*ft*R)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_assembly_r'>assembly_r</span> <span class='op'>-</span> <span class='id identifier rubyid_constr_r'>constr_r</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&gt;</span> <span class='float'>0.01</span>
      <span class='comment'># FIXME
</span>      <span class='comment'># fail &quot;Construction R-value (#{constr_r}) does not match Assembly R-value (#{assembly_r}) for &#39;#{surface.name.to_s}&#39;.&quot;
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_attached_to_multispeed_ac'>get_attached_to_multispeed_ac</span><span class='lparen'>(</span><span class='id identifier rubyid_htgsys'>htgsys</span><span class='comma'>,</span> <span class='id identifier rubyid_building'>building</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_attached_to_multispeed_ac'>attached_to_multispeed_ac</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_building'>building</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BuildingDetails/Systems/HVAC/HVACPlant/CoolingSystem</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CoolingSystemType</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>central air conditioning</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_htgsys'>htgsys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_clgsys'>clgsys</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DistributionSystem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idref</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_get_ac_num_speeds'>get_ac_num_speeds</span><span class='lparen'>(</span><span class='const'>Float</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="XMLHelper.html" title="XMLHelper (class)">XMLHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_value'><span class='object_link'><a href="XMLHelper.html#get_value-class_method" title="XMLHelper.get_value (method)">get_value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_clgsys'>clgsys</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AnnualCoolingEfficiency[Units=&#39;SEER&#39;]/Value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1-Speed</span><span class='tstring_end'>&quot;</span></span>

      <span class='id identifier rubyid_attached_to_multispeed_ac'>attached_to_multispeed_ac</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_attached_to_multispeed_ac'>attached_to_multispeed_ac</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_surface_interior'>set_surface_interior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_id'>surface_id</span><span class='comma'>,</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>living space</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeLiving-class_method" title="Constants.SpaceTypeLiving (method)">SpaceTypeLiving</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>garage</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeGarage-class_method" title="Constants.SpaceTypeGarage (method)">SpaceTypeGarage</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basement - unconditioned</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeUnfinishedBasement-class_method" title="Constants.SpaceTypeUnfinishedBasement (method)">SpaceTypeUnfinishedBasement</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basement - conditioned</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeFinishedBasement-class_method" title="Constants.SpaceTypeFinishedBasement (method)">SpaceTypeFinishedBasement</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>crawlspace - vented</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>crawlspace - unvented</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeCrawl-class_method" title="Constants.SpaceTypeCrawl (method)">SpaceTypeCrawl</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - unvented</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - vented</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeUnfinishedAttic-class_method" title="Constants.SpaceTypeUnfinishedAttic (method)">SpaceTypeUnfinishedAttic</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - conditioned</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'>SpaceTypeFinishedAttic</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>flat roof</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cathedral ceiling</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setSpace'>setSpace</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeLiving-class_method" title="Constants.SpaceTypeLiving (method)">SpaceTypeLiving</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unhandled AdjacentTo value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='embexpr_end'>}</span><span class='tstring_content'>) for surface &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_id'>surface_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_surface_exterior'>set_surface_exterior</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='id identifier rubyid_surface'>surface</span><span class='comma'>,</span> <span class='id identifier rubyid_surface_id'>surface_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setOutsideBoundaryCondition'>setOutsideBoundaryCondition</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outdoors</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ground</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_setOutsideBoundaryCondition'>setOutsideBoundaryCondition</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Foundation</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>living space</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_createAdjacentSurface'>createAdjacentSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeLiving-class_method" title="Constants.SpaceTypeLiving (method)">SpaceTypeLiving</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>garage</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_createAdjacentSurface'>createAdjacentSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeGarage-class_method" title="Constants.SpaceTypeGarage (method)">SpaceTypeGarage</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basement - unconditioned</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_createAdjacentSurface'>createAdjacentSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeUnfinishedBasement-class_method" title="Constants.SpaceTypeUnfinishedBasement (method)">SpaceTypeUnfinishedBasement</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basement - conditioned</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_createAdjacentSurface'>createAdjacentSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeFinishedBasement-class_method" title="Constants.SpaceTypeFinishedBasement (method)">SpaceTypeFinishedBasement</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>crawlspace - vented</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>crawlspace - unvented</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_createAdjacentSurface'>createAdjacentSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeCrawl-class_method" title="Constants.SpaceTypeCrawl (method)">SpaceTypeCrawl</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - unvented</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - vented</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_createAdjacentSurface'>createAdjacentSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#SpaceTypeUnfinishedAttic-class_method" title="Constants.SpaceTypeUnfinishedAttic (method)">SpaceTypeUnfinishedAttic</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - conditioned</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span>
      <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_createAdjacentSurface'>createAdjacentSurface</span><span class='lparen'>(</span><span class='id identifier rubyid_create_or_get_space'>create_or_get_space</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_spaces'>spaces</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'>SpaceTypeFinishedAttic</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unhandled AdjacentTo value (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='embexpr_end'>}</span><span class='tstring_content'>) for surface &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_surface_id'>surface_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_foundation_top'>get_foundation_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='comment'># Get top of foundation surfaces
</span>    <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>9999</span>
    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getSpaces'>getSpaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_space'>space</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="Geometry.html" title="Geometry (class)">Geometry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_space_is_below_grade'><span class='object_link'><a href="Geometry.html#space_is_below_grade-class_method" title="Geometry.space_is_below_grade (method)">space_is_below_grade</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_space'>space</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_surfaces'>surfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_surface'>surface</span><span class='op'>|</span>
        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
          <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_z'>z</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span>

          <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_z'>z</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>9999</span>
      <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='int'>9999</span>
      <span class='comment'># Pier &amp; beam foundation; get lowest floor vertex
</span>      <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getSpaces'>getSpaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_space'>space</span><span class='op'>|</span>
        <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_surfaces'>surfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_surface'>surface</span><span class='op'>|</span>
          <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_surfaceType'>surfaceType</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>floor</span><span class='tstring_end'>&quot;</span></span>

          <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_z'>z</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span>

            <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_z'>z</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_foundation_top'>foundation_top</span> <span class='op'>==</span> <span class='int'>9999</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not calculate foundation top.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_foundation_top'>foundation_top</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_walls_top'>get_walls_top</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
    <span class='comment'># Get top of wall surfaces
</span>    <span class='id identifier rubyid_walls_top'>walls_top</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>9999</span>
    <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_getSpaces'>getSpaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_space'>space</span><span class='op'>|</span>
      <span class='id identifier rubyid_space'>space</span><span class='period'>.</span><span class='id identifier rubyid_surfaces'>surfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_surface'>surface</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_surfaceType'>surfaceType</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wall</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_subSurfaces'>subSurfaces</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>0</span>

        <span class='id identifier rubyid_surface'>surface</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
          <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_z'>z</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_walls_top'>walls_top</span>

          <span class='id identifier rubyid_walls_top'>walls_top</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_z'>z</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_walls_top'>walls_top</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>9999</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not calculate walls top.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="UnitConversions.html" title="UnitConversions (class)">UnitConversions</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="UnitConversions.html#convert-class_method" title="UnitConversions.convert (method)">convert</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_walls_top'>walls_top</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ft</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>WoodStudConstructionSet</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_stud'>stud</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
    <span class='ivar'>@stud</span> <span class='op'>=</span> <span class='id identifier rubyid_stud'>stud</span>
    <span class='ivar'>@framing_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span>
    <span class='ivar'>@rigid_r</span> <span class='op'>=</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span>
    <span class='ivar'>@osb_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span>
    <span class='ivar'>@drywall_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span>
    <span class='ivar'>@exterior_material</span> <span class='op'>=</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span><span class='lparen'>(</span><span class='symbol'>:stud</span><span class='comma'>,</span> <span class='symbol'>:framing_factor</span><span class='comma'>,</span> <span class='symbol'>:rigid_r</span><span class='comma'>,</span> <span class='symbol'>:osb_thick_in</span><span class='comma'>,</span> <span class='symbol'>:drywall_thick_in</span><span class='comma'>,</span> <span class='symbol'>:exterior_material</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>SteelStudConstructionSet</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_cavity_thick_in'>cavity_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_corr_factor'>corr_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
    <span class='ivar'>@cavity_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_cavity_thick_in'>cavity_thick_in</span>
    <span class='ivar'>@corr_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_corr_factor'>corr_factor</span>
    <span class='ivar'>@framing_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span>
    <span class='ivar'>@rigid_r</span> <span class='op'>=</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span>
    <span class='ivar'>@osb_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span>
    <span class='ivar'>@drywall_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span>
    <span class='ivar'>@exterior_material</span> <span class='op'>=</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span><span class='lparen'>(</span><span class='symbol'>:cavity_thick_in</span><span class='comma'>,</span> <span class='symbol'>:corr_factor</span><span class='comma'>,</span> <span class='symbol'>:framing_factor</span><span class='comma'>,</span> <span class='symbol'>:rigid_r</span><span class='comma'>,</span> <span class='symbol'>:osb_thick_in</span><span class='comma'>,</span> <span class='symbol'>:drywall_thick_in</span><span class='comma'>,</span> <span class='symbol'>:exterior_material</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>DoubleStudConstructionSet</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_stud'>stud</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_spacing'>framing_spacing</span><span class='comma'>,</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
    <span class='ivar'>@stud</span> <span class='op'>=</span> <span class='id identifier rubyid_stud'>stud</span>
    <span class='ivar'>@framing_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span>
    <span class='ivar'>@framing_spacing</span> <span class='op'>=</span> <span class='id identifier rubyid_framing_spacing'>framing_spacing</span>
    <span class='ivar'>@rigid_r</span> <span class='op'>=</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span>
    <span class='ivar'>@osb_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span>
    <span class='ivar'>@drywall_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span>
    <span class='ivar'>@exterior_material</span> <span class='op'>=</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span><span class='lparen'>(</span><span class='symbol'>:stud</span><span class='comma'>,</span> <span class='symbol'>:framing_factor</span><span class='comma'>,</span> <span class='symbol'>:framing_spacing</span><span class='comma'>,</span> <span class='symbol'>:rigid_r</span><span class='comma'>,</span> <span class='symbol'>:osb_thick_in</span><span class='comma'>,</span> <span class='symbol'>:drywall_thick_in</span><span class='comma'>,</span> <span class='symbol'>:exterior_material</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>SIPConstructionSet</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_sheath_thick_in'>sheath_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
    <span class='ivar'>@thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_thick_in'>thick_in</span>
    <span class='ivar'>@framing_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span>
    <span class='ivar'>@rigid_r</span> <span class='op'>=</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span>
    <span class='ivar'>@sheath_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_sheath_thick_in'>sheath_thick_in</span>
    <span class='ivar'>@osb_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span>
    <span class='ivar'>@drywall_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span>
    <span class='ivar'>@exterior_material</span> <span class='op'>=</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span><span class='lparen'>(</span><span class='symbol'>:thick_in</span><span class='comma'>,</span> <span class='symbol'>:framing_factor</span><span class='comma'>,</span> <span class='symbol'>:rigid_r</span><span class='comma'>,</span> <span class='symbol'>:sheath_thick_in</span><span class='comma'>,</span> <span class='symbol'>:osb_thick_in</span><span class='comma'>,</span> <span class='symbol'>:drywall_thick_in</span><span class='comma'>,</span> <span class='symbol'>:exterior_material</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>CMUConstructionSet</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_thick_in'>thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_cond_in'>cond_in</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
    <span class='ivar'>@thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_thick_in'>thick_in</span>
    <span class='ivar'>@cond_in</span> <span class='op'>=</span> <span class='id identifier rubyid_cond_in'>cond_in</span>
    <span class='ivar'>@framing_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span>
    <span class='ivar'>@osb_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span>
    <span class='ivar'>@drywall_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span>
    <span class='ivar'>@exterior_material</span> <span class='op'>=</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span>
    <span class='ivar'>@rigid_r</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='comment'># solved for
</span>  <span class='kw'>end</span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span><span class='lparen'>(</span><span class='symbol'>:thick_in</span><span class='comma'>,</span> <span class='symbol'>:cond_in</span><span class='comma'>,</span> <span class='symbol'>:framing_factor</span><span class='comma'>,</span> <span class='symbol'>:rigid_r</span><span class='comma'>,</span> <span class='symbol'>:osb_thick_in</span><span class='comma'>,</span> <span class='symbol'>:drywall_thick_in</span><span class='comma'>,</span> <span class='symbol'>:exterior_material</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>ICFConstructionSet</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_ins_thick_in'>ins_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_concrete_thick_in'>concrete_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span><span class='comma'>,</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
    <span class='ivar'>@ins_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_ins_thick_in'>ins_thick_in</span>
    <span class='ivar'>@concrete_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_concrete_thick_in'>concrete_thick_in</span>
    <span class='ivar'>@framing_factor</span> <span class='op'>=</span> <span class='id identifier rubyid_framing_factor'>framing_factor</span>
    <span class='ivar'>@rigid_r</span> <span class='op'>=</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span>
    <span class='ivar'>@osb_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span>
    <span class='ivar'>@drywall_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span>
    <span class='ivar'>@exterior_material</span> <span class='op'>=</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span><span class='lparen'>(</span><span class='symbol'>:ins_thick_in</span><span class='comma'>,</span> <span class='symbol'>:concrete_thick_in</span><span class='comma'>,</span> <span class='symbol'>:framing_factor</span><span class='comma'>,</span> <span class='symbol'>:rigid_r</span><span class='comma'>,</span> <span class='symbol'>:osb_thick_in</span><span class='comma'>,</span> <span class='symbol'>:drywall_thick_in</span><span class='comma'>,</span> <span class='symbol'>:exterior_material</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>GenericConstructionSet</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_rigid_r'>rigid_r</span><span class='comma'>,</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span><span class='rparen'>)</span>
    <span class='ivar'>@rigid_r</span> <span class='op'>=</span> <span class='id identifier rubyid_rigid_r'>rigid_r</span>
    <span class='ivar'>@osb_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_osb_thick_in'>osb_thick_in</span>
    <span class='ivar'>@drywall_thick_in</span> <span class='op'>=</span> <span class='id identifier rubyid_drywall_thick_in'>drywall_thick_in</span>
    <span class='ivar'>@exterior_material</span> <span class='op'>=</span> <span class='id identifier rubyid_exterior_material'>exterior_material</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span><span class='lparen'>(</span><span class='symbol'>:rigid_r</span><span class='comma'>,</span> <span class='symbol'>:osb_thick_in</span><span class='comma'>,</span> <span class='symbol'>:drywall_thick_in</span><span class='comma'>,</span> <span class='symbol'>:exterior_material</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_beopt_fuel'>to_beopt_fuel</span><span class='lparen'>(</span><span class='id identifier rubyid_fuel'>fuel</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>natural gas</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#FuelTypeGas-class_method" title="Constants.FuelTypeGas (method)">FuelTypeGas</a></span></span><span class='comma'>,</span>
           <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fuel oil</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#FuelTypeOil-class_method" title="Constants.FuelTypeOil (method)">FuelTypeOil</a></span></span><span class='comma'>,</span>
           <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>propane</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#FuelTypePropane-class_method" title="Constants.FuelTypePropane (method)">FuelTypePropane</a></span></span><span class='comma'>,</span>
           <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>electricity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#FuelTypeElectric-class_method" title="Constants.FuelTypeElectric (method)">FuelTypeElectric</a></span></span> <span class='rbrace'>}</span><span class='lbracket'>[</span><span class='id identifier rubyid_fuel'>fuel</span><span class='rbracket'>]</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_beopt_wh_type'>to_beopt_wh_type</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>storage water heater</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#WaterHeaterTypeTank-class_method" title="Constants.WaterHeaterTypeTank (method)">WaterHeaterTypeTank</a></span></span><span class='comma'>,</span>
           <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>instantaneous water heater</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#WaterHeaterTypeTankless-class_method" title="Constants.WaterHeaterTypeTankless (method)">WaterHeaterTypeTankless</a></span></span><span class='comma'>,</span>
           <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>heat pump water heater</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="Constants.html" title="Constants (class)">Constants</a></span></span><span class='period'>.</span><span class='const'><span class='object_link'><a href="Constants.html#WaterHeaterTypeHeatPump-class_method" title="Constants.WaterHeaterTypeHeatPump (method)">WaterHeaterTypeHeatPump</a></span></span> <span class='rbrace'>}</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_foundation_adjacent_to'>get_foundation_adjacent_to</span><span class='lparen'>(</span><span class='id identifier rubyid_fnd_type'>fnd_type</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_fnd_type'>fnd_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Basement[Conditioned=&#39;true&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basement - conditioned</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_fnd_type'>fnd_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Basement[Conditioned=&#39;false&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basement - unconditioned</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_fnd_type'>fnd_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Crawlspace[Vented=&#39;true&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>crawlspace - vented</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_fnd_type'>fnd_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Crawlspace[Vented=&#39;false&#39;]</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>crawlspace - unvented</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_fnd_type'>fnd_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SlabOnGrade</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>living space</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_fnd_type'>fnd_type</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ambient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected foundation type.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_attic_adjacent_to'>get_attic_adjacent_to</span><span class='lparen'>(</span><span class='id identifier rubyid_attic_type'>attic_type</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_attic_type'>attic_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unvented attic</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - unvented</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_attic_type'>attic_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vented attic</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - vented</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_attic_type'>attic_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cape cod</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - conditioned</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_attic_type'>attic_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cathedral ceiling</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>living space</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_attic_type'>attic_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>flat roof</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>living space</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected attic type.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_external_thermal_boundary'>is_external_thermal_boundary</span><span class='lparen'>(</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_interior_conditioned'>interior_conditioned</span> <span class='op'>=</span> <span class='id identifier rubyid_is_adjacent_to_conditioned'>is_adjacent_to_conditioned</span><span class='lparen'>(</span><span class='id identifier rubyid_interior_adjacent_to'>interior_adjacent_to</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exterior_conditioned'>exterior_conditioned</span> <span class='op'>=</span> <span class='id identifier rubyid_is_adjacent_to_conditioned'>is_adjacent_to_conditioned</span><span class='lparen'>(</span><span class='id identifier rubyid_exterior_adjacent_to'>exterior_adjacent_to</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lparen'>(</span><span class='id identifier rubyid_interior_conditioned'>interior_conditioned</span> <span class='op'>!=</span> <span class='id identifier rubyid_exterior_conditioned'>exterior_conditioned</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_adjacent_to_conditioned'>is_adjacent_to_conditioned</span><span class='lparen'>(</span><span class='id identifier rubyid_adjacent_to'>adjacent_to</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>living space</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>garage</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - vented</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - unvented</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attic - conditioned</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basement - unconditioned</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basement - conditioned</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>crawlspace - vented</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>crawlspace - unvented</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outside</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_adjacent_to'>adjacent_to</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ground</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected adjacent_to (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_adjacent_to'>adjacent_to</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_ac_num_speeds'>get_ac_num_speeds</span><span class='lparen'>(</span><span class='id identifier rubyid_seer'>seer</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>&lt;=</span> <span class='int'>15</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1-Speed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>&lt;=</span> <span class='int'>21</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2-Speed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Variable-Speed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_ashp_num_speeds'>get_ashp_num_speeds</span><span class='lparen'>(</span><span class='id identifier rubyid_seer'>seer</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>&lt;=</span> <span class='int'>15</span>
    <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1-Speed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_seer'>seer</span> <span class='op'>&lt;=</span> <span class='int'>21</span>
    <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2-Speed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_num_speeds'>num_speeds</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Variable-Speed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># register the measure to be used by the application
</span><span class='const'>HPXMLTranslator</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_registerWithApplication'>registerWithApplication</span></pre></div></div>

      <div id="footer">
  Generated on Tue Jan  8 15:52:25 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.16 (ruby-2.2.6).
</div>

    </div>
  </body>
</html>